<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Modular design (模块化设计) | </title><meta name="description" content="君子藏器于身 待时而动 天下有道则见 无道则隐">
    <link rel="modulepreload" href="/technology/assets/app.6f963528.js"><link rel="modulepreload" href="/technology/assets/es6Interview1.html.49291d24.js"><link rel="modulepreload" href="/technology/assets/es6Interview1.html.4511da6d.js"><link rel="modulepreload" href="/technology/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/technology/assets/style.5f6eabfb.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/technology/" class=""><img class="logo" src="https://vuejs.org/images/logo.png" alt><!----></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="技术"><span class="title">技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="技术"><span class="title">技术</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/technology/base.md" class="" aria-label="技术前瞻"><!--[--><!--]--> 技术前瞻 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="js"><span class="title">js</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="js"><span class="title">js</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/mozillajs/baseObject/symbol.md" class="" aria-label="mozilla：基本对象"><!--[--><!--]--> mozilla：基本对象 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/jsInterview/baseInterview.md" class="" aria-label="基础面试题"><!--[--><!--]--> 基础面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/js/stack/executionStack.md" class="" aria-label="js 概念"><!--[--><!--]--> js 概念 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/ts/jsx/support" class="" aria-label="JSX"><!--[--><!--]--> JSX <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/ts/project/inDepthTs.md" class="" aria-label="TypeScript 项目"><!--[--><!--]--> TypeScript 项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/jsNews/es6News.md" class="" aria-label="js 新概念"><!--[--><!--]--> js 新概念 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="css"><span class="title">css</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="css"><span class="title">css</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/mozillaCss/reference/universalSelectors.md" class="" aria-label="第 1 期：CSS API"><!--[--><!--]--> 第 1 期：CSS API <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/css/interview/baseCss.md" class="" aria-label="零散记录"><!--[--><!--]--> 零散记录 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="html"><span class="title">html</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="html"><span class="title">html</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/html/interview/linkImport.md" class="" aria-label="零散记录"><!--[--><!--]--> 零散记录 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="端"><span class="title">端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="端"><span class="title">端</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/browser/interview/baseInterview.md" class="" aria-label="基础浏览器"><!--[--><!--]--> 基础浏览器 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/http/interview/baseInterview.md" class="" aria-label="基础http"><!--[--><!--]--> 基础http <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工具"><span class="title">工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工具"><span class="title">工具</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/webpack/interview/webpackInterview.md" class="" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/esbuild/description.md" class="" aria-label="esbuild"><!--[--><!--]--> esbuild <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/rollup/introduction.md" class="" aria-label="rollup"><!--[--><!--]--> rollup <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/git/indx.md" class="" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/nginx/base.md" class="" aria-label="nginx"><!--[--><!--]--> nginx <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/cli/base.md" class="" aria-label="cli"><!--[--><!--]--> cli <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/npm/commonlyUsed.md" class="" aria-label="npm"><!--[--><!--]--> npm <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="react"><span class="title">react</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="react"><span class="title">react</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/ILoveDevelop/react/principle/base.md" class="" aria-label="react 源码阅读 代码视角"><!--[--><!--]--> react 源码阅读 代码视角 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/react/preparation/idea.md" class="" aria-label="react 源码阅读 思想视角"><!--[--><!--]--> react 源码阅读 思想视角 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/react-illustration-series/main/macro-structure.md" class="" aria-label="图解React源码"><!--[--><!--]--> 图解React源码 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/umi/interview/pluginDva.md" class="" aria-label="umi"><!--[--><!--]--> umi <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/reactInterview/interview1.md" class="" aria-label="整理"><!--[--><!--]--> 整理 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="vue"><span class="title">vue</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="vue"><span class="title">vue</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/vue/prepare/flow.md" class="" aria-label="第 1 期：源码解读-准备工作"><!--[--><!--]--> 第 1 期：源码解读-准备工作 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/data-driven/_index.md" class="" aria-label="第2期：源码解读-数据驱动"><!--[--><!--]--> 第2期：源码解读-数据驱动 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/components/create-component.md" class="" aria-label="第3期：源码解读-组件化"><!--[--><!--]--> 第3期：源码解读-组件化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/reactive/reactive-object.md" class="" aria-label="第4期：源码解读-深入响应式原理"><!--[--><!--]--> 第4期：源码解读-深入响应式原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/compile/entrance.md" class="" aria-label="第5期：源码解读-编译"><!--[--><!--]--> 第5期：源码解读-编译 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/extend/event.md" class="" aria-label="第6期：源码解读-扩展"><!--[--><!--]--> 第6期：源码解读-扩展 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/vue-router/install.md" class="" aria-label="第7期：源码解读-VueRouter"><!--[--><!--]--> 第7期：源码解读-VueRouter <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/vuex/idex.md" class="" aria-label="第8期：源码解读-Vuex"><!--[--><!--]--> 第8期：源码解读-Vuex <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/interview/baseInterview.md" class="" aria-label="第9期：基础面试题"><!--[--><!--]--> 第9期：基础面试题 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="性能优化"><span class="title">性能优化</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="性能优化"><span class="title">性能优化</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/performance/vue/vue2Base.md" class="" aria-label="vue-性能优化"><!--[--><!--]--> vue-性能优化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/performance/react/reactBase.md" class="" aria-label="react-性能优化"><!--[--><!--]--> react-性能优化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/performance/base/drag1.md" class="" aria-label="组件设计"><!--[--><!--]--> 组件设计 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法&amp;设计"><span class="title">算法&amp;设计</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法&amp;设计"><span class="title">算法&amp;设计</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/algorithm/interview/baseInterview.md" class="" aria-label="第 1 期：基础面试题"><!--[--><!--]--> 第 1 期：基础面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/design/overview.md" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/designFrame/jquery.md" class="" aria-label="设计应用"><!--[--><!--]--> 设计应用 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="技术"><span class="title">技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="技术"><span class="title">技术</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/technology/base.md" class="" aria-label="技术前瞻"><!--[--><!--]--> 技术前瞻 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="js"><span class="title">js</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="js"><span class="title">js</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/mozillajs/baseObject/symbol.md" class="" aria-label="mozilla：基本对象"><!--[--><!--]--> mozilla：基本对象 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/jsInterview/baseInterview.md" class="" aria-label="基础面试题"><!--[--><!--]--> 基础面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/js/stack/executionStack.md" class="" aria-label="js 概念"><!--[--><!--]--> js 概念 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/ts/jsx/support" class="" aria-label="JSX"><!--[--><!--]--> JSX <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/ts/project/inDepthTs.md" class="" aria-label="TypeScript 项目"><!--[--><!--]--> TypeScript 项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/jsNews/es6News.md" class="" aria-label="js 新概念"><!--[--><!--]--> js 新概念 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="css"><span class="title">css</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="css"><span class="title">css</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/mozillaCss/reference/universalSelectors.md" class="" aria-label="第 1 期：CSS API"><!--[--><!--]--> 第 1 期：CSS API <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/css/interview/baseCss.md" class="" aria-label="零散记录"><!--[--><!--]--> 零散记录 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="html"><span class="title">html</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="html"><span class="title">html</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/html/interview/linkImport.md" class="" aria-label="零散记录"><!--[--><!--]--> 零散记录 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="端"><span class="title">端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="端"><span class="title">端</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/browser/interview/baseInterview.md" class="" aria-label="基础浏览器"><!--[--><!--]--> 基础浏览器 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/http/interview/baseInterview.md" class="" aria-label="基础http"><!--[--><!--]--> 基础http <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工具"><span class="title">工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工具"><span class="title">工具</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/webpack/interview/webpackInterview.md" class="" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/esbuild/description.md" class="" aria-label="esbuild"><!--[--><!--]--> esbuild <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/rollup/introduction.md" class="" aria-label="rollup"><!--[--><!--]--> rollup <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/git/indx.md" class="" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/nginx/base.md" class="" aria-label="nginx"><!--[--><!--]--> nginx <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/cli/base.md" class="" aria-label="cli"><!--[--><!--]--> cli <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/npm/commonlyUsed.md" class="" aria-label="npm"><!--[--><!--]--> npm <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="react"><span class="title">react</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="react"><span class="title">react</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/ILoveDevelop/react/principle/base.md" class="" aria-label="react 源码阅读 代码视角"><!--[--><!--]--> react 源码阅读 代码视角 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/react/preparation/idea.md" class="" aria-label="react 源码阅读 思想视角"><!--[--><!--]--> react 源码阅读 思想视角 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/react-illustration-series/main/macro-structure.md" class="" aria-label="图解React源码"><!--[--><!--]--> 图解React源码 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/umi/interview/pluginDva.md" class="" aria-label="umi"><!--[--><!--]--> umi <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/reactInterview/interview1.md" class="" aria-label="整理"><!--[--><!--]--> 整理 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="vue"><span class="title">vue</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="vue"><span class="title">vue</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/vue/prepare/flow.md" class="" aria-label="第 1 期：源码解读-准备工作"><!--[--><!--]--> 第 1 期：源码解读-准备工作 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/data-driven/_index.md" class="" aria-label="第2期：源码解读-数据驱动"><!--[--><!--]--> 第2期：源码解读-数据驱动 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/components/create-component.md" class="" aria-label="第3期：源码解读-组件化"><!--[--><!--]--> 第3期：源码解读-组件化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/reactive/reactive-object.md" class="" aria-label="第4期：源码解读-深入响应式原理"><!--[--><!--]--> 第4期：源码解读-深入响应式原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/compile/entrance.md" class="" aria-label="第5期：源码解读-编译"><!--[--><!--]--> 第5期：源码解读-编译 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/extend/event.md" class="" aria-label="第6期：源码解读-扩展"><!--[--><!--]--> 第6期：源码解读-扩展 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/vue-router/install.md" class="" aria-label="第7期：源码解读-VueRouter"><!--[--><!--]--> 第7期：源码解读-VueRouter <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/vuex/idex.md" class="" aria-label="第8期：源码解读-Vuex"><!--[--><!--]--> 第8期：源码解读-Vuex <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/interview/baseInterview.md" class="" aria-label="第9期：基础面试题"><!--[--><!--]--> 第9期：基础面试题 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="性能优化"><span class="title">性能优化</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="性能优化"><span class="title">性能优化</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/performance/vue/vue2Base.md" class="" aria-label="vue-性能优化"><!--[--><!--]--> vue-性能优化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/performance/react/reactBase.md" class="" aria-label="react-性能优化"><!--[--><!--]--> react-性能优化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/performance/base/drag1.md" class="" aria-label="组件设计"><!--[--><!--]--> 组件设计 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法&amp;设计"><span class="title">算法&amp;设计</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法&amp;设计"><span class="title">算法&amp;设计</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/algorithm/interview/baseInterview.md" class="" aria-label="第 1 期：基础面试题"><!--[--><!--]--> 第 1 期：基础面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/design/overview.md" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/designFrame/jquery.md" class="" aria-label="设计应用"><!--[--><!--]--> 设计应用 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">js 版本 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/technology/jsNews/es6News.html" class="sidebar-item" aria-label="ES6新特性（2015）"><!--[--><!--]--> ES6新特性（2015） <!--[--><!--]--></a><!----></li><li><a href="/technology/jsNews/es7News.html" class="sidebar-item" aria-label="ES7新特性（2016）"><!--[--><!--]--> ES7新特性（2016） <!--[--><!--]--></a><!----></li><li><a href="/technology/jsNews/es8News.html" class="sidebar-item" aria-label="ES8新特性（2017）"><!--[--><!--]--> ES8新特性（2017） <!--[--><!--]--></a><!----></li><li><a href="/technology/jsNews/es9News.html" class="sidebar-item" aria-label="ES9新特性（2018）"><!--[--><!--]--> ES9新特性（2018） <!--[--><!--]--></a><!----></li><li><a href="/technology/jsNews/es10News.html" class="sidebar-item" aria-label="ES10新特性（2019）"><!--[--><!--]--> ES10新特性（2019） <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">js 版本 衍生 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/technology/jsNews/es6Interview1.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Modular design (模块化设计)"><!--[--><!--]--> Modular design (模块化设计) <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/technology/jsNews/es6Interview1.html#iife" class="router-link-active router-link-exact-active sidebar-item" aria-label="IIFE"><!--[--><!--]--> IIFE <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/technology/jsNews/es6Interview1.html#demo-html" class="router-link-active router-link-exact-active sidebar-item" aria-label="demo.html"><!--[--><!--]--> demo.html <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/jsNews/es6Interview1.html#其他三个-javascript-文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="其他三个 JavaScript 文件"><!--[--><!--]--> 其他三个 JavaScript 文件 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/technology/jsNews/es6Interview1.html#commonjs" class="router-link-active router-link-exact-active sidebar-item" aria-label="CommonJS"><!--[--><!--]--> CommonJS <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/technology/jsNews/es6Interview1.html#node-js-modules" class="router-link-active router-link-exact-active sidebar-item" aria-label="Node.js Modules"><!--[--><!--]--> Node.js Modules <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/jsNews/es6Interview1.html#node-js-modules-中-require-的实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="Node.js Modules 中 require 的实现"><!--[--><!--]--> Node.js Modules 中 require 的实现 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/technology/jsNews/es6Interview1.html#requirejs-amd-asynchronous-module-definition" class="router-link-active router-link-exact-active sidebar-item" aria-label="RequireJS &amp; AMD（Asynchronous Module Definition）"><!--[--><!--]--> RequireJS &amp; AMD（Asynchronous Module Definition） <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/technology/jsNews/es6Interview1.html#优势" class="router-link-active router-link-exact-active sidebar-item" aria-label="优势"><!--[--><!--]--> 优势 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/jsNews/es6Interview1.html#新的问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="新的问题"><!--[--><!--]--> 新的问题 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/technology/jsNews/es6Interview1.html#seajs-cmd-common-module-definition" class="router-link-active router-link-exact-active sidebar-item" aria-label="SeaJS &amp; CMD（Common Module Definition）"><!--[--><!--]--> SeaJS &amp; CMD（Common Module Definition） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/jsNews/es6Interview1.html#仍然存在的问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="仍然存在的问题"><!--[--><!--]--> 仍然存在的问题 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/jsNews/es6Interview1.html#ecmascript6-module" class="router-link-active router-link-exact-active sidebar-item" aria-label="ECMAScript6 Module"><!--[--><!--]--> ECMAScript6 Module <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/technology/jsNews/es6Interview1.html#深入-es6-module-规范" class="router-link-active router-link-exact-active sidebar-item" aria-label="深入 ES6 Module 规范"><!--[--><!--]--> 深入 ES6 Module 规范 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><li><a href="/technology/jsNews/es6Interview2.html" class="sidebar-item" aria-label="详解箭头函数和普通函数的区别以及箭头函数的注意事项、不适用场景"><!--[--><!--]--> 详解箭头函数和普通函数的区别以及箭头函数的注意事项、不适用场景 <!--[--><!--]--></a><!----></li><li><a href="/technology/jsNews/es6Interview3.html" class="sidebar-item" aria-label="module、export、import分别有什么作用？"><!--[--><!--]--> module、export、import分别有什么作用？ <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="modular-design-模块化设计" tabindex="-1"><a class="header-anchor" href="#modular-design-模块化设计" aria-hidden="true">#</a> Modular design (模块化设计)</h1><ul><li><p>IIFE [Immediately Invoked Function Expression]</p></li><li><p>Common.js</p></li><li><p>AMD</p></li><li><p>CMD</p></li><li><p>ES6 Module</p></li></ul><h2 id="iife" tabindex="-1"><a class="header-anchor" href="#iife" aria-hidden="true">#</a> IIFE</h2><p><code>IIFE</code> 是 Immediately Invoked Function Expression 的缩写，作为一个基础知识，很多人可能都已经知道 <code>IIFE</code> 是怎么回事，(如果你已经掌握了 <code>IIFE</code>，可以跳过这节阅读后面的内容) 但这里仍旧会解释一下，它是怎么来的，因为在后面还会再次提到它：</p><p>最开始，对于模块区分的概念，可能是从文件的区分开始的，在一个简易的项目中，编程的习惯是通过一个 <code>HTML</code> 文件加上若干个 <code>JavaScript</code> 文件来区分不同的模块，就像这样：</p><img src="/technology/assets/es6/16a3628664b76721.png" alt="demo"><p>可以通过这样一个简单的项目来说明，来看看每个文件里面的内容：</p><h3 id="demo-html" tabindex="-1"><a class="header-anchor" href="#demo-html" aria-hidden="true">#</a> demo.html</h3><p>这个文件，只是简单的引入了其他的几个 <code>JavaScript</code> 文件：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>main.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>header.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>footer.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="其他三个-javascript-文件" tabindex="-1"><a class="header-anchor" href="#其他三个-javascript-文件" aria-hidden="true">#</a> 其他三个 JavaScript 文件</h3><p>在不同的 <code>js</code> 文件中定义了不同的变量，分别对应文件名：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> header <span class="token operator">=</span> <span class="token string">&#39;这是一条顶部信息&#39;</span> <span class="token comment">//header.js</span>
<span class="token keyword">var</span> main_message <span class="token operator">=</span> <span class="token string">&#39;这是一条内容信息&#39;</span>   <span class="token comment">//main.js</span>
<span class="token keyword">var</span> main_error <span class="token operator">=</span> <span class="token string">&#39;这是一条错误信息&#39;</span>   <span class="token comment">//main.js</span>
<span class="token keyword">var</span> footer <span class="token operator">=</span> <span class="token string">&#39;这是一条底部信息&#39;</span> <span class="token comment">//footer.js</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>像这样通过不同的文件来声明变量的方式，实际上无法将这些变量区分开来。</p><p>它们都绑定在全局的 <code>window</code> / <code>Global</code>(<code>node</code> 环境下的全局变量) 对象上，尝试去打印验证一下：</p><img src="/technology/assets/es6/16a362fa976d51a9.png" alt="demo"><p>这简直就是一场噩梦，你可能没有意识到这会导致什么严重的结果，试着在 <code>footer.js</code> 中对 <code>header</code> 变量进行赋值操作，让在末尾加上这样一行代码：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>header <span class="token operator">=</span> <span class="token string">&#39;nothing&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>打印后你就会发现，<code>window.header</code> 的已经被更改了:</p><img src="/technology/assets/es6/16a363ca9cce48ec.png" alt="demo"><p>Okay，现在知道，仅仅通过不同的文件，无法做到将这些变量分开，因为它们都被绑在了同一个 <code>window</code> 变量上。</p><p>但是更重要的是，怎么去解决呢？都知道，在 <code>JavaScript</code> 中，<strong>函数拥有自己的作用域</strong> 的，也就是说，如果可以用一个函数将这些变量包裹起来，那这些变量就不会直接被声明在全局变量 <code>window</code> 上了：</p><p>所以现在 <code>main.js</code> 的内容会被修改成这样：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mainWarraper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> main_message <span class="token operator">=</span> <span class="token string">&#39;这是一条内容信息&#39;</span> <span class="token comment">//main.js</span>
  <span class="token keyword">var</span> main_error <span class="token operator">=</span> <span class="token string">&#39;这是一条错误信息&#39;</span> <span class="token comment">//main.js</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;error:&#39;</span><span class="token punctuation">,</span> main_error<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">mainWarraper</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>为了确保定义在函数 <code>mainWarraper</code> 的内容会被执行，所以必须在这里执行 <code>mainWarraper()</code> 本身，现在在 <code>window</code> 里面找不到 <code>main_message</code> 和 <code>main_error</code> 了，因为它们被隐藏在了 <code>mainWarraper</code> 中，但是 <code>mainWarraper</code> 仍旧污染了的 <code>window</code>：</p><img src="/technology/assets/es6/16a364231a2d6dc6.png" alt="demo"><p>这个方案还不够完美，怎么改进呢？</p><p>答案就是要说的 IIFE 可以定义一个 <strong>立即执行的匿名函数</strong> 来解决这个问题：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> main_message <span class="token operator">=</span> <span class="token string">&#39;这是一条内容信息&#39;</span> <span class="token comment">//main.js</span>
  <span class="token keyword">var</span> main_error <span class="token operator">=</span> <span class="token string">&#39;这是一条错误信息&#39;</span> <span class="token comment">//main.js</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;error:&#39;</span><span class="token punctuation">,</span> main_error<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>因为是一个匿名的函数，执行完后很快就会被释放，这种机制不会污染全局对象。</p><p>虽然看起来有些麻烦，但它确实解决了将变量分离开来的需求，不是吗？然而在今天，几乎没有人会用这样方式来实现模块化编程。</p><p>后来又发生了什么呢？</p><h2 id="commonjs" tabindex="-1"><a class="header-anchor" href="#commonjs" aria-hidden="true">#</a> CommonJS</h2><p>在 2009 年的一个冬天， 一名来自 Mozilla 团队的的工程师 <em><strong>Kevin Dangoor</strong></em> 开始捣鼓了一个叫 <em><strong>ServerJS</strong></em> 的项目，他是这样描述的：</p><p>这个项目在 2009 年的 8 月份更名为今日熟悉的 CommonJS 以显示 API 更广泛的适用性。我觉得那时他可能并没有料到，这一规则的制定会让整个前端发生翻天覆地的变化。</p><p>CommonJS 在 <a href="https://en.wikipedia.org/wiki/CommonJS" target="_blank" rel="noopener noreferrer">Wikipedia<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 中是这样描述的：</p><blockquote><p><code>CommonJS</code> 是一个旨在 <code>Web</code> 浏览器之外，为 <code>JavaScript</code> 建立模块生态系统的约定的项目。 其创建的主要原因是缺乏普遍接受的 <code>JavaScript</code> 脚本模块单元形式，而这一形式可以让 <code>JavaScript</code> 在不同于传统网络浏览器提供的环境中重复使用，例如， 运行 <code>JavaScript</code> 脚本的 <code>Web</code> 服务器或本机桌面应用程序。</p></blockquote><p>通过上面这些描述，相信你已经知道 <code>CommonJS</code> 是诞生于怎样的背景，但是这里所说的 <code>CommonJS</code> 是一套通用的规范，与之对应的有非常多不同的实现：</p><img src="/technology/assets/es6/16a3b3beb0c6d07a.png" alt="demo"><h3 id="node-js-modules" tabindex="-1"><a class="header-anchor" href="#node-js-modules" aria-hidden="true">#</a> Node.js Modules</h3><blockquote><p>这里不会解释 <code>Node.js Modules</code> 的 API 基本用法，因为这些都可以通过阅读 <a href="https://nodejs.org/docs/latest/api/modules.html#modules_modules" target="_blank" rel="noopener noreferrer">官方文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 来了解，会讨论为什么会这样设计，以及大家比较难理解的点来展开。</p></blockquote><p>在 Node.js 模块系统中，每个文件都被视为一个单独的模块，在一个Node.js 的模块中，本地的变量是私有的，而这个私有的实现，是通过把 Node.js 的模块包装在一个函数中，也就是 <code>The module wrapper</code>，来看看，在 <a href="https://nodejs.org/docs/latest/api/modules.html#modules_the_module_wrapper" target="_blank" rel="noopener noreferrer">官方示例<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中 它长什么样：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> __filename<span class="token punctuation">,</span> __dirname</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// Module code actually lives in here</span>
<span class="token comment">// 实际上，模块内的代码被放在这里</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>是的，在模块内的代码被真正执行以前，实际上，这些代码都被包含在了一个这样的函数中。</p><p>如果你真正阅读了上一节中关于 <code>IIFE</code> 的内容，你会发现，其实核心思想是一样的，<code>Node.js</code> 对于模块私有化的实现也还是通过了一个函数。但是这有哪些不同呢？</p><p>虽然这里有 <code>5</code> 个参数，但是把它们先放在一边，然后尝试站在一个模块的角度来思考这样一个问题：作为一个模块，你希望自己具备什么样的能力呢?</p><ol><li><p><strong>暴露部分自己的方法或者变量的能力</strong> ：这是我存在的意义，因为，对于那些想使用我的人而言这是必须的。[ <code>exports:导出对象</code> , <code>module:模块的引用</code> ]</p></li><li><p><strong>引入其他模块的能力</strong>：有的时候我也需要通过别人的帮助来实现一些功能，只把我的注意力放在我想做的事情（核心逻辑）上。[ <code>require:引用方法</code> ]</p></li><li><p><strong>告诉别人我的物理位置</strong>：方便别人找到我，并且对我进行更新或者修改。[ <code>__filename:绝对文件名</code>, <code>__dirname:目录路径</code> ]</p></li></ol><h3 id="node-js-modules-中-require-的实现" tabindex="-1"><a class="header-anchor" href="#node-js-modules-中-require-的实现" aria-hidden="true">#</a> Node.js Modules 中 require 的实现</h3><p>为什么要了解 <code>require</code> 方法的实现呢？因为理解这一过程，可以更好地理解下面的几个问题：</p><ol><li><p>当引入一个模块的时候，究竟做了怎样一件事情？</p></li><li><p><code>exports</code> 和 <code>module.exports</code> 有什么联系和区别？</p></li><li><p>这样的方式有什么弊端？</p></li></ol><p>在文档中，有简易版的 <code>require</code> 的实现：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Module code here. In this example, define a function.</span>
    <span class="token comment">// 模块代码在这里，在这个例子中，定义了一个函数</span>
    <span class="token keyword">function</span> <span class="token function">someFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    exports <span class="token operator">=</span> someFunc<span class="token punctuation">;</span>
    <span class="token comment">// At this point, exports is no longer a shortcut to module.exports, and</span>
    <span class="token comment">// this module will still export an empty default object.</span>
    <span class="token comment">// 当代码运行到这里时，exports 不再是 module.exports 的引用，并且当前的</span>
    <span class="token comment">// module 仍旧会导出一个空对象(就像上面声明的默认对象那样)</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> someFunc<span class="token punctuation">;</span>
    <span class="token comment">// At this point, the module will now export someFunc, instead of the</span>
    <span class="token comment">// default object.</span>
    <span class="token comment">// 当代码运行到这时，当前 module 会导出 someFunc 而不是默认的对象</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="_1-require-做了怎样一件事情" tabindex="-1"><a class="header-anchor" href="#_1-require-做了怎样一件事情" aria-hidden="true">#</a> 1. require 做了怎样一件事情?</h4><p><code>require</code> 相当于把被引用的 <code>module</code> 拷贝了一份到当前 <code>module</code> 中</p><h4 id="_2-exports-和-module-exports-的联系和区别" tabindex="-1"><a class="header-anchor" href="#_2-exports-和-module-exports-的联系和区别" aria-hidden="true">#</a> 2. exports 和 module.exports 的联系和区别？</h4><p>代码中的注释以及 require 函数第一行默认值的声明，很清楚的阐述了，<code>exports</code> 和 <code>module.exports</code> 的区别和联系:</p><p><code>exports</code> 是 <code>module.exports</code> 的引用。作为一个引用，如果修改它的值，实际上修改的是它对应的引用对象的值。</p><p>就如:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment">// 等同于</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>但是如果修改了 <code>exports</code> 引用的地址，对于它原来所引用的内容来说，没有任何影响，反而断开了这个引用于原来的地址之间的联系：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token comment">// 相当于</span>

<span class="token keyword">let</span> other <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span> <span class="token comment">//为了更加直观，这样声明了一个变量</span>
exports <span class="token operator">=</span> other
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>exports</code> 从指向 <code>module.exports</code> 变为了 <code>other</code>。</p><h4 id="_3-弊端" tabindex="-1"><a class="header-anchor" href="#_3-弊端" aria-hidden="true">#</a> 3. 弊端</h4><p><code>CommonJS</code> 这一标准的初衷是为了让 <code>JavaScript</code> 在多个环境下都实现模块化，但是 Node.js 中的实现依赖了 Node.js 的环境变量：<code>module</code>，<code>exports</code>，<code>require</code>，<code>global</code>，浏览器没法用啊，所以后来出现了 <code>Browserify</code> 这样的实现，但是这并不是本文要讨论的内容，有兴趣的同学可以读读阮一峰老师的 <a href="http://www.ruanyifeng.com/blog/2015/05/commonjs-in-browser.html" target="_blank" rel="noopener noreferrer">这篇文章<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><p>说完了服务端的模块化，接下来聊聊，在浏览器这一端的模块化，又经历了些什么呢？</p><h2 id="requirejs-amd-asynchronous-module-definition" tabindex="-1"><a class="header-anchor" href="#requirejs-amd-asynchronous-module-definition" aria-hidden="true">#</a> RequireJS &amp; AMD（Asynchronous Module Definition）</h2><p>试想一下，假如现在是在浏览器环境下，使用类似于 <code>Node.js Module</code> 的方式来管理的模块（例如 <code>Browserify</code>)，会有什么样的问题呢？</p><p>因为已经了解了 <code>require()</code> 的实现，所以你会发现这其实是一个复制的过程，将被 <code>require</code> 的内容，赋值到一个 <code>module</code> 对象的属性上，然后返回这个对象的 <code>exports</code> 属性。</p><p>这样做会有什么问题呢？在还没有完成复制的时候，无法使用被引用的模块中的方法和属性。在服务端可能这不是一个问题(因为服务器的文件都是存放在本地，并且是有缓存的)，但在浏览器环境下，这会导致阻塞，使得后面的步骤无法进行下去，还可能会执行一个未定义的方法而导致出错。</p><p>相对于服务端的模块化，浏览器环境下，模块化的标准必须满足一个新的需求：异步的模块管理</p><p>在这样的背景下，<a href="https://requirejs.org/docs/api.html" target="_blank" rel="noopener noreferrer">RequireJS<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 出现了，简单的了解一下它最核心的部分：</p><ul><li><p>引入其他模块: <code>require()</code></p></li><li><p>定义新的模块: <code>define()</code></p></li></ul><blockquote><p>官方文档中的使用的例子：</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>requirejs<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 默认加载 js/lib 路径下的module ID</span>
    <span class="token literal-property property">baseUrl</span><span class="token operator">:</span> <span class="token string">&#39;js/lib&#39;</span><span class="token punctuation">,</span>
    <span class="token comment">// 除去 module ID 以 &quot;app&quot; 开头的 module 会从 js/app 路径下加载。</span>
    <span class="token comment">// 关于 paths 的配置是与 baseURL 关联的，并且因为 paths 可能会是一个目录，</span>
    <span class="token comment">// 所以不要使用 .js 扩展名 </span>
    <span class="token literal-property property">paths</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">app</span><span class="token operator">:</span> <span class="token string">&#39;../app&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 开始主逻辑</span>
<span class="token function">requirejs</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;jquery&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;canvas&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;app/sub&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token keyword">function</span>   <span class="token punctuation">(</span><span class="token parameter">$<span class="token punctuation">,</span>        canvas<span class="token punctuation">,</span>   sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//jQuery, canvas 和 app/sub 模块已经被加载并且可以在这里使用了。</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><blockquote><p>官方文档中的定义的例子：</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 简单的对象定义</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token string">&quot;unisize&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 当你需要一些逻辑来做准备工作时可以这样定义：</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//这里可以做一些准备工作</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token string">&quot;unisize&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 依赖于某些模块来定义属于你自己的模块</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;./cart&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;./inventory&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cart<span class="token punctuation">,</span> inventory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//通过返回一个对象来定义你自己的模块</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token string">&quot;large&quot;</span><span class="token punctuation">,</span>
            <span class="token function-variable function">addToCart</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                inventory<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                cart<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="优势" tabindex="-1"><a class="header-anchor" href="#优势" aria-hidden="true">#</a> 优势</h3><p><code>RequireJS</code> 是基于 <a href="https://github.com/amdjs/amdjs-api/wiki/AMD" target="_blank" rel="noopener noreferrer">AMD 规范<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 实现的，那么相对于 Node.js 的 Module 它有什么优势呢?</p><ul><li><p>以函数的形式返回模块的值，尤其是构造函数，可以更好的实现API 设计，<code>Node</code> 中通过 <code>module.exports</code> 来支持这个，但使用 <code>&quot;return function (){}&quot;</code> 会更清晰。这意味着，不必通过处理 <code>“module”</code> 来实现 <code>“module.exports”</code>，它是一个更清晰的代码表达式。</p></li><li><p>动态代码加载（在<code>AMD</code>系统中通过<code>require（[]，function（）{}）</code>来完成）是一项基本要求。 <code>CJS</code>谈到了， 有一些建议，但没有完全囊括它。 <code>Node</code> 不支持这种需求，而是依赖于<code>require（&#39;&#39;）</code>的同步行为，这对于 <code>Web</code> 环境来说是不方便的。</p></li><li><p><code>Loader</code> 插件非常有用，在基于回调的编程中，这有助于避免使用常见的嵌套大括号缩进。</p></li><li><p>选择性地将一个模块映射到从另一个位置加载，很方便的地提供了用于测试的模拟对象。</p></li><li><p>每个模块最多只能有一个 <code>IO</code> 操作，而且应该是简洁的。 <code>Web</code> 浏览器不能容忍从多个 <code>IO</code> 中来查找模块。 这与现在 <code>Node</code> 中的多路径查找相对，并且避免使用 <code>package.json</code> 的 <code>“main”</code> 属性。 而只使用模块名称，基于项目位置来简单的映射到一个位置的模块名称，不需要详细配置的合理默认规则，但允许在必要时进行简单配置。</p></li><li><p>最好的是，如果有一个 <code>&quot;opt-in&quot;</code> 可以用来调用，以便旧的 <code>JS</code> 代码可以加入到新系统。</p></li></ul><p>如果一个 <code>JS</code> 模块系统无法提供上述功能，那么与 <code>AMD</code> 及其相关 <code>API</code> 相比，它将在回调需求，加载器插件和基于路径的模块 <code>ID</code> 等方面处于明显的劣势。</p><h3 id="新的问题" tabindex="-1"><a class="header-anchor" href="#新的问题" aria-hidden="true">#</a> 新的问题</h3><p>通过上面的语法说明，会发现一个很明显的问题，在使用 <code>RequireJS</code> 声明一个模块时，必须指定所有的依赖项 ，这些依赖项会被当做形参传到 <code>factory</code> 中，对于依赖的模块会提前执行（<code>在 RequireJS 2.0 也可以选择延迟执行</code>），这被称为：<code>依赖前置</code>。</p><p>加大了开发过程中的难度，无论是阅读之前的代码还是编写新的内容，也会出现这样的情况：<code>引入的另一个模块中的内容是条件性执行的</code>。</p><h2 id="seajs-cmd-common-module-definition" tabindex="-1"><a class="header-anchor" href="#seajs-cmd-common-module-definition" aria-hidden="true">#</a> SeaJS &amp; CMD（Common Module Definition）</h2><p>针对 <code>AMD</code> 规范中可以优化的部分，<a href="https://github.com/cmdjs/specification/blob/master/draft/module.md" target="_blank" rel="noopener noreferrer">CMD 规范<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 出现了，而 <a href="https://github.com/seajs/seajs" target="_blank" rel="noopener noreferrer">SeaJS<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 则作为它的具体实现之一，与 <code>AMD</code> 十分相似：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// AMD 的一个例子，当然这是一种极端的情况</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;footer&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">header<span class="token punctuation">,</span> main<span class="token punctuation">,</span> footer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xxx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      header<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&#39;new-title&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xxx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      main<span class="token punctuation">.</span><span class="token function">setMain</span><span class="token punctuation">(</span><span class="token string">&#39;new-content&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xxx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      footer<span class="token punctuation">.</span><span class="token function">setFooter</span><span class="token punctuation">(</span><span class="token string">&#39;new-footer&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">// 与之对应的 CMD 的写法</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xxx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> header <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./header&#39;</span><span class="token punctuation">)</span>
      header<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&#39;new-title&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xxx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> main <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./main&#39;</span><span class="token punctuation">)</span>
      main<span class="token punctuation">.</span><span class="token function">setMain</span><span class="token punctuation">(</span><span class="token string">&#39;new-content&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xxx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> footer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./footer&#39;</span><span class="token punctuation">)</span>
      footer<span class="token punctuation">.</span><span class="token function">setFooter</span><span class="token punctuation">(</span><span class="token string">&#39;new-footer&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>可以很清楚的看到，<code>CMD</code> 规范中，只有当用到了某个外部模块的时候，它才会去引入，这回答了上一小节中遗留的问题，这也是它与 <code>AMD</code> 规范最大的不同点：<code>CMD推崇依赖就近 + 延迟执行</code></p><h2 id="仍然存在的问题" tabindex="-1"><a class="header-anchor" href="#仍然存在的问题" aria-hidden="true">#</a> 仍然存在的问题</h2><p>能够看到，按照 <code>CMD</code> 规范的依赖就近的规则定义一个模块，会导致模块的加载逻辑偏重，有时你并不知道当前模块具体依赖了哪些模块或者说这样的依赖关系并不直观。</p><p>而且对于 <code>AMD</code> 和 <code>CMD</code> 来说，都只是适用于浏览器端的规范，而 <code>Node.js module</code> 仅仅适用于服务端，都有各自的局限性。</p><h2 id="ecmascript6-module" tabindex="-1"><a class="header-anchor" href="#ecmascript6-module" aria-hidden="true">#</a> ECMAScript6 Module</h2><p>ECMAScript6 标准增加了 JavaScript 语言层面的模块体系定义，作为浏览器和服务器通用的模块解决方案它可以取代之前提到的 <code>AMD</code> ，<code>CMD</code> ,<code>CommonJS</code>。(在此之前还有一个 UMD（Universal Module Definition）规范也适用于前后端，但是本文不讨论，有兴趣可以查看 <a href="https://github.com/umdjs/umd" target="_blank" rel="noopener noreferrer">UMD文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> )</p><p>关于 <code>ES6</code> 的 <code>Module</code> 相信大家每天的工作中都会用到，对于使用上有疑问可以看看 <a href="http://es6.ruanyifeng.com/#docs/module" target="_blank" rel="noopener noreferrer">ES6 Module 入门，阮一峰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，当然你也可以查看 <a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-scripts-and-modules" target="_blank" rel="noopener noreferrer">TC39的官方文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>&quot;<code>ECMAScript 6 modules</code> 的目标是创造一个让 <code>CommonJS</code> 和 <code>AMD</code> 用户都满意的格式&quot;</p><ul><li><p>与 <code>CommonJS</code> 一样，具有紧凑的语法，对循环依赖以及单个 <code>exports</code> 的支持。</p></li><li><p>与 <code>AMD</code> 一样，直接支持异步加载和可配置模块加载。</p></li></ul><p>除此之外，它还有更多的优势：</p><ul><li><p>语法比<code>CommonJS</code>更紧凑。</p></li><li><p>结构可以<code>静态分析（用于静态检查，优化等）</code>。</p></li><li><p>对循环依赖的支持比 <code>CommonJS</code> 好。</p></li></ul><p>注意这里的描述里出现了两个词 <strong>循环依赖</strong> 和 <strong>静态分析</strong>，在后面会深入讨论。首先来看看， TC39 的 <a href="https://www.ecma-international.org/ecma-262/6.0/index.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 中定义的 ES6 modules 规范是什么。</p><h3 id="深入-es6-module-规范" tabindex="-1"><a class="header-anchor" href="#深入-es6-module-规范" aria-hidden="true">#</a> 深入 ES6 Module 规范</h3><p>在 <a href="https://www.ecma-international.org/ecma-262/6.0/index.html#sec-abstract-module-records" target="_blank" rel="noopener noreferrer">15.2.1.15 节<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 中，定义了 Abstract Module Records （抽象的模块记录） 的 Module Record Fields （模块记录字段） 和 Abstract Methods of Module Records （模块记录的抽象方法）</p><h4 id="module-record-fields-模块记录字段" tabindex="-1"><a class="header-anchor" href="#module-record-fields-模块记录字段" aria-hidden="true">#</a> Module Record Fields 模块记录字段</h4><table><thead><tr><th>Field Name(字段名)</th><th>Value Type(值类型)</th><th>Meaning(含义)</th></tr></thead><tbody><tr><td>域</td><td>Realm Record &amp; undefined</td><td>将在其中创建当前模块，如果模块未声明则为 undefined</td></tr><tr><td>环境</td><td>Lexical Environment &amp; undefined</td><td>词法环境包含当前模块的顶级绑定。 在实例化模块时会设置此字段</td></tr><tr><td>命名空间</td><td>Object &amp; undefined</td><td>模块的命名空间对象（如果已为此模块创建了一个）。 否则为 undefined。</td></tr><tr><td>执行结束</td><td>Boolean</td><td>初始值为 false 当模块开始执行时变成 true 并且持续到执行结束，哪怕是突然的终止（突然的终止，会有很多种原因，如果对原因感兴趣可以看下 <a href="https://stackoverflow.com/questions/392216/what-exactly-is-abrupt-completion-of-a-finally-clause" target="_blank" rel="noopener noreferrer">这个回答<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)</td></tr></tbody></table><h4 id="abstract-methods-of-module-records-模块记录的抽象方法" tabindex="-1"><a class="header-anchor" href="#abstract-methods-of-module-records-模块记录的抽象方法" aria-hidden="true">#</a> Abstract Methods of Module Records 模块记录的抽象方法</h4><table><thead><tr><th>Method 方法</th><th>Purpose 目的</th></tr></thead><tbody><tr><td>GetExportedNames(exportStarSet)</td><td>返回一个从此模块直接或间接导出的所有名称的列表。</td></tr><tr><td>ResolveExport(exportName, resolveSet, exportStarSet)</td><td>返回此模块导出的名称的绑定。 绑定由此形式的记录表示：<code>{[[module]]: Module Record, [[bindingName]]: String}</code></td></tr><tr><td>ModuleDeclarationInstantiation()</td><td>传递性地解析所有模块依赖关系,并为模块创建一个环境记录</td></tr><tr><td>ModuleEvaluation()</td><td>如果此模块已经被执行过，则不执行任何操作。 否则，传递执行此模块的所有模块依赖关系，然后执行此模块。 ModuleDeclarationInstantiation 必须在调用此方法之前完成</td></tr></tbody></table><p>也就是说，一个最最基础的模块，至少应该包含上面这些字段，和方法。反复阅读后你会发现，其实这里只是告知了一个最基础的模块，应该包含某些功能的方法，或者定义了模块的格式，但是在具体实现的时候，就像原文中说的一样：</p><p>实现可以是：将 <code>sourceText</code> 解析为模块，对其进行早期错误条件分析，并在执行<code>TopLevelModuleEvaluationJob</code>之前对其进行实例化。</p><p>实现还可以是：解析，预解析和预分析，并预先实例化 <code>sourceText</code> 的模块依赖性。 但是，必须将这些操作检测到的任何错误，推迟到实际执行<code>TopLevelModuleEvaluationJob</code> 之后再报告出来。</p><p>解析：如 <a href="https://www.ecma-international.org/ecma-262/6.0/index.html#sec-parsemodule" target="_blank" rel="noopener noreferrer">ParseModule<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 这一节中所介绍的一样，首先会对模块的源代码进行语法错误检查。例如 <a href="https://www.ecma-international.org/ecma-262/6.0/index.html#sec-module-semantics-static-semantics-early-errors" target="_blank" rel="noopener noreferrer">early-errors<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，如果解析失败，让 body 报出一个或多个解析错误和/或早期错误。如果解析成功并且没有找到早期错误，则将 body 作为生成的解析树继续执行，最后返回一个 <a href="https://www.ecma-international.org/ecma-262/6.0/index.html#sec-source-text-module-records" target="_blank" rel="noopener noreferrer">Source Text Module Records<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="从-babel-helper-module-transforms-来看-es6-module-实现" tabindex="-1"><a class="header-anchor" href="#从-babel-helper-module-transforms-来看-es6-module-实现" aria-hidden="true">#</a> 从 babel-helper-module-transforms 来看 ES6 module 实现</h4><p><code>Babel</code> 作为 <code>ES6</code> 官方指定的编译器，在如今的前端开发中发挥着巨大的作用，它可以帮助将开发人员书写的 <code>ES6</code> 语法的代码转译为 <code>ES5</code> 的代码然后交给 <code>JS</code> 引擎去执行，这一行为让可以毫无顾忌的使用 <code>ES6</code> 给带来的方便。</p><p>这里就以 <code>Babel</code> 中 <a href="https://github.com/babel/babel/blob/master/packages/babel-helper-module-transforms/src/index.js" target="_blank" rel="noopener noreferrer">babel-helper-module-transforms<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 的具体实现，来看看它是如何实现 ES6 module 转换的步骤</p><p>首先罗列一下这个文件中出现的所有方法(省略掉方法体和参数)</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * Perform all of the generic ES6 module rewriting needed to handle initial
 * module processing. This function will rewrite the majority of the given
 * program to reference the modules described by the returned metadata,
 * and returns a list of statements for use when initializing the module.
 * 执行处理初始化所需的所有通用ES6模块重写
 * 模块处理。 这个函数将重写给定的大部分
 * 程序引用返回的元数据描述的模块，
 * 并返回初始化模块时使用的语句列表。
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">rewriteModuleStatementsAndPrepareHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * Flag a set of statements as hoisted above all else so that module init
 * statements all run before user code.
 * 将一组语句标记为高于其他所有语句，以便模块初始化
 * 语句全部在用户代码之前运行。
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">ensureStatementsHoisted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
 * Given an expression for a standard import object, like &quot;require(&#39;foo&#39;)&quot;,
 * wrap it in a call to the interop helpers based on the type.
 * 给定标准导入对象的表达式，如“require（&#39;foo&#39;）”，
 * 根据类型将其包装在对 interop 助手的调用中。
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">wrapInterop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * Create the runtime initialization statements for a given requested source.
 * These will initialize all of the runtime import/export logic that
 * can&#39;t be handled statically by the statements created by
 * 为给定的请求源创建运行时初始化语句。
 * 这些将初始化所有运行时导入/导出逻辑
 * 不能由创建的语句静态处理
 * buildExportInitializationStatements().
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">buildNamespaceInitStatements</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>


<span class="token doc-comment comment">/**
 * Build an &quot;__esModule&quot; header statement setting the property on a given object.
 * 构建一个“__esModule”头语句，在给定对象上设置属性
 */</span>
<span class="token keyword">function</span> <span class="token function">buildESModuleHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>


<span class="token doc-comment comment">/**
 * Create a re-export initialization loop for a specific imported namespace.
 * 为特定导入的命名空间,创建 重新导出 初始化循环。
 */</span>
<span class="token keyword">function</span> <span class="token function">buildNamespaceReexport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
 * Build a statement declaring a variable that contains all of the exported
 * variable names in an object so they can easily be referenced from an
 * export * from statement to check for conflicts.
 * 构建一个声明,声明包含对象中所有导出变量名称的变量的语句，以便可以从export * from语句中轻松引用它们以检查冲突。
 */</span>
<span class="token keyword">function</span> <span class="token function">buildExportNameListDeclaration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * Create a set of statements that will initialize all of the statically-known
 * export names with their expected values.
 * 创建一组将通过预期的值来初始化 所有静态已知的导出名的语句
 */</span>
<span class="token keyword">function</span> <span class="token function">buildExportInitializationStatements</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * Given a set of export names, create a set of nested assignments to
 * initialize them all to a given expression.
 * 给定一组 export names，创建一组嵌套分配将它们全部初始化为给定的表达式。
 */</span>
<span class="token keyword">function</span> <span class="token function">buildInitStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><p>然后来看看他们的调用关系：</p><blockquote><p>以 A -&gt; B 的形式表示在 A 中调用了 B</p></blockquote><ol><li><p><code>buildNamespaceInitStatements</code>:为给定的请求源创建运行时初始化语句。这些将初始化所有运行时导入/导出逻辑</p></li><li><p><code>rewriteModuleStatementsAndPrepareHeader</code> 所有通用ES6模块重写,以引用返回的元数据描述的模块。 -&gt; <code>buildExportInitializationStatements</code> 创建所有静态已知的名称的 <strong>exports</strong> -&gt; <code>buildInitStatement</code> 给定一组 <strong>export names</strong>，创建一组嵌套分配将它们全部初始化为给定的表达式。</p></li></ol><p>所以总结一下，加上前面已知的第一步，其实后面的步骤分为两部分：</p><ol><li><p>解析：首先会对模块的源代码进行语法错误检查。例如 <a href="https://www.ecma-international.org/ecma-262/6.0/index.html#sec-module-semantics-static-semantics-early-errors" target="_blank" rel="noopener noreferrer">early-errors<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，如果解析失败，让 body 报出一个或多个解析错误和/或早期错误。如果解析成功并且没有找到早期错误，则将 body 作为生成的解析树继续执行，最后返回一个 <a href="https://www.ecma-international.org/ecma-262/6.0/index.html#sec-source-text-module-records" target="_blank" rel="noopener noreferrer">Source Text Module Records<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>初始化所有运行时导入/导出逻辑</p></li><li><p>以引用返回的元数据描述的模块，并且用一组 export names 将所有静态的 exports 初始化为指定的表达式。</p></li></ol><p>到这里其实已经可以很清晰的知道，在 <strong>编译阶段</strong> ，一段 ES6 module 中的代码经历了什么：</p><p><code>ES6 module 源码</code> -&gt; <code>Babel 转译</code>-&gt; <code>一段可以执行的代码</code></p><p>也就是说直到编译结束，其实模块内部的代码都只是被转换成了一段静态的代码，只有进入到 <strong>运行时</strong> 才会被执行。</p><p>这也就让 <strong>静态分析</strong> 有了可能。</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: dean@57blocks.com">DeanSui</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/technology/jsNews/es6Interview2.html" class="" aria-label="详解箭头函数和普通函数的区别以及箭头函数的注意事项、不适用场景"><!--[--><!--]--> 详解箭头函数和普通函数的区别以及箭头函数的注意事项、不适用场景 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/technology/assets/app.6f963528.js" defer></script>
  </body>
</html>
