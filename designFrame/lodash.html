<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>lodash 源码整体架构 | </title><meta name="description" content="君子藏器于身 待时而动 天下有道则见 无道则隐">
    <link rel="modulepreload" href="/technology/assets/app.ba47fc91.js"><link rel="modulepreload" href="/technology/assets/lodash.html.03b0c4c0.js"><link rel="modulepreload" href="/technology/assets/lodash.html.0a711412.js"><link rel="modulepreload" href="/technology/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/technology/assets/style.5f6eabfb.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/technology/" class=""><img class="logo" src="https://vuejs.org/images/logo.png" alt><!----></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="技术"><span class="title">技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="技术"><span class="title">技术</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/technology/base.md" class="" aria-label="技术前瞻"><!--[--><!--]--> 技术前瞻 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="js"><span class="title">js</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="js"><span class="title">js</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/mozillajs/baseObject/symbol.md" class="" aria-label="mozilla：基本对象"><!--[--><!--]--> mozilla：基本对象 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/jsInterview/baseInterview.md" class="" aria-label="基础面试题"><!--[--><!--]--> 基础面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/js/stack/executionStack.md" class="" aria-label="js 概念"><!--[--><!--]--> js 概念 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/ts/jsx/support" class="" aria-label="JSX"><!--[--><!--]--> JSX <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/ts/project/inDepthTs.md" class="" aria-label="TypeScript 项目"><!--[--><!--]--> TypeScript 项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/jsNews/es6News.md" class="" aria-label="js 新概念"><!--[--><!--]--> js 新概念 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="css"><span class="title">css</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="css"><span class="title">css</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/mozillaCss/reference/universalSelectors.md" class="" aria-label="第 1 期：CSS API"><!--[--><!--]--> 第 1 期：CSS API <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/css/interview/baseCss.md" class="" aria-label="零散记录"><!--[--><!--]--> 零散记录 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="html"><span class="title">html</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="html"><span class="title">html</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/html/interview/linkImport.md" class="" aria-label="零散记录"><!--[--><!--]--> 零散记录 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="端"><span class="title">端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="端"><span class="title">端</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/browser/interview/baseInterview.md" class="" aria-label="基础浏览器"><!--[--><!--]--> 基础浏览器 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/http/interview/baseInterview.md" class="" aria-label="基础http"><!--[--><!--]--> 基础http <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工具"><span class="title">工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工具"><span class="title">工具</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/webpack/interview/webpackInterview.md" class="" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/esbuild/description.md" class="" aria-label="esbuild"><!--[--><!--]--> esbuild <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/rollup/introduction.md" class="" aria-label="rollup"><!--[--><!--]--> rollup <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/git/indx.md" class="" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/nginx/base.md" class="" aria-label="nginx"><!--[--><!--]--> nginx <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/cli/base.md" class="" aria-label="cli"><!--[--><!--]--> cli <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/npm/commonlyUsed.md" class="" aria-label="npm"><!--[--><!--]--> npm <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="react"><span class="title">react</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="react"><span class="title">react</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/ILoveDevelop/react/principle/base.md" class="" aria-label="react 源码阅读 代码视角"><!--[--><!--]--> react 源码阅读 代码视角 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/react/preparation/idea.md" class="" aria-label="react 源码阅读 思想视角"><!--[--><!--]--> react 源码阅读 思想视角 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/react-illustration-series/main/macro-structure.md" class="" aria-label="图解React源码"><!--[--><!--]--> 图解React源码 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/umi/interview/pluginDva.md" class="" aria-label="umi"><!--[--><!--]--> umi <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/reactInterview/interview1.md" class="" aria-label="整理"><!--[--><!--]--> 整理 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="vue"><span class="title">vue</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="vue"><span class="title">vue</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/vue/prepare/flow.md" class="" aria-label="第 1 期：源码解读-准备工作"><!--[--><!--]--> 第 1 期：源码解读-准备工作 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/data-driven/_index.md" class="" aria-label="第2期：源码解读-数据驱动"><!--[--><!--]--> 第2期：源码解读-数据驱动 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/components/create-component.md" class="" aria-label="第3期：源码解读-组件化"><!--[--><!--]--> 第3期：源码解读-组件化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/reactive/reactive-object.md" class="" aria-label="第4期：源码解读-深入响应式原理"><!--[--><!--]--> 第4期：源码解读-深入响应式原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/compile/entrance.md" class="" aria-label="第5期：源码解读-编译"><!--[--><!--]--> 第5期：源码解读-编译 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/extend/event.md" class="" aria-label="第6期：源码解读-扩展"><!--[--><!--]--> 第6期：源码解读-扩展 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/vue-router/install.md" class="" aria-label="第7期：源码解读-VueRouter"><!--[--><!--]--> 第7期：源码解读-VueRouter <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/vuex/idex.md" class="" aria-label="第8期：源码解读-Vuex"><!--[--><!--]--> 第8期：源码解读-Vuex <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/interview/baseInterview.md" class="" aria-label="第9期：基础面试题"><!--[--><!--]--> 第9期：基础面试题 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="性能优化"><span class="title">性能优化</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="性能优化"><span class="title">性能优化</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/performance/vue/vue2Base.md" class="" aria-label="vue-性能优化"><!--[--><!--]--> vue-性能优化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/performance/react/reactBase.md" class="" aria-label="react-性能优化"><!--[--><!--]--> react-性能优化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/performance/base/drag1.md" class="" aria-label="组件设计"><!--[--><!--]--> 组件设计 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法&amp;设计"><span class="title">算法&amp;设计</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法&amp;设计"><span class="title">算法&amp;设计</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/algorithm/interview/baseInterview.md" class="" aria-label="第 1 期：基础面试题"><!--[--><!--]--> 第 1 期：基础面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/design/overview.md" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/designFrame/jquery.md" class="" aria-label="设计应用"><!--[--><!--]--> 设计应用 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="技术"><span class="title">技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="技术"><span class="title">技术</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/technology/base.md" class="" aria-label="技术前瞻"><!--[--><!--]--> 技术前瞻 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="js"><span class="title">js</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="js"><span class="title">js</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/mozillajs/baseObject/symbol.md" class="" aria-label="mozilla：基本对象"><!--[--><!--]--> mozilla：基本对象 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/jsInterview/baseInterview.md" class="" aria-label="基础面试题"><!--[--><!--]--> 基础面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/js/stack/executionStack.md" class="" aria-label="js 概念"><!--[--><!--]--> js 概念 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/ts/jsx/support" class="" aria-label="JSX"><!--[--><!--]--> JSX <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/ts/project/inDepthTs.md" class="" aria-label="TypeScript 项目"><!--[--><!--]--> TypeScript 项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/jsNews/es6News.md" class="" aria-label="js 新概念"><!--[--><!--]--> js 新概念 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="css"><span class="title">css</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="css"><span class="title">css</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/mozillaCss/reference/universalSelectors.md" class="" aria-label="第 1 期：CSS API"><!--[--><!--]--> 第 1 期：CSS API <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/css/interview/baseCss.md" class="" aria-label="零散记录"><!--[--><!--]--> 零散记录 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="html"><span class="title">html</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="html"><span class="title">html</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/html/interview/linkImport.md" class="" aria-label="零散记录"><!--[--><!--]--> 零散记录 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="端"><span class="title">端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="端"><span class="title">端</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/browser/interview/baseInterview.md" class="" aria-label="基础浏览器"><!--[--><!--]--> 基础浏览器 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/http/interview/baseInterview.md" class="" aria-label="基础http"><!--[--><!--]--> 基础http <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工具"><span class="title">工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工具"><span class="title">工具</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/webpack/interview/webpackInterview.md" class="" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/esbuild/description.md" class="" aria-label="esbuild"><!--[--><!--]--> esbuild <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/rollup/introduction.md" class="" aria-label="rollup"><!--[--><!--]--> rollup <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/git/indx.md" class="" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/nginx/base.md" class="" aria-label="nginx"><!--[--><!--]--> nginx <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/cli/base.md" class="" aria-label="cli"><!--[--><!--]--> cli <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/npm/commonlyUsed.md" class="" aria-label="npm"><!--[--><!--]--> npm <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="react"><span class="title">react</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="react"><span class="title">react</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/ILoveDevelop/react/principle/base.md" class="" aria-label="react 源码阅读 代码视角"><!--[--><!--]--> react 源码阅读 代码视角 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/react/preparation/idea.md" class="" aria-label="react 源码阅读 思想视角"><!--[--><!--]--> react 源码阅读 思想视角 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/react-illustration-series/main/macro-structure.md" class="" aria-label="图解React源码"><!--[--><!--]--> 图解React源码 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/umi/interview/pluginDva.md" class="" aria-label="umi"><!--[--><!--]--> umi <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/reactInterview/interview1.md" class="" aria-label="整理"><!--[--><!--]--> 整理 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="vue"><span class="title">vue</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="vue"><span class="title">vue</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/vue/prepare/flow.md" class="" aria-label="第 1 期：源码解读-准备工作"><!--[--><!--]--> 第 1 期：源码解读-准备工作 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/data-driven/_index.md" class="" aria-label="第2期：源码解读-数据驱动"><!--[--><!--]--> 第2期：源码解读-数据驱动 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/components/create-component.md" class="" aria-label="第3期：源码解读-组件化"><!--[--><!--]--> 第3期：源码解读-组件化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/reactive/reactive-object.md" class="" aria-label="第4期：源码解读-深入响应式原理"><!--[--><!--]--> 第4期：源码解读-深入响应式原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/compile/entrance.md" class="" aria-label="第5期：源码解读-编译"><!--[--><!--]--> 第5期：源码解读-编译 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/extend/event.md" class="" aria-label="第6期：源码解读-扩展"><!--[--><!--]--> 第6期：源码解读-扩展 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/vue-router/install.md" class="" aria-label="第7期：源码解读-VueRouter"><!--[--><!--]--> 第7期：源码解读-VueRouter <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/vuex/idex.md" class="" aria-label="第8期：源码解读-Vuex"><!--[--><!--]--> 第8期：源码解读-Vuex <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/interview/baseInterview.md" class="" aria-label="第9期：基础面试题"><!--[--><!--]--> 第9期：基础面试题 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="性能优化"><span class="title">性能优化</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="性能优化"><span class="title">性能优化</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/performance/vue/vue2Base.md" class="" aria-label="vue-性能优化"><!--[--><!--]--> vue-性能优化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/performance/react/reactBase.md" class="" aria-label="react-性能优化"><!--[--><!--]--> react-性能优化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/performance/base/drag1.md" class="" aria-label="组件设计"><!--[--><!--]--> 组件设计 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法&amp;设计"><span class="title">算法&amp;设计</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法&amp;设计"><span class="title">算法&amp;设计</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/algorithm/interview/baseInterview.md" class="" aria-label="第 1 期：基础面试题"><!--[--><!--]--> 第 1 期：基础面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/design/overview.md" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/designFrame/jquery.md" class="" aria-label="设计应用"><!--[--><!--]--> 设计应用 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">库设计模式 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/technology/designFrame/jquery.html" class="sidebar-item" aria-label="jQuery 源码整体架构"><!--[--><!--]--> jQuery 源码整体架构 <!--[--><!--]--></a><!----></li><li><a href="/technology/designFrame/underscore.html" class="sidebar-item" aria-label="underscore 源码整体架构"><!--[--><!--]--> underscore 源码整体架构 <!--[--><!--]--></a><!----></li><li><a href="/technology/designFrame/createUnderscore.html" class="sidebar-item" aria-label="underscore 系列之如何写自己的 underscore"><!--[--><!--]--> underscore 系列之如何写自己的 underscore <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="lodash 源码整体架构"><!--[--><!--]--> lodash 源码整体架构 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/technology/designFrame/lodash.html#匿名函数执行" class="router-link-active router-link-exact-active sidebar-item" aria-label="匿名函数执行"><!--[--><!--]--> 匿名函数执行 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#runincontext-函数" class="router-link-active router-link-exact-active sidebar-item" aria-label="runInContext 函数"><!--[--><!--]--> runInContext 函数 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/technology/designFrame/lodash.html#lodashwrapper-函数" class="router-link-active router-link-exact-active sidebar-item" aria-label="LodashWrapper 函数"><!--[--><!--]--> LodashWrapper 函数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#basecreate-原型继承" class="router-link-active router-link-exact-active sidebar-item" aria-label="baseCreate 原型继承"><!--[--><!--]--> baseCreate 原型继承 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#衍生的-isobject-函数" class="router-link-active router-link-exact-active sidebar-item" aria-label="衍生的 isObject 函数"><!--[--><!--]--> 衍生的 isObject 函数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#object-create-用法举例" class="router-link-active router-link-exact-active sidebar-item" aria-label="Object.create() 用法举例"><!--[--><!--]--> Object.create() 用法举例 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#mixin" class="router-link-active router-link-exact-active sidebar-item" aria-label="mixin"><!--[--><!--]--> mixin <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/technology/designFrame/lodash.html#mixin-具体用法" class="router-link-active router-link-exact-active sidebar-item" aria-label="mixin 具体用法"><!--[--><!--]--> mixin 具体用法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#mixin-源码" class="router-link-active router-link-exact-active sidebar-item" aria-label="mixin 源码"><!--[--><!--]--> mixin 源码 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#mixin-衍生的函数-keys" class="router-link-active router-link-exact-active sidebar-item" aria-label="mixin 衍生的函数 keys"><!--[--><!--]--> mixin 衍生的函数 keys <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#mixin-衍生的函数-basefunctions" class="router-link-active router-link-exact-active sidebar-item" aria-label="mixin 衍生的函数 baseFunctions"><!--[--><!--]--> mixin 衍生的函数 baseFunctions <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#mixin-衍生的函数-isfunction" class="router-link-active router-link-exact-active sidebar-item" aria-label="mixin 衍生的函数 isFunction"><!--[--><!--]--> mixin 衍生的函数 isFunction <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#mixin-衍生的函数-arrayeach" class="router-link-active router-link-exact-active sidebar-item" aria-label="mixin 衍生的函数 arrayEach"><!--[--><!--]--> mixin 衍生的函数 arrayEach <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#mixin-衍生的函数-arraypush" class="router-link-active router-link-exact-active sidebar-item" aria-label="mixin 衍生的函数 arrayPush"><!--[--><!--]--> mixin 衍生的函数 arrayPush <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#mixin-衍生的函数-copyarray" class="router-link-active router-link-exact-active sidebar-item" aria-label="mixin 衍生的函数 copyArray"><!--[--><!--]--> mixin 衍生的函数 copyArray <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#mixin-源码解析" class="router-link-active router-link-exact-active sidebar-item" aria-label="mixin 源码解析"><!--[--><!--]--> mixin 源码解析 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#mixin源码及注释" class="router-link-active router-link-exact-active sidebar-item" aria-label="mixin源码及注释"><!--[--><!--]--> mixin源码及注释 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#lodash-究竟在-和-prototype挂载了多少方法和属性" class="router-link-active router-link-exact-active sidebar-item" aria-label="lodash 究竟在_和_.prototype挂载了多少方法和属性"><!--[--><!--]--> lodash 究竟在_和_.prototype挂载了多少方法和属性 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#请出贯穿下文的简单的例子" class="router-link-active router-link-exact-active sidebar-item" aria-label="请出贯穿下文的简单的例子"><!--[--><!--]--> 请出贯穿下文的简单的例子 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#添加-lazywrapper-的方法到-lodash-prototype" class="router-link-active router-link-exact-active sidebar-item" aria-label="添加 LazyWrapper 的方法到 lodash.prototype"><!--[--><!--]--> 添加 LazyWrapper 的方法到 lodash.prototype <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/technology/designFrame/lodash.html#源码-注释" class="router-link-active router-link-exact-active sidebar-item" aria-label="源码&amp;注释"><!--[--><!--]--> 源码&amp;注释 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#例子的chain和map执行后的debugger截图" class="router-link-active router-link-exact-active sidebar-item" aria-label="例子的chain和map执行后的debugger截图"><!--[--><!--]--> 例子的chain和map执行后的debugger截图 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#例子的chain和map执行后的结果截图" class="router-link-active router-link-exact-active sidebar-item" aria-label="例子的chain和map执行后的结果截图"><!--[--><!--]--> 例子的chain和map执行后的结果截图 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#lodash-prototype-value-即-wrappervalue" class="router-link-active router-link-exact-active sidebar-item" aria-label="lodash.prototype.value 即 wrapperValue"><!--[--><!--]--> lodash.prototype.value 即 wrapperValue <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#lazywrapper-prototype-value-即-lazyvalue-惰性求值" class="router-link-active router-link-exact-active sidebar-item" aria-label="LazyWrapper.prototype.value 即 lazyValue 惰性求值"><!--[--><!--]--> LazyWrapper.prototype.value 即 lazyValue 惰性求值 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/technology/designFrame/lodash.html#lazyvalue源码及注释" class="router-link-active router-link-exact-active sidebar-item" aria-label="lazyValue源码及注释"><!--[--><!--]--> lazyValue源码及注释 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/technology/designFrame/lodash.html#总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/technology/designFrame/sentry.html" class="sidebar-item" aria-label="sentry 源码整体架构"><!--[--><!--]--> sentry 源码整体架构 <!--[--><!--]--></a><!----></li><li><a href="/technology/designFrame/vuex.html" class="sidebar-item" aria-label="vuex 源码整体架构"><!--[--><!--]--> vuex 源码整体架构 <!--[--><!--]--></a><!----></li><li><a href="/technology/designFrame/axios.html" class="sidebar-item" aria-label="axios 源码整体架构"><!--[--><!--]--> axios 源码整体架构 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="lodash-源码整体架构" tabindex="-1"><a class="header-anchor" href="#lodash-源码整体架构" aria-hidden="true">#</a> lodash 源码整体架构</h1><div class="custom-container tip"><p class="custom-container-title">注意</p><p><code>lodash</code>的版本是：<code>v4.17.15</code></p><p><code>unpkg.com</code>地址 https://unpkg.com/lodash@4.17.15/lodash.js</p></div><h2 id="匿名函数执行" tabindex="-1"><a class="header-anchor" href="#匿名函数执行" aria-hidden="true">#</a> 匿名函数执行</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>暴露 lodash</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> _ <span class="token operator">=</span> <span class="token function">runInContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="runincontext-函数" tabindex="-1"><a class="header-anchor" href="#runincontext-函数" aria-hidden="true">#</a> runInContext 函数</h2><blockquote><p>这里的简版源码，只关注函数入口和返回值。</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> runInContext <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">runInContext</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">// 浏览器中处理context为window</span>
 <span class="token comment">// ...</span>
 <span class="token keyword">function</span> <span class="token function">lodash</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LodashWrapper</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">// ...</span>
 <span class="token keyword">return</span> lodash<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>可以看到申明了一个<code>runInContext</code>函数。里面有一个<code>lodash</code>函数，最后处理返回这个<code>lodash</code>函数。</p><p>再看<code>lodash</code>函数中的返回值 <code>new LodashWrapper(value)</code>。</p><h3 id="lodashwrapper-函数" tabindex="-1"><a class="header-anchor" href="#lodashwrapper-函数" aria-hidden="true">#</a> LodashWrapper 函数</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">LodashWrapper</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> chainAll</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>__wrapped__ <span class="token operator">=</span> value<span class="token punctuation">;</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>__actions__ <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>__chain__ <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>chainAll<span class="token punctuation">;</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>__index__ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>__values__ <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>设置了这些属性：</p></blockquote><ul><li><p><code>__wrapped__</code>：存放参数<code>value</code>。</p></li><li><p><code>__actions__</code>：存放待执行的函数体<code>func</code>， 函数参数 <code>args</code>，函数执行的<code>this</code> 指向 <code>thisArg</code>。</p></li><li><p><code>__chain__</code>、<code>undefined</code>两次取反转成布尔值<code>false</code>，不支持链式调用。和<code>underscore</code>一样，默认是不支持链式调用的。</p></li><li><p><code>__index__</code>：索引值 默认 0。</p></li><li><p><code>__values__</code>：主要<code>clone</code>时使用。</p></li></ul><p>接着往下搜索源码，<code>LodashWrapper</code>， 会发现这两行代码。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token class-name">LodashWrapper</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token function">baseCreate</span><span class="token punctuation">(</span>baseLodash<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">LodashWrapper</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> LodashWrapper<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>接着往上找<code>baseCreate</code>、<code>baseLodash</code>这两个函数。</p><h3 id="basecreate-原型继承" tabindex="-1"><a class="header-anchor" href="#basecreate-原型继承" aria-hidden="true">#</a> baseCreate 原型继承</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//  立即执行匿名函数</span>
<span class="token comment">// 返回一个函数，用于设置原型 可以理解为是 __proto__</span>
<span class="token keyword">var</span> baseCreate <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">// 这句放在函数外，是为了不用每次调用baseCreate都重复申明 object</span>
 <span class="token comment">// underscore 源码中，把这句放在开头就申明了一个空函数 `Ctor`</span>
 <span class="token keyword">function</span> <span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
 <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">proto</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果传入的参数不是object也不是function 是null</span>
  <span class="token comment">// 则返回空对象。</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>proto<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 如果支持Object.create方法，则返回 Object.create</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>objectCreate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// Object.create</span>
   <span class="token keyword">return</span> <span class="token function">objectCreate</span><span class="token punctuation">(</span>proto<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 如果不支持Object.create 用 ployfill new</span>
  object<span class="token punctuation">.</span>prototype <span class="token operator">=</span> proto<span class="token punctuation">;</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">object</span><span class="token punctuation">;</span>
  <span class="token comment">// 还原 prototype</span>
  object<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 空函数</span>
<span class="token keyword">function</span> <span class="token function">baseLodash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">// No operation performed.</span>
<span class="token punctuation">}</span>

<span class="token comment">// Ensure wrappers are instances of `baseLodash`.</span>
lodash<span class="token punctuation">.</span>prototype <span class="token operator">=</span> baseLodash<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
<span class="token comment">// 为什么会有这一句？因为上一句把lodash.prototype.construtor 设置为Object了。这一句修正constructor</span>
lodash<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> lodash<span class="token punctuation">;</span>

<span class="token class-name">LodashWrapper</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token function">baseCreate</span><span class="token punctuation">(</span>baseLodash<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">LodashWrapper</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> LodashWrapper<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><img src="/technology/assets/designFrame/16d19648b052f4cb_tplv-t2oaga2asx-watermark.awebp" alt="lodash 原型关系图"><h3 id="衍生的-isobject-函数" tabindex="-1"><a class="header-anchor" href="#衍生的-isobject-函数" aria-hidden="true">#</a> 衍生的 isObject 函数</h3><blockquote><p>判断<code>typeof value</code>不等于<code>null</code>，并且是<code>object</code>或者<code>function</code>。</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">isObject</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">var</span> type <span class="token operator">=</span> <span class="token keyword">typeof</span> value<span class="token punctuation">;</span>
 <span class="token keyword">return</span> value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">&#39;object&#39;</span> <span class="token operator">||</span> type <span class="token operator">==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="object-create-用法举例" tabindex="-1"><a class="header-anchor" href="#object-create-用法举例" aria-hidden="true">#</a> Object.create() 用法举例</h3><p><code>lodash</code>上有很多方法和属性，但在<code>lodash.prototype</code>也有很多与<code>lodash</code>上相同的方法。肯定不是在<code>lodash.prototype</code>上重新写一遍。而是通过<code>mixin</code>挂载的。</p><h2 id="mixin" tabindex="-1"><a class="header-anchor" href="#mixin" aria-hidden="true">#</a> mixin</h2><h3 id="mixin-具体用法" tabindex="-1"><a class="header-anchor" href="#mixin-具体用法" aria-hidden="true">#</a> mixin 具体用法</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>_<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">[</span>object<span class="token operator">=</span>lodash<span class="token punctuation">]</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>添加来源对象自身的所有可枚举函数属性到目标对象。 如果 object 是个函数，那么函数方法将被添加到原型链上。</p></blockquote><blockquote><p>注意: 使用 _.runInContext 来创建原始的 lodash 函数来避免修改造成的冲突。</p></blockquote><p><strong>添加版本</strong></p><blockquote><p>0.1.0</p></blockquote><p><strong>参数</strong></p><blockquote><p>[object=lodash] (Function|Object): 目标对象。</p></blockquote><blockquote><p>source (Object): 来源对象。</p></blockquote><blockquote><p>[options={}] (Object): 选项对象。</p></blockquote><blockquote><p>[options.chain=true] (boolean): 是否开启链式操作。</p></blockquote><p><strong>返回</strong></p><blockquote><p>(*): 返回 object.</p></blockquote><h3 id="mixin-源码" tabindex="-1"><a class="header-anchor" href="#mixin-源码" aria-hidden="true">#</a> mixin 源码</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mixin</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> source<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">var</span> props <span class="token operator">=</span> <span class="token function">keys</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">,</span>
  methodNames <span class="token operator">=</span> <span class="token function">baseFunctions</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
  <span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>methodNames<span class="token punctuation">.</span>length <span class="token operator">||</span> <span class="token operator">!</span>props<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  options <span class="token operator">=</span> source<span class="token punctuation">;</span>
  source <span class="token operator">=</span> object<span class="token punctuation">;</span>
  object <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  methodNames <span class="token operator">=</span> <span class="token function">baseFunctions</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token function">keys</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">var</span> chain <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&#39;chain&#39;</span> <span class="token keyword">in</span> options<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>chain<span class="token punctuation">,</span>
  isFunc <span class="token operator">=</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token function">arrayEach</span><span class="token punctuation">(</span>methodNames<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">methodName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> func <span class="token operator">=</span> source<span class="token punctuation">[</span>methodName<span class="token punctuation">]</span><span class="token punctuation">;</span>
  object<span class="token punctuation">[</span>methodName<span class="token punctuation">]</span> <span class="token operator">=</span> func<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   object<span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>methodName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> chainAll <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__chain__<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>chain <span class="token operator">||</span> chainAll<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">object</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>__wrapped__<span class="token punctuation">)</span><span class="token punctuation">,</span>
      actions <span class="token operator">=</span> result<span class="token punctuation">.</span>__actions__ <span class="token operator">=</span> <span class="token function">copyArray</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>__actions__<span class="token punctuation">)</span><span class="token punctuation">;</span>

     actions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string-property property">&#39;func&#39;</span><span class="token operator">:</span> func<span class="token punctuation">,</span> <span class="token string-property property">&#39;args&#39;</span><span class="token operator">:</span> arguments<span class="token punctuation">,</span> <span class="token string-property property">&#39;thisArg&#39;</span><span class="token operator">:</span> object <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     result<span class="token punctuation">.</span>__chain__ <span class="token operator">=</span> chainAll<span class="token punctuation">;</span>
     <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> <span class="token function">arrayPush</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">return</span> object<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="mixin-衍生的函数-keys" tabindex="-1"><a class="header-anchor" href="#mixin-衍生的函数-keys" aria-hidden="true">#</a> mixin 衍生的函数 keys</h3><p>在 <code>mixin</code> 函数中 其实最终调用的就是 <code>Object.keys</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">keys</span><span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token function">isArrayLike</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">arrayLikeKeys</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">baseKeys</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="mixin-衍生的函数-basefunctions" tabindex="-1"><a class="header-anchor" href="#mixin-衍生的函数-basefunctions" aria-hidden="true">#</a> mixin 衍生的函数 baseFunctions</h3><p>返回函数数组集合</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">baseFunctions</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token function">arrayFilter</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>object<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="mixin-衍生的函数-isfunction" tabindex="-1"><a class="header-anchor" href="#mixin-衍生的函数-isfunction" aria-hidden="true">#</a> mixin 衍生的函数 isFunction</h3><p>判断参数是否是函数</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">isFunction</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">// The use of `Object#toString` avoids issues with the `typeof` operator</span>
 <span class="token comment">// in Safari 9 which returns &#39;object&#39; for typed arrays and other constructors.</span>
 <span class="token keyword">var</span> tag <span class="token operator">=</span> <span class="token function">baseGetTag</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> tag <span class="token operator">==</span> funcTag <span class="token operator">||</span> tag <span class="token operator">==</span> genTag <span class="token operator">||</span> tag <span class="token operator">==</span> asyncTag <span class="token operator">||</span> tag <span class="token operator">==</span> proxyTag<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="mixin-衍生的函数-arrayeach" tabindex="-1"><a class="header-anchor" href="#mixin-衍生的函数-arrayeach" aria-hidden="true">#</a> mixin 衍生的函数 arrayEach</h3><p>类似 <code>[].forEarch</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">arrayEach</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> iteratee</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
  length <span class="token operator">=</span> array <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

 <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">++</span>index <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">iteratee</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> array<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> array<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="mixin-衍生的函数-arraypush" tabindex="-1"><a class="header-anchor" href="#mixin-衍生的函数-arraypush" aria-hidden="true">#</a> mixin 衍生的函数 arrayPush</h3><p>类似 <code>[].push</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">arrayPush</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> values</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
  length <span class="token operator">=</span> values<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
  offset <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

 <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">++</span>index <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 array<span class="token punctuation">[</span>offset <span class="token operator">+</span> index<span class="token punctuation">]</span> <span class="token operator">=</span> values<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> array<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="mixin-衍生的函数-copyarray" tabindex="-1"><a class="header-anchor" href="#mixin-衍生的函数-copyarray" aria-hidden="true">#</a> mixin 衍生的函数 copyArray</h3><p>拷贝数组</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">copyArray</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
  length <span class="token operator">=</span> source<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

 array <span class="token operator">||</span> <span class="token punctuation">(</span>array <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">++</span>index <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  array<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> source<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> array<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="mixin-源码解析" tabindex="-1"><a class="header-anchor" href="#mixin-源码解析" aria-hidden="true">#</a> mixin 源码解析</h3><p><code>lodash</code> 源码中两次调用 <code>mixin</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Add methods that return wrapped values in chain sequences.</span>
lodash<span class="token punctuation">.</span>after <span class="token operator">=</span> after<span class="token punctuation">;</span>
<span class="token comment">// code ... 等 153 个支持链式调用的方法</span>

<span class="token comment">// Add methods to `lodash.prototype`.</span>
<span class="token comment">// 把lodash上的静态方法赋值到 lodash.prototype 上</span>
<span class="token function">mixin</span><span class="token punctuation">(</span>lodash<span class="token punctuation">,</span> lodash<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add methods that return unwrapped values in chain sequences.</span>
lodash<span class="token punctuation">.</span>add <span class="token operator">=</span> add<span class="token punctuation">;</span>
<span class="token comment">// code ... 等 152 个不支持链式调用的方法</span>


<span class="token comment">// 这里其实就是过滤 after 等支持链式调用的方法，获取到 lodash 上的 add 等 添加到lodash.prototype 上。</span>
<span class="token function">mixin</span><span class="token punctuation">(</span>lodash<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">var</span> source <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
 <span class="token comment">// baseForOwn 这里其实就是遍历lodash上的静态方法，执行回调函数</span>
 <span class="token function">baseForOwn</span><span class="token punctuation">(</span>lodash<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> methodName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 第一次 mixin 调用了所以赋值到了lodash.prototype</span>
  <span class="token comment">// 所以这里用 Object.hasOwnProperty 排除不在lodash.prototype 上的方法。也就是 add 等 152 个不支持链式调用的方法。</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>lodash<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> methodName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   source<span class="token punctuation">[</span>methodName<span class="token punctuation">]</span> <span class="token operator">=</span> func<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token comment">// 最后一个参数options 特意注明不支持链式调用</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string-property property">&#39;chain&#39;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>结合两次调用<code>mixin</code> 代入到源码解析如下</p><h3 id="mixin源码及注释" tabindex="-1"><a class="header-anchor" href="#mixin源码及注释" aria-hidden="true">#</a> mixin源码及注释</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mixin</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> source<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">// source 对象中可以枚举的属性</span>
 <span class="token keyword">var</span> props <span class="token operator">=</span> <span class="token function">keys</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// source 对象中的方法名称数组</span>
  methodNames <span class="token operator">=</span> <span class="token function">baseFunctions</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
  <span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>methodNames<span class="token punctuation">.</span>length <span class="token operator">||</span> <span class="token operator">!</span>props<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果 options 没传为 undefined  undefined == null 为true</span>
  <span class="token comment">// 且 如果source 不为 对象或者不是函数</span>
  <span class="token comment">// 且 source对象的函数函数长度 或者 source 对象的属性长度不为0</span>
  <span class="token comment">// 把 options 赋值为 source</span>
  options <span class="token operator">=</span> source<span class="token punctuation">;</span>
  <span class="token comment">// 把 source 赋值为 object</span>
  source <span class="token operator">=</span> object<span class="token punctuation">;</span>
  <span class="token comment">// 把 object 赋值为 this 也就是 _ (lodash)</span>
  object <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token comment">// 获取到所有的方法名称数组</span>
  methodNames <span class="token operator">=</span> <span class="token function">baseFunctions</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token function">keys</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">// 是否支持 链式调用</span>
 <span class="token comment">// options  不是对象或者不是函数，是null或者其他值</span>
 <span class="token comment">// 判断options是否是对象或者函数，如果不是或者函数则不会执行 &#39;chain&#39; in options 也就不会报错</span>
 <span class="token comment">//  且 chain 在 options的对象或者原型链中</span>
 <span class="token comment">// 知识点 in [MDN in :  https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/in</span>
 <span class="token comment">// 如果指定的属性在指定的对象或其原型链中，则in 运算符返回true。</span>

 <span class="token comment">// 或者 options.chain 转布尔值</span>
 <span class="token keyword">var</span> chain <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&#39;chain&#39;</span> <span class="token keyword">in</span> options<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>chain<span class="token punctuation">,</span>
  <span class="token comment">// object 是函数</span>
  isFunc <span class="token operator">=</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">// 循环 方法名称数组</span>
 <span class="token function">arrayEach</span><span class="token punctuation">(</span>methodNames<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">methodName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 函数本身</span>
  <span class="token keyword">var</span> func <span class="token operator">=</span> source<span class="token punctuation">[</span>methodName<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// object 通常是 lodash  也赋值这个函数。</span>
  object<span class="token punctuation">[</span>methodName<span class="token punctuation">]</span> <span class="token operator">=</span> func<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 如果object是函数 赋值到  object prototype  上，通常是lodash</span>
   object<span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>methodName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 实例上的__chain__ 属性 是否支持链式调用</span>
    <span class="token comment">// 这里的 this 是 new LodashWrapper 实例 类似如下</span>
    <span class="token doc-comment comment">/**
     <span class="token punctuation">{</span>
     __actions__: [],
     __chain__: true
     __index__: 0
     __values__: undefined
     __wrapped__: []
     <span class="token punctuation">}</span>
     **/</span>

    <span class="token keyword">var</span> chainAll <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__chain__<span class="token punctuation">;</span>
    <span class="token comment">// options 中的 chain 属性 是否支持链式调用</span>
    <span class="token comment">// 两者有一个符合链式调用  执行下面的代码</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>chain <span class="token operator">||</span> chainAll<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// 通常是 lodash</span>
     <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">object</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>__wrapped__<span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token comment">// 复制 实例上的 __action__ 到 result.__action__ 和 action 上</span>
     actions <span class="token operator">=</span> result<span class="token punctuation">.</span>__actions__ <span class="token operator">=</span> <span class="token function">copyArray</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>__actions__<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token comment">// action 添加 函数 和 args 和 this 指向，延迟计算调用。</span>
     actions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string-property property">&#39;func&#39;</span><span class="token operator">:</span> func<span class="token punctuation">,</span> <span class="token string-property property">&#39;args&#39;</span><span class="token operator">:</span> arguments<span class="token punctuation">,</span> <span class="token string-property property">&#39;thisArg&#39;</span><span class="token operator">:</span> object <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">//实例上的__chain__ 属性  赋值给 result 的 属性 __chain__</span>
     result<span class="token punctuation">.</span>__chain__ <span class="token operator">=</span> chainAll<span class="token punctuation">;</span>
     <span class="token comment">// 最后返回这个实例</span>
     <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 都不支持链式调用。直接调用</span>
    <span class="token comment">// 把当前实例的 value 和 arguments 对象 传递给 func 函数作为参数调用。返回调用结果。</span>
    <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> <span class="token function">arrayPush</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">// 最后返回对象 object</span>
 <span class="token keyword">return</span> object<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><div class="custom-container tip"><p class="custom-container-title">小结</p><p>简单说就是把<code>lodash</code>上的静态方法赋值到<code>lodash.prototype</code>上。分两次第一次是支持链式调用（<code>lodash.after</code>等 <code>153</code>个支持链式调用的方法），第二次是不支持链式调用的方法（<code>lodash.add</code>等<code>152</code>个不支持链式调用的方法）。</p></div><h2 id="lodash-究竟在-和-prototype挂载了多少方法和属性" tabindex="-1"><a class="header-anchor" href="#lodash-究竟在-和-prototype挂载了多少方法和属性" aria-hidden="true">#</a> lodash 究竟在_和_.prototype挂载了多少方法和属性</h2><p>再来看下<code>lodash</code>究竟挂载在<code>_</code>函数对象上有多少静态方法和属性，和挂载<code>_.prototype</code>上有多少方法和属性。</p><p>使用<code>for in</code>循环一试便知。看如下代码：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> staticMethods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> staticProperty <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> name <span class="token keyword">in</span> _<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> _<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  staticMethods<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">else</span><span class="token punctuation">{</span>
  staticProperty<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>staticProperty<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;templateSettings&quot;, &quot;VERSION&quot;] 2个</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>staticMethods<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;after&quot;, &quot;ary&quot;, &quot;assign&quot;, &quot;assignIn&quot;, &quot;assignInWith&quot;, ...] 305个</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>其实就是上文提及的 <code>lodash.after</code> 等<code>153</code>个支持链式调用的函数 、<code>lodash.add</code> 等 <code>152</code>不支持链式调用的函数赋值而来。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> prototypeMethods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> prototypeProperty <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> name <span class="token keyword">in</span> <span class="token class-name">_</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token class-name">_</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  prototypeMethods<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">else</span><span class="token punctuation">{</span>
  prototypeProperty<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prototypeProperty<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// []</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prototypeMethods<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;after&quot;, &quot;all&quot;, &quot;allKeys&quot;, &quot;any&quot;, &quot;assign&quot;, ...] 317个</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>相比<code>lodash</code>上的静态方法多了<code>12</code>个，说明除了 <code>mixin</code> 外，还有<code>12</code>个其他形式赋值而来。</p><p>支持链式调用的方法最后返回是实例对象，获取最后的处理的结果值，最后需要调用<code>value</code>方法。</p><img src="/technology/assets/designFrame/16d2fe47c4bd70d6_tplv-t2oaga2asx-watermark.awebp" alt="lodash的方法和属性挂载关系"><h2 id="请出贯穿下文的简单的例子" tabindex="-1"><a class="header-anchor" href="#请出贯穿下文的简单的例子" aria-hidden="true">#</a> 请出贯穿下文的简单的例子</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> result <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1, 2, 3</span>
 <span class="token keyword">return</span> el <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// lodash中这里的`map`仅执行了`3`次。</span>
<span class="token comment">// 具体功能也很简单 数组 1-5 加一，最后获取其中三个值。</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;result:&#39;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>也就是说这里<code>lodash</code>聪明的知道了最后需要几个值，就执行几次<code>map</code>循环，对于很大的数组，提升性能很有帮助。</strong></p><p>而<code>underscore</code>执行这段代码其中<code>map</code>执行了5次。 如果是平常实现该功能也简单。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> el <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;result:&#39;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>而相比<code>lodash</code>这里的<code>map</code>执行了<code>5</code>次。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 不使用 map、slice</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token string">&#39;result&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>简单说这里的<code>map</code>方法，添加 <code>LazyWrapper</code> 的方法到 <code>lodash.prototype</code>存储下来，最后调用 <code>value</code>时再调用。 具体看下文源码实现。</p><h2 id="添加-lazywrapper-的方法到-lodash-prototype" tabindex="-1"><a class="header-anchor" href="#添加-lazywrapper-的方法到-lodash-prototype" aria-hidden="true">#</a> 添加 LazyWrapper 的方法到 lodash.prototype</h2><p>主要是如下方法添加到到 <code>lodash.prototype</code> 原型上。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// &quot;constructor&quot;</span>
<span class="token punctuation">[</span><span class="token string">&quot;drop&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dropRight&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;take&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;takeRight&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;filter&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;takeWhile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;head&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;last&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;initial&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tail&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;compact&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;find&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;findLast&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;invokeMap&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;reject&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;slice&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;takeRightWhile&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;toArray&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;clone&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;reverse&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="源码-注释" tabindex="-1"><a class="header-anchor" href="#源码-注释" aria-hidden="true">#</a> 源码&amp;注释</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Add `LazyWrapper` methods to `lodash.prototype`.</span>
<span class="token comment">// baseForOwn 这里其实就是遍历LazyWrapper.prototype上的方法，执行回调函数</span>
<span class="token function">baseForOwn</span><span class="token punctuation">(</span><span class="token class-name">LazyWrapper</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> methodName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">// 检测函数名称是否是迭代器也就是循环</span>
 <span class="token keyword">var</span> checkIteratee <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(?:filter|find|map|reject)|While$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 检测函数名称是否head和last</span>
  <span class="token comment">// 顺便提一下 ()这个是捕获分组 而加上 ?:  则是非捕获分组 也就是说不用于其他操作</span>
  isTaker <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(?:head|last)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// lodashFunc 是 根据 isTaker 组合 takeRight take methodName</span>
  lodashFunc <span class="token operator">=</span> lodash<span class="token punctuation">[</span>isTaker <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token string">&#39;take&#39;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>methodName <span class="token operator">==</span> <span class="token string">&#39;last&#39;</span> <span class="token operator">?</span> <span class="token string">&#39;Right&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> methodName<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 根据isTaker 和 是 find 判断结果是否 包装</span>
  retUnwrapped <span class="token operator">=</span> isTaker <span class="token operator">||</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^find</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">// 如果不存在这个函数，就不往下执行</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lodashFunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">// 把 lodash.prototype 方法赋值到lodash.prototype</span>
 lodash<span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>methodName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 取实例中的__wrapped__ 值 例子中则是 [1,2,3,4,5]</span>
  <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__wrapped__<span class="token punctuation">,</span>
   <span class="token comment">// 如果是head和last 方法 isTaker 返回 [1], 否则是arguments对象</span>
   args <span class="token operator">=</span> isTaker <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> arguments<span class="token punctuation">,</span>
   <span class="token comment">// 如果value 是LayeWrapper的实例</span>
   isLazy <span class="token operator">=</span> value <span class="token keyword">instanceof</span> <span class="token class-name">LazyWrapper</span><span class="token punctuation">,</span>
   <span class="token comment">// 迭代器 循环</span>
   iteratee <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token comment">// 使用useLazy isLazy value或者是数组</span>
   useLazy <span class="token operator">=</span> isLazy <span class="token operator">||</span> <span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">interceptor</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 函数执行 value args 组合成数组参数</span>
   <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">lodashFunc</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>lodash<span class="token punctuation">,</span> <span class="token function">arrayPush</span><span class="token punctuation">(</span><span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 如果是 head 和 last (isTaker) 支持链式调用 返回结果的第一个参数 否则 返回result</span>
   <span class="token keyword">return</span> <span class="token punctuation">(</span>isTaker <span class="token operator">&amp;&amp;</span> chainAll<span class="token punctuation">)</span> <span class="token operator">?</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// useLazy true 并且 函数checkIteratee 且迭代器是函数，且迭代器参数个数不等于1</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>useLazy <span class="token operator">&amp;&amp;</span> checkIteratee <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> iteratee <span class="token operator">==</span> <span class="token string">&#39;function&#39;</span> <span class="token operator">&amp;&amp;</span> iteratee<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// Avoid lazy use if the iteratee has a &quot;length&quot; value other than `1`.</span>
   <span class="token comment">// useLazy 赋值为 false</span>
   <span class="token comment">// isLazy 赋值为 false</span>
   isLazy <span class="token operator">=</span> useLazy <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 取实例上的 __chain__</span>
  <span class="token keyword">var</span> chainAll <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__chain__<span class="token punctuation">,</span>
   <span class="token comment">// 存储的待执行的函数 __actions__ 二次取反是布尔值 也就是等于0或者大于0两种结果</span>
   isHybrid <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>__actions__<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
   <span class="token comment">// 是否不包装 用结果是否不包装 且 不支持链式调用</span>
   isUnwrapped <span class="token operator">=</span> retUnwrapped <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>chainAll<span class="token punctuation">,</span>
   <span class="token comment">// 是否仅Lazy 用isLazy 和 存储的函数</span>
   onlyLazy <span class="token operator">=</span> isLazy <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isHybrid<span class="token punctuation">;</span>

  <span class="token comment">// 结果不包装 且 useLazy 为 true</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>retUnwrapped <span class="token operator">&amp;&amp;</span> useLazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 实例 new LazyWrapper 这里的this 是 new LodashWrapper()</span>
   value <span class="token operator">=</span> onlyLazy <span class="token operator">?</span> value <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">LazyWrapper</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// result 执行函数结果</span>
   <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">/*
   *
   // _.thru(value, interceptor)
   // 这个方法类似 _.tap， 除了它返回 interceptor 的返回结果。该方法的目的是&quot;传递&quot; 值到一个方法链序列以取代中间结果。
   _([1, 2, 3])
   .tap(function(array) {
    // 改变传入的数组
    array.pop();
   })
   .reverse()
   .value();
   // =&gt; [2, 1]
   */</span>

   <span class="token comment">// thisArg 指向undefined 或者null 非严格模式下是指向window，严格模式是undefined 或者nll</span>
   result<span class="token punctuation">.</span>__actions__<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string-property property">&#39;func&#39;</span><span class="token operator">:</span> thru<span class="token punctuation">,</span> <span class="token string-property property">&#39;args&#39;</span><span class="token operator">:</span> <span class="token punctuation">[</span>interceptor<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string-property property">&#39;thisArg&#39;</span><span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 返回实例 lodashWrapper</span>
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LodashWrapper</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> chainAll<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 不包装 且 onlyLazy 为 true</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isUnwrapped <span class="token operator">&amp;&amp;</span> onlyLazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 执行函数</span>
   <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 上面都没有执行，执行到这里了</span>
  <span class="token comment">// 执行 thru 函数，回调函数 是 interceptor</span>
  result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">thru</span><span class="token punctuation">(</span>interceptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> isUnwrapped <span class="token operator">?</span> <span class="token punctuation">(</span>isTaker <span class="token operator">?</span> result<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> result<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> result<span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br></div></div><div class="custom-container tip"><p class="custom-container-title">小结</p><p>其实就是用<code>LazyWrapper.prototype</code> 改写原先在<code>lodash.prototype</code>的函数，判断函数是否需要使用惰性求值，需要时再调用。</p></div><h3 id="例子的chain和map执行后的debugger截图" tabindex="-1"><a class="header-anchor" href="#例子的chain和map执行后的debugger截图" aria-hidden="true">#</a> 例子的chain和map执行后的debugger截图</h3><img src="/technology/assets/designFrame/16d1965d6ddb9fad_tplv-t2oaga2asx-watermark.awebp" alt="demo"><h3 id="例子的chain和map执行后的结果截图" tabindex="-1"><a class="header-anchor" href="#例子的chain和map执行后的结果截图" aria-hidden="true">#</a> 例子的chain和map执行后的结果截图</h3><img src="/technology/assets/designFrame/16d19661e13803e4_tplv-t2oaga2asx-watermark.awebp" alt="demo"><p>链式调用最后都是返回实例对象，实际的处理数据的函数都没有调用，而是被存储存储下来了，最后调用<code>value</code>方法，才执行这些函数。</p><h2 id="lodash-prototype-value-即-wrappervalue" tabindex="-1"><a class="header-anchor" href="#lodash-prototype-value-即-wrappervalue" aria-hidden="true">#</a> lodash.prototype.value 即 wrapperValue</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">baseWrapperValue</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> actions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">var</span> result <span class="token operator">=</span> value<span class="token punctuation">;</span>
 <span class="token comment">// 如果是lazyWrapper的实例，则调用LazyWrapper.prototype.value 方法，也就是 lazyValue 方法</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">LazyWrapper</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  result <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">// 类似 [].reduce()，把上一个函数返回结果作为参数传递给下一个函数</span>
 <span class="token keyword">return</span> <span class="token function">arrayReduce</span><span class="token punctuation">(</span>actions<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> action<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>thisArg<span class="token punctuation">,</span> <span class="token function">arrayPush</span><span class="token punctuation">(</span><span class="token punctuation">[</span>result<span class="token punctuation">]</span><span class="token punctuation">,</span> action<span class="token punctuation">.</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">wrapperValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token function">baseWrapperValue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>__wrapped__<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__actions__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
lodash<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toJSON <span class="token operator">=</span> lodash<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>valueOf <span class="token operator">=</span> lodash<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>value <span class="token operator">=</span> wrapperValue<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>如果是惰性求值，则调用的是 <code>LazyWrapper.prototype.value</code> 即 <code>lazyValue</code>。</p><h2 id="lazywrapper-prototype-value-即-lazyvalue-惰性求值" tabindex="-1"><a class="header-anchor" href="#lazywrapper-prototype-value-即-lazyvalue-惰性求值" aria-hidden="true">#</a> LazyWrapper.prototype.value 即 lazyValue 惰性求值</h2><h3 id="lazyvalue源码及注释" tabindex="-1"><a class="header-anchor" href="#lazyvalue源码及注释" aria-hidden="true">#</a> <code>lazyValue</code>源码及注释</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">LazyWrapper</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">// 参数 value</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>__wrapped__ <span class="token operator">=</span> value<span class="token punctuation">;</span>
 <span class="token comment">// 执行的函数</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>__actions__ <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>__dir__ <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
 <span class="token comment">// 过滤</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>__filtered__ <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
 <span class="token comment">// 存储迭代器函数</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>__iteratees__ <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token comment">// 默认最大取值个数</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>__takeCount__ <span class="token operator">=</span> <span class="token constant">MAX_ARRAY_LENGTH</span><span class="token punctuation">;</span>
 <span class="token comment">// 具体取值多少个，存储函数和类型</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>__views__ <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
* Extracts the unwrapped value from its lazy wrapper.
*
* <span class="token keyword">@private</span>
* <span class="token keyword">@name</span> value
* <span class="token keyword">@memberOf</span> LazyWrapper
* <span class="token keyword">@returns</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> Returns the unwrapped value.
*/</span>
<span class="token keyword">function</span> <span class="token function">lazyValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">// this.__wrapped__ 是 new LodashWrapper 实例 所以执行.value 获取原始值</span>
 <span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__wrapped__<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">//</span>
  dir <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__dir__<span class="token punctuation">,</span>
  <span class="token comment">// 是否是函数</span>
  isArr <span class="token operator">=</span> <span class="token function">isArray</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 是否从右边开始</span>
  isRight <span class="token operator">=</span> dir <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token comment">// 数组的长度。如果不是数组，则是0</span>
  arrLength <span class="token operator">=</span> isArr <span class="token operator">?</span> array<span class="token punctuation">.</span>length <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token comment">// 获取 take(3) 上述例子中 则是 start: 0，end: 3</span>
  view <span class="token operator">=</span> <span class="token function">getView</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> arrLength<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__views__<span class="token punctuation">)</span><span class="token punctuation">,</span>
  start <span class="token operator">=</span> view<span class="token punctuation">.</span>start<span class="token punctuation">,</span>
  end <span class="token operator">=</span> view<span class="token punctuation">.</span>end<span class="token punctuation">,</span>
  <span class="token comment">// 长度 3</span>
  length <span class="token operator">=</span> end <span class="token operator">-</span> start<span class="token punctuation">,</span>
  <span class="token comment">// 如果是是从右开始</span>
  index <span class="token operator">=</span> isRight <span class="token operator">?</span> end <span class="token operator">:</span> <span class="token punctuation">(</span>start <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 存储的迭代器数组</span>
  iteratees <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__iteratees__<span class="token punctuation">,</span>
  <span class="token comment">// 迭代器数组长度</span>
  iterLength <span class="token operator">=</span> iteratees<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
  <span class="token comment">// 结果resIndex</span>
  resIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token comment">// 最后获取几个值，也就是 3</span>
  takeCount <span class="token operator">=</span> <span class="token function">nativeMin</span><span class="token punctuation">(</span>length<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__takeCount__<span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">// 如果不是数组，或者 不是从右开始 并且 参数数组长度等于take的长度 takeCount等于长度</span>
 <span class="token comment">// 则直接调用 baseWrapperValue 不需要</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isArr <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRight <span class="token operator">&amp;&amp;</span> arrLength <span class="token operator">==</span> length <span class="token operator">&amp;&amp;</span> takeCount <span class="token operator">==</span> length<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">baseWrapperValue</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__actions__<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

 <span class="token comment">// 标签语句 label</span>
 <span class="token comment">// MDN label 链接</span>
 <span class="token comment">// https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/label</span>
 <span class="token comment">// 标记语句可以和 break 或 continue 语句一起使用。标记就是在一条语句前面加个可以引用的标识符（identifier）。</span>
 <span class="token literal-property property">outer</span><span class="token operator">:</span>
 <span class="token keyword">while</span> <span class="token punctuation">(</span>length<span class="token operator">--</span> <span class="token operator">&amp;&amp;</span> resIndex <span class="token operator">&lt;</span> takeCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  index <span class="token operator">+=</span> dir<span class="token punctuation">;</span>

  <span class="token keyword">var</span> iterIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
   <span class="token comment">// 数组第一项</span>
   value <span class="token operator">=</span> array<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">++</span>iterIndex <span class="token operator">&lt;</span> iterLength<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 迭代器数组 {iteratee: function{}, typy: 2}</span>
   <span class="token keyword">var</span> data <span class="token operator">=</span> iteratees<span class="token punctuation">[</span>iterIndex<span class="token punctuation">]</span><span class="token punctuation">,</span>
    iteratee <span class="token operator">=</span> data<span class="token punctuation">.</span>iteratee<span class="token punctuation">,</span>
    type <span class="token operator">=</span> data<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
    <span class="token comment">// 结果 迭代器执行结果</span>
    computed <span class="token operator">=</span> <span class="token function">iteratee</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token constant">LAZY_MAP_FLAG</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果 type 是 map 类型，结果 computed 赋值给value</span>
    value <span class="token operator">=</span> computed<span class="token punctuation">;</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token constant">LAZY_FILTER_FLAG</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// 退出当前这次循环，进行下一次循环</span>
     <span class="token keyword">continue</span> outer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
     <span class="token comment">// 退出整个循环</span>
     <span class="token keyword">break</span> outer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 最终数组</span>
  result<span class="token punctuation">[</span>resIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">// 返回数组 例子中则是 [2, 3, 4]</span>
 <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Ensure `LazyWrapper` is an instance of `baseLodash`.</span>
<span class="token class-name">LazyWrapper</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token function">baseCreate</span><span class="token punctuation">(</span>baseLodash<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">LazyWrapper</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> LazyWrapper<span class="token punctuation">;</span>

<span class="token class-name">LazyWrapper</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>value <span class="token operator">=</span> lazyValue<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br></div></div><img src="/technology/assets/designFrame/16d1966cbe76d7c9_tplv-t2oaga2asx-watermark.awebp" alt="lodash和LazyWrapper的关系图"><div class="custom-container tip"><p class="custom-container-title">小结</p><p><code>lazyValue</code>简单说实现的功能就是把之前记录的需要执行几次，把记录存储的函数执行几次，不会有多少项数据就执行多少次，而是根据需要几项，执行几项。 也就是说以下这个例子中，<code>map</code>函数只会执行<code>3</code>次。如果没有用惰性求值，那么<code>map</code>函数会执行<code>5</code>次。</p></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> result <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> el <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><blockquote><p>文章主要学习了<code>runInContext()</code> 导出<code>_lodash</code>函数使用<code>baseCreate</code>方法原型继承<code>LodashWrapper</code>和<code>LazyWrapper</code>，<code>mixin</code>挂载方法到<code>lodash.prototype</code>、后文用结合例子解释<code>lodash.prototype.value(wrapperValue)</code>和<code>Lazy.prototype.value(lazyValue)</code>惰性求值的源码具体实现。</p></blockquote><p><strong>分享一个只知道函数名找源码定位函数申明位置的<code>VSCode</code> 技巧</strong>：<code>Ctrl + p</code>。输入 <code>@functionName</code> 定位函数<code>functionName</code>在源码文件中的具体位置。如果知道调用位置，那直接按<code>alt+鼠标左键</code>即可跳转到函数申明的位置。</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 87403071+dean-57blocks@users.noreply.github.com">dean-57blocks</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/technology/designFrame/createUnderscore.html" class="" aria-label="underscore 系列之如何写自己的 underscore"><!--[--><!--]--> underscore 系列之如何写自己的 underscore <!--[--><!--]--></a></span><span class="next"><a href="/technology/designFrame/sentry.html" class="" aria-label="sentry 源码整体架构"><!--[--><!--]--> sentry 源码整体架构 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/technology/assets/app.ba47fc91.js" defer></script>
  </body>
</html>
