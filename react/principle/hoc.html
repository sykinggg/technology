<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title></title><meta name="description" content="君子藏器于身 待时而动 天下有道则见 无道则隐">
    <link rel="modulepreload" href="/technology/assets/app.ee3fc36b.js"><link rel="modulepreload" href="/technology/assets/hoc.html.b78fb514.js"><link rel="modulepreload" href="/technology/assets/hoc.html.6da5ab6d.js"><link rel="modulepreload" href="/technology/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/technology/assets/style.5f6eabfb.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/technology/" class=""><img class="logo" src="https://vuejs.org/images/logo.png" alt><!----></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="技术"><span class="title">技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="技术"><span class="title">技术</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/technology/base.md" class="" aria-label="技术前瞻"><!--[--><!--]--> 技术前瞻 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="js"><span class="title">js</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="js"><span class="title">js</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/mozillajs/baseObject/symbol.md" class="" aria-label="mozilla：基本对象"><!--[--><!--]--> mozilla：基本对象 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/jsInterview/baseInterview.md" class="" aria-label="基础面试题"><!--[--><!--]--> 基础面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/js/stack/executionStack.md" class="" aria-label="js 概念"><!--[--><!--]--> js 概念 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/ts/jsx/support" class="" aria-label="JSX"><!--[--><!--]--> JSX <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/ts/project/inDepthTs.md" class="" aria-label="TypeScript 项目"><!--[--><!--]--> TypeScript 项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/jsNews/es6News.md" class="" aria-label="js 新概念"><!--[--><!--]--> js 新概念 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="css"><span class="title">css</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="css"><span class="title">css</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/mozillaCss/reference/universalSelectors.md" class="" aria-label="第 1 期：CSS API"><!--[--><!--]--> 第 1 期：CSS API <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/css/interview/baseCss.md" class="" aria-label="零散记录"><!--[--><!--]--> 零散记录 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="html"><span class="title">html</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="html"><span class="title">html</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/html/interview/linkImport.md" class="" aria-label="零散记录"><!--[--><!--]--> 零散记录 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="端"><span class="title">端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="端"><span class="title">端</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/browser/interview/baseInterview.md" class="" aria-label="基础浏览器"><!--[--><!--]--> 基础浏览器 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/http/interview/baseInterview.md" class="" aria-label="基础http"><!--[--><!--]--> 基础http <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工具"><span class="title">工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工具"><span class="title">工具</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/webpack/interview/webpackInterview.md" class="" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/esbuild/description.md" class="" aria-label="esbuild"><!--[--><!--]--> esbuild <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/rollup/introduction.md" class="" aria-label="rollup"><!--[--><!--]--> rollup <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/git/indx.md" class="" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/nginx/base.md" class="" aria-label="nginx"><!--[--><!--]--> nginx <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/cli/base.md" class="" aria-label="cli"><!--[--><!--]--> cli <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/npm/commonlyUsed.md" class="" aria-label="npm"><!--[--><!--]--> npm <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="react"><span class="title">react</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="react"><span class="title">react</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/ILoveDevelop/react/principle/base.md" class="" aria-label="react 源码阅读 代码视角"><!--[--><!--]--> react 源码阅读 代码视角 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/react/preparation/idea.md" class="" aria-label="react 源码阅读 思想视角"><!--[--><!--]--> react 源码阅读 思想视角 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/react-illustration-series/main/macro-structure.md" class="" aria-label="图解React源码"><!--[--><!--]--> 图解React源码 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/umi/interview/pluginDva.md" class="" aria-label="umi"><!--[--><!--]--> umi <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/reactInterview/interview1.md" class="" aria-label="整理"><!--[--><!--]--> 整理 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="vue"><span class="title">vue</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="vue"><span class="title">vue</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/vue/prepare/flow.md" class="" aria-label="第 1 期：源码解读-准备工作"><!--[--><!--]--> 第 1 期：源码解读-准备工作 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/data-driven/_index.md" class="" aria-label="第2期：源码解读-数据驱动"><!--[--><!--]--> 第2期：源码解读-数据驱动 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/components/create-component.md" class="" aria-label="第3期：源码解读-组件化"><!--[--><!--]--> 第3期：源码解读-组件化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/reactive/reactive-object.md" class="" aria-label="第4期：源码解读-深入响应式原理"><!--[--><!--]--> 第4期：源码解读-深入响应式原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/compile/entrance.md" class="" aria-label="第5期：源码解读-编译"><!--[--><!--]--> 第5期：源码解读-编译 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/extend/event.md" class="" aria-label="第6期：源码解读-扩展"><!--[--><!--]--> 第6期：源码解读-扩展 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/vue-router/install.md" class="" aria-label="第7期：源码解读-VueRouter"><!--[--><!--]--> 第7期：源码解读-VueRouter <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/vuex/idex.md" class="" aria-label="第8期：源码解读-Vuex"><!--[--><!--]--> 第8期：源码解读-Vuex <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/interview/baseInterview.md" class="" aria-label="第9期：基础面试题"><!--[--><!--]--> 第9期：基础面试题 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="性能优化"><span class="title">性能优化</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="性能优化"><span class="title">性能优化</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/performance/vue/vue2Base.md" class="" aria-label="vue-性能优化"><!--[--><!--]--> vue-性能优化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/performance/react/reactBase.md" class="" aria-label="react-性能优化"><!--[--><!--]--> react-性能优化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/performance/base/drag1.md" class="" aria-label="组件设计"><!--[--><!--]--> 组件设计 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法&amp;设计"><span class="title">算法&amp;设计</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法&amp;设计"><span class="title">算法&amp;设计</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/algorithm/interview/baseInterview.md" class="" aria-label="第 1 期：基础面试题"><!--[--><!--]--> 第 1 期：基础面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/design/overview.md" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/designFrame/jquery.md" class="" aria-label="设计应用"><!--[--><!--]--> 设计应用 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="技术"><span class="title">技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="技术"><span class="title">技术</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/technology/base.md" class="" aria-label="技术前瞻"><!--[--><!--]--> 技术前瞻 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="js"><span class="title">js</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="js"><span class="title">js</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/mozillajs/baseObject/symbol.md" class="" aria-label="mozilla：基本对象"><!--[--><!--]--> mozilla：基本对象 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/jsInterview/baseInterview.md" class="" aria-label="基础面试题"><!--[--><!--]--> 基础面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/js/stack/executionStack.md" class="" aria-label="js 概念"><!--[--><!--]--> js 概念 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/ts/jsx/support" class="" aria-label="JSX"><!--[--><!--]--> JSX <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/ts/project/inDepthTs.md" class="" aria-label="TypeScript 项目"><!--[--><!--]--> TypeScript 项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/jsNews/es6News.md" class="" aria-label="js 新概念"><!--[--><!--]--> js 新概念 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="css"><span class="title">css</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="css"><span class="title">css</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/mozillaCss/reference/universalSelectors.md" class="" aria-label="第 1 期：CSS API"><!--[--><!--]--> 第 1 期：CSS API <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/css/interview/baseCss.md" class="" aria-label="零散记录"><!--[--><!--]--> 零散记录 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="html"><span class="title">html</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="html"><span class="title">html</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/html/interview/linkImport.md" class="" aria-label="零散记录"><!--[--><!--]--> 零散记录 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="端"><span class="title">端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="端"><span class="title">端</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/browser/interview/baseInterview.md" class="" aria-label="基础浏览器"><!--[--><!--]--> 基础浏览器 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/http/interview/baseInterview.md" class="" aria-label="基础http"><!--[--><!--]--> 基础http <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工具"><span class="title">工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工具"><span class="title">工具</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/webpack/interview/webpackInterview.md" class="" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/esbuild/description.md" class="" aria-label="esbuild"><!--[--><!--]--> esbuild <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/rollup/introduction.md" class="" aria-label="rollup"><!--[--><!--]--> rollup <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/git/indx.md" class="" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/nginx/base.md" class="" aria-label="nginx"><!--[--><!--]--> nginx <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/cli/base.md" class="" aria-label="cli"><!--[--><!--]--> cli <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/npm/commonlyUsed.md" class="" aria-label="npm"><!--[--><!--]--> npm <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="react"><span class="title">react</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="react"><span class="title">react</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/ILoveDevelop/react/principle/base.md" class="" aria-label="react 源码阅读 代码视角"><!--[--><!--]--> react 源码阅读 代码视角 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/react/preparation/idea.md" class="" aria-label="react 源码阅读 思想视角"><!--[--><!--]--> react 源码阅读 思想视角 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/react-illustration-series/main/macro-structure.md" class="" aria-label="图解React源码"><!--[--><!--]--> 图解React源码 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/umi/interview/pluginDva.md" class="" aria-label="umi"><!--[--><!--]--> umi <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/reactInterview/interview1.md" class="" aria-label="整理"><!--[--><!--]--> 整理 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="vue"><span class="title">vue</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="vue"><span class="title">vue</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/vue/prepare/flow.md" class="" aria-label="第 1 期：源码解读-准备工作"><!--[--><!--]--> 第 1 期：源码解读-准备工作 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/data-driven/_index.md" class="" aria-label="第2期：源码解读-数据驱动"><!--[--><!--]--> 第2期：源码解读-数据驱动 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/components/create-component.md" class="" aria-label="第3期：源码解读-组件化"><!--[--><!--]--> 第3期：源码解读-组件化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/reactive/reactive-object.md" class="" aria-label="第4期：源码解读-深入响应式原理"><!--[--><!--]--> 第4期：源码解读-深入响应式原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/compile/entrance.md" class="" aria-label="第5期：源码解读-编译"><!--[--><!--]--> 第5期：源码解读-编译 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/extend/event.md" class="" aria-label="第6期：源码解读-扩展"><!--[--><!--]--> 第6期：源码解读-扩展 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/vue-router/install.md" class="" aria-label="第7期：源码解读-VueRouter"><!--[--><!--]--> 第7期：源码解读-VueRouter <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/vuex/idex.md" class="" aria-label="第8期：源码解读-Vuex"><!--[--><!--]--> 第8期：源码解读-Vuex <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/vue/interview/baseInterview.md" class="" aria-label="第9期：基础面试题"><!--[--><!--]--> 第9期：基础面试题 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="性能优化"><span class="title">性能优化</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="性能优化"><span class="title">性能优化</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/performance/vue/vue2Base.md" class="" aria-label="vue-性能优化"><!--[--><!--]--> vue-性能优化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/performance/react/reactBase.md" class="" aria-label="react-性能优化"><!--[--><!--]--> react-性能优化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/performance/base/drag1.md" class="" aria-label="组件设计"><!--[--><!--]--> 组件设计 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法&amp;设计"><span class="title">算法&amp;设计</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法&amp;设计"><span class="title">算法&amp;设计</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/algorithm/interview/baseInterview.md" class="" aria-label="第 1 期：基础面试题"><!--[--><!--]--> 第 1 期：基础面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/design/overview.md" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/designFrame/jquery.md" class="" aria-label="设计应用"><!--[--><!--]--> 设计应用 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">第 1 期：React理念 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/technology/react/preparation/idea.md" class="sidebar-item" aria-label="React理念"><!--[--><!--]--> React理念 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/preparation/oldConstructure.md" class="sidebar-item" aria-label="老的React架构"><!--[--><!--]--> 老的React架构 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/preparation/newConstructure.md" class="sidebar-item" aria-label="新的React架构"><!--[--><!--]--> 新的React架构 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/process/fiber-mental.md" class="sidebar-item" aria-label="Fiber架构的心智模型"><!--[--><!--]--> Fiber架构的心智模型 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/process/fiber.md" class="sidebar-item" aria-label="Fiber架构的实现原理"><!--[--><!--]--> Fiber架构的实现原理 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/process/doubleBuffer.md" class="sidebar-item" aria-label="Fiber架构的工作原理"><!--[--><!--]--> Fiber架构的工作原理 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/preparation/summary.md" class="sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">第2期：前置知识 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/technology/react/preparation/file.md" class="sidebar-item" aria-label="源码的文件结构"><!--[--><!--]--> 源码的文件结构 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/preparation/source.md" class="sidebar-item" aria-label="调试源码"><!--[--><!--]--> 调试源码 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/preparation/jsx.md" class="sidebar-item" aria-label="深入理解JSX"><!--[--><!--]--> 深入理解JSX <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">第3期：render阶段 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/technology/react/process/reconciler.md" class="sidebar-item" aria-label="流程概览"><!--[--><!--]--> 流程概览 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/process/beginWork.md" class="sidebar-item" aria-label="beginWork"><!--[--><!--]--> beginWork <!--[--><!--]--></a><!----></li><li><a href="/technology/react/process/completeWork.md" class="sidebar-item" aria-label="completeWork"><!--[--><!--]--> completeWork <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">第4期：commit阶段 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/technology/react/renderer/prepare.md" class="sidebar-item" aria-label="流程概览"><!--[--><!--]--> 流程概览 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/renderer/beforeMutation.md" class="sidebar-item" aria-label="beforemutation阶段"><!--[--><!--]--> beforemutation阶段 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/renderer/mutation.md" class="sidebar-item" aria-label="mutation阶段"><!--[--><!--]--> mutation阶段 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/renderer/layout.md" class="sidebar-item" aria-label="layout阶段"><!--[--><!--]--> layout阶段 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">第5期：Diff算法 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/technology/react/diff/prepare.md" class="sidebar-item" aria-label="概览"><!--[--><!--]--> 概览 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/diff/one.md" class="sidebar-item" aria-label="单节点Diff"><!--[--><!--]--> 单节点Diff <!--[--><!--]--></a><!----></li><li><a href="/technology/react/diff/multi.md" class="sidebar-item" aria-label="多节点Diff"><!--[--><!--]--> 多节点Diff <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">第6期：状态更新 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/technology/react/state/prepare.md" class="sidebar-item" aria-label="流程概览"><!--[--><!--]--> 流程概览 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/state/mental.md" class="sidebar-item" aria-label="心智模型"><!--[--><!--]--> 心智模型 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/state/update.md" class="sidebar-item" aria-label="Update"><!--[--><!--]--> Update <!--[--><!--]--></a><!----></li><li><a href="/technology/react/state/priority.md" class="sidebar-item" aria-label="深入理解优先级"><!--[--><!--]--> 深入理解优先级 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/state/reactdom.md" class="sidebar-item" aria-label="ReactDOM.render"><!--[--><!--]--> ReactDOM.render <!--[--><!--]--></a><!----></li><li><a href="/technology/react/state/setstate.md" class="sidebar-item" aria-label="this.setState"><!--[--><!--]--> this.setState <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">第7期：Hooks <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/technology/react/hooks/prepare.md" class="sidebar-item" aria-label="Hooks理念"><!--[--><!--]--> Hooks理念 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/hooks/create.md" class="sidebar-item" aria-label="极简Hooks实现"><!--[--><!--]--> 极简Hooks实现 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/hooks/structure.md" class="sidebar-item" aria-label="Hooks数据结构"><!--[--><!--]--> Hooks数据结构 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/hooks/usestate.md" class="sidebar-item" aria-label="useState与useReducer"><!--[--><!--]--> useState与useReducer <!--[--><!--]--></a><!----></li><li><a href="/technology/react/hooks/useeffect.md" class="sidebar-item" aria-label="useEffect"><!--[--><!--]--> useEffect <!--[--><!--]--></a><!----></li><li><a href="/technology/react/hooks/useref.md" class="sidebar-item" aria-label="useRef"><!--[--><!--]--> useRef <!--[--><!--]--></a><!----></li><li><a href="/technology/react/hooks/usememo.md" class="sidebar-item" aria-label="useMemo与useCallback"><!--[--><!--]--> useMemo与useCallback <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">第8期：ConcurrentMode <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/technology/react/concurrent/prepare.md" class="sidebar-item" aria-label="概览"><!--[--><!--]--> 概览 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/concurrent/scheduler.md" class="sidebar-item" aria-label="Scheduler的原理与实现"><!--[--><!--]--> Scheduler的原理与实现 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/concurrent/lane.md" class="sidebar-item" aria-label="lane模型"><!--[--><!--]--> lane模型 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/concurrent/componentWillXXX.md" class="sidebar-item" aria-label="深入源码剖析componentWillXXX为什么UNSAFE"><!--[--><!--]--> 深入源码剖析componentWillXXX为什么UNSAFE <!--[--><!--]--></a><!----></li><li><a href="/technology/react/concurrent/redux.html" class="sidebar-item" aria-label="redux 源码解读"><!--[--><!--]--> redux 源码解读 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">第9期：基础概念 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/technology/react/principle/basePrinciple.md" class="sidebar-item" aria-label="概述"><!--[--><!--]--> 概述 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/principle/componentApi.md" class="sidebar-item" aria-label="组件类-api"><!--[--><!--]--> 组件类-api <!--[--><!--]--></a><!----></li><li><a href="/technology/react/principle/toolApi.md" class="sidebar-item" aria-label="工具类-api"><!--[--><!--]--> 工具类-api <!--[--><!--]--></a><!----></li><li><a href="/technology/react/principle/hookApi.md" class="sidebar-item" aria-label="hooks-api"><!--[--><!--]--> hooks-api <!--[--><!--]--></a><!----></li><li><a href="/technology/react/principle/domApi.md" class="sidebar-item" aria-label="react-dom-api"><!--[--><!--]--> react-dom-api <!--[--><!--]--></a><!----></li><li><a href="/technology/react/principle/hookUse.md" class="sidebar-item" aria-label="react-hook使用"><!--[--><!--]--> react-hook使用 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/principle/hookCustom.md" class="sidebar-item" aria-label="react-hook自定义"><!--[--><!--]--> react-hook自定义 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/principle/hookPrinciple.md" class="sidebar-item" aria-label="react-hook原理"><!--[--><!--]--> react-hook原理 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/principle/hoc.md" class="sidebar-item active" aria-label="深入hoc"><!--[--><!--]--> 深入hoc <!--[--><!--]--></a><!----></li><li><a href="/technology/react/principle/reactRedux.md" class="sidebar-item" aria-label="React-redux源码"><!--[--><!--]--> React-redux源码 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/principle/reactKeeplive.md" class="sidebar-item" aria-label="react缓存页面"><!--[--><!--]--> react缓存页面 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/principle/reactRouter.md" class="sidebar-item" aria-label="react-router路由原理"><!--[--><!--]--> react-router路由原理 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">第10期：基础面试题 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/technology/react/interview/50/interview1.md" class="sidebar-item" aria-label="什么时候使用状态管理器?"><!--[--><!--]--> 什么时候使用状态管理器? <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview2.md" class="sidebar-item" aria-label="render函数中return如果没有使用()会有什么问题?"><!--[--><!--]--> render函数中return如果没有使用()会有什么问题? <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview3.md" class="sidebar-item" aria-label="componentWillUpdate可以直接修改state的值吗?"><!--[--><!--]--> componentWillUpdate可以直接修改state的值吗? <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview4.md" class="sidebar-item" aria-label="说说对React的渲染原理的理解?"><!--[--><!--]--> 说说对React的渲染原理的理解? <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview5.md" class="sidebar-item" aria-label="什么渲染劫持？"><!--[--><!--]--> 什么渲染劫持？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview6.md" class="sidebar-item" aria-label="ReactIntl？"><!--[--><!--]--> ReactIntl？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview7.md" class="sidebar-item" aria-label="Context？"><!--[--><!--]--> Context？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview12.md" class="sidebar-item" aria-label="Context实例？"><!--[--><!--]--> Context实例？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview8.md" class="sidebar-item" aria-label="RenderProps？"><!--[--><!--]--> RenderProps？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview9.md" class="sidebar-item" aria-label="高阶组件？"><!--[--><!--]--> 高阶组件？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview10.md" class="sidebar-item" aria-label="Refs转发？"><!--[--><!--]--> Refs转发？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview11.md" class="sidebar-item" aria-label="React顶层API？"><!--[--><!--]--> React顶层API？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview13.md" class="sidebar-item" aria-label="contextType？"><!--[--><!--]--> contextType？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview14.md" class="sidebar-item" aria-label="除了实例的属性可以获取Context外哪些地方还能直接获取Context？"><!--[--><!--]--> 除了实例的属性可以获取Context外哪些地方还能直接获取Context？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview15.md" class="sidebar-item" aria-label="Consumer？"><!--[--><!--]--> Consumer？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview16.md" class="sidebar-item" aria-label="windowing？"><!--[--><!--]--> windowing？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview17.md" class="sidebar-item" aria-label="ReactDOM-React的插槽(Portals)？"><!--[--><!--]--> ReactDOM-React的插槽(Portals)？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview18.md" class="sidebar-item" aria-label="React的插槽(Portals)？"><!--[--><!--]--> React的插槽(Portals)？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview19.md" class="sidebar-item" aria-label="构造函数？"><!--[--><!--]--> 构造函数？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview20.md" class="sidebar-item" aria-label="React拆分组件？"><!--[--><!--]--> React拆分组件？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview21.md" class="sidebar-item" aria-label="React的严格模式？"><!--[--><!--]--> React的严格模式？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview22.md" class="sidebar-item" aria-label="relay？"><!--[--><!--]--> relay？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview23.md" class="sidebar-item" aria-label="捕获错误？"><!--[--><!--]--> 捕获错误？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview24" class="sidebar-item" aria-label="如果组件的属性没有传值，那么它的默认值是什么？"><!--[--><!--]--> 如果组件的属性没有传值，那么它的默认值是什么？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview25.md" class="sidebar-item" aria-label="React的表单库？"><!--[--><!--]--> React的表单库？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview26.md" class="sidebar-item" aria-label="suspense组件？"><!--[--><!--]--> suspense组件？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview27.md" class="sidebar-item" aria-label="`super()`和`super(props)`？"><!--[--><!--]--> `super()`和`super(props)`？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview28.md" class="sidebar-item" aria-label="动态导入组件？"><!--[--><!--]--> 动态导入组件？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview29.md" class="sidebar-item" aria-label="给非控组件设置默认的值？"><!--[--><!--]--> 给非控组件设置默认的值？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview30.md" class="sidebar-item" aria-label="使用Hooks获取服务端数据？"><!--[--><!--]--> 使用Hooks获取服务端数据？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview31.md" class="sidebar-item" aria-label="render方法的原理？"><!--[--><!--]--> render方法的原理？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview32.md" class="sidebar-item" aria-label="使用Hooks？"><!--[--><!--]--> 使用Hooks？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview33.md" class="sidebar-item" aria-label="useEffect和useLayoutEffect？"><!--[--><!--]--> useEffect和useLayoutEffect？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview34.md" class="sidebar-item" aria-label="自定义组件时render是否为可选的？"><!--[--><!--]--> 自定义组件时render是否为可选的？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview35.md" class="sidebar-item" aria-label="React必须使用JSX？"><!--[--><!--]--> React必须使用JSX？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview36.md" class="sidebar-item" aria-label="需要把keys设置为全局唯一？"><!--[--><!--]--> 需要把keys设置为全局唯一？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview37.md" class="sidebar-item" aria-label="怎么定时更新一个组件？"><!--[--><!--]--> 怎么定时更新一个组件？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview38.md" class="sidebar-item" aria-label="使用webpack打包React项目优化？"><!--[--><!--]--> 使用webpack打包React项目优化？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview39.md" class="sidebar-item" aria-label="React根据不同的环境打包？"><!--[--><!--]--> React根据不同的环境打包？ <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview40.md" class="sidebar-item" aria-label="遍React的源码"><!--[--><!--]--> 遍React的源码 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview41.md" class="sidebar-item" aria-label="React.forwardRef"><!--[--><!--]--> React.forwardRef <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview42.md" class="sidebar-item" aria-label="React事件"><!--[--><!--]--> React事件 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview43.md" class="sidebar-item" aria-label="React的reconciliation（一致化算法）"><!--[--><!--]--> React的reconciliation（一致化算法） <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview44.md" class="sidebar-item" aria-label="Fragment|DOM元素|安全注入"><!--[--><!--]--> Fragment|DOM元素|安全注入 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview45.md" class="sidebar-item" aria-label="React中如何监听state"><!--[--><!--]--> React中如何监听state <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview46.md" class="sidebar-item" aria-label="为什么props复制给state会产生bug"><!--[--><!--]--> 为什么props复制给state会产生bug <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview47.md" class="sidebar-item" aria-label="React为什么不要直接修改state|ReactFiber"><!--[--><!--]--> React为什么不要直接修改state|ReactFiber <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview48.md" class="sidebar-item" aria-label="装饰器(Decorator)React"><!--[--><!--]--> 装饰器(Decorator)React <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview49.md" class="sidebar-item" aria-label="react手动清除|for和htmlFor"><!--[--><!--]--> react手动清除|for和htmlFor <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/50/interview50.md" class="sidebar-item" aria-label="React状态管理"><!--[--><!--]--> React状态管理 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/100/interview51.md" class="sidebar-item" aria-label="React新特性"><!--[--><!--]--> React新特性 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/100/interview52.md" class="sidebar-item" aria-label="React事件引用"><!--[--><!--]--> React事件引用 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/100/interview53.md" class="sidebar-item" aria-label="constructor和getInitialState|引入本地图片"><!--[--><!--]--> constructor和getInitialState|引入本地图片 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/100/interview54.md" class="sidebar-item" aria-label="ImmutableData"><!--[--><!--]--> ImmutableData <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/100/interview55.md" class="sidebar-item" aria-label="提高组件的渲染效率"><!--[--><!--]--> 提高组件的渲染效率 <!--[--><!--]--></a><!----></li><li><a href="/technology/react/interview/100/interview56.md" class="sidebar-item" aria-label="react推行函数式组件"><!--[--><!--]--> react推行函数式组件 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="" tabindex="-1"><a class="header-anchor" href="#" aria-hidden="true">#</a></h1><h1 id="react高阶组件-hoc" tabindex="-1"><a class="header-anchor" href="#react高阶组件-hoc" aria-hidden="true">#</a> React高阶组件(HOC)</h1><blockquote><p>高阶作用用于强化组件，复用逻辑，提升渲染性能等作用</p></blockquote><p><strong>问题：</strong></p><ol><li><p>什么是高阶组件，它解决了什么问题？</p></li><li><p>有几种高阶组件，它们优缺点是什么？</p></li><li><p>如何写一个优秀高阶组件？</p></li><li><p>hoc怎么处理静态属性，跨层级ref等问题？</p></li><li><p>高阶组件怎么控制渲染，隔离渲染？</p></li><li><p>高阶组件怎么监控原始组件的状态？</p></li></ol><blockquote><p>高阶组件（HOC）是 React 中用于复用组件逻辑的一种高级技巧。HOC 自身不是 React API 的一部分，它是一种基于 React 的组合特性而形成的设计模式。</p></blockquote><img src="/technology/assets/react/7b05e1efc4e84808a0bb84c9cac4ab4b_tplv-k3u1fbpfcp-watermark.image" alt="demo"><h2 id="_1-几种包装强化组件的方式" tabindex="-1"><a class="header-anchor" href="#_1-几种包装强化组件的方式" aria-hidden="true">#</a> 1. 几种包装强化组件的方式</h2><h3 id="_1-mixin模式" tabindex="-1"><a class="header-anchor" href="#_1-mixin模式" aria-hidden="true">#</a> ① mixin模式</h3><p><strong>原型图</strong></p><img src="/technology/assets/react/faee9aa3049e4eb388ed76db4a8b6e64_tplv-k3u1fbpfcp-watermark.image" alt="demo"><p><strong>老版本的<code>react-mixins</code></strong></p><p>在<code>react</code>初期提供一种组合方法。通过<code>React.createClass</code>,加入<code>mixins</code>属性，具体用法和<code>vue</code> 中<code>mixins</code>相似。具体实现如下。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> customMixin <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&#39;------componentDidMount------&#39;</span> <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token constant">APP</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mixins</span><span class="token operator">:</span> <span class="token punctuation">[</span> customMixin <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">getInitialState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&#39;alien&#39;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> name  <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> hello <span class="token punctuation">,</span>world <span class="token punctuation">,</span> my name is <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>这种<code>mixins</code>只能存在<code>createClass</code>中，后来<code>React.createClass</code>连同<code>mixins</code>这种模式被废弃了。<code>mixins</code>会带来一些负面的影响。</p><ul><li><ol><li><code>mixin</code>引入了隐式依赖关系。</li></ol></li><li><ol start="2"><li>不同<code>mixins</code>之间可能会有先后顺序甚至代码冲突覆盖的问题</li></ol></li><li><ol start="3"><li><code>mixin</code>代码会导致滚雪球式的复杂性</li></ol></li></ul><p><strong>衍生方式</strong></p><p><code>createClass</code>的废弃，不代表<code>mixin</code>模式退出<code>react</code>舞台，在有状态组件<code>class</code>，可以通过<strong>原型链继承</strong>来实现<code>mixins</code>。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> customMixin <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">/* 自定义 mixins */</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&#39;------componentDidMount------&#39;</span> <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">componentClassMixins</span><span class="token punctuation">(</span><span class="token parameter">Component<span class="token punctuation">,</span>mixin</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">/* 继承 */</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> mixin<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Component</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> mixin<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token punctuation">{</span>  <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&#39;alien&#39;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> hello<span class="token punctuation">,</span>world
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">&gt;</span> to say <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">componentClassMixins</span><span class="token punctuation">(</span>Index<span class="token punctuation">,</span>customMixin<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_2extends继承模式" tabindex="-1"><a class="header-anchor" href="#_2extends继承模式" aria-hidden="true">#</a> ②extends继承模式</h3><p><strong>原型图</strong></p><img src="/technology/assets/react/4e95476ddca44d2a88f21d97828030da_tplv-k3u1fbpfcp-watermark.image" alt="demo"><p>在<code>class</code>组件盛行之后，可以通过继承的方式进一步的强化的组件。这种模式的好处在于，可以封装基础功能组件，然后根据需要去<code>extends</code>的基础组件，按需强化组件，但是值得注意的是，必须要对基础组件有足够的掌握，否则会造成一些列意想不到的情况发生。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&#39;alien&#39;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;base components&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> hello<span class="token punctuation">,</span>world <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">&gt;</span>点击<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">Base</span><span class="token punctuation">{</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">/* 会覆盖基类中的 say  */</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;extends components&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Index
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_3hoc模式" tabindex="-1"><a class="header-anchor" href="#_3hoc模式" aria-hidden="true">#</a> ③HOC模式</h3><p><strong>原型图</strong></p><img src="/technology/assets/react/6b3c20e2a97e4a26814a70161edc96b1_tplv-k3u1fbpfcp-watermark.image" alt="demo"><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">wrapComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
     <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token punctuation">{</span>
         <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&#39;alien&#39;</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token function-variable function">render</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token operator">&lt;</span>Component <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token punctuation">}</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

@<span class="token constant">HOC</span>
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> hello<span class="token punctuation">,</span>world <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">&gt;</span>点击<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_4自定义hooks模式" tabindex="-1"><a class="header-anchor" href="#_4自定义hooks模式" aria-hidden="true">#</a> ④自定义hooks模式</h3><p><strong>原型图</strong></p><img src="/technology/assets/react/bcaaa5ce7b5445fdab823bf385caf5e6_tplv-k3u1fbpfcp-watermark.image" alt="demo"><p><code>hooks</code>的诞生，一大部分原因是解决<strong>无状态组件没有<code>state</code>和逻辑难以复用</strong>问题。<code>hooks</code>可以将一段逻辑封装起来，做到开箱即用。</p><h2 id="_2-高阶组件产生初衷" tabindex="-1"><a class="header-anchor" href="#_2-高阶组件产生初衷" aria-hidden="true">#</a> 2 高阶组件产生初衷</h2><hr><p>组件是把<code>prop</code>渲染成<code>UI</code>,而高阶组件是将组件转换成另外一个组件，高阶组件解决的问题🤔🤔🤔？</p><ul><li><p><strong>① 复用逻辑：<strong>高阶组件更像是一个加工<code>react组件</code>的工厂，批量对原有组件进行</strong>加工</strong>，<strong>包装</strong>处理。可以根据业务需求定制化专属的<code>HOC</code>,这样可以解决复用逻辑。</p></li><li><p>**② 强化props：**这个是<code>HOC</code>最常用的用法之一，高阶组件返回的组件，可以劫持上一层传过来的<code>props</code>,然后混入新的<code>props</code>,来增强组件的功能。代表作<code>react-router</code>中的<code>withRouter</code>。</p></li><li><p><strong>③ 赋能组件：</strong><code>HOC</code>有一项独特的特性，就是可以给被<code>HOC</code><strong>包裹</strong>的业务组件，提供一些拓展功能，比如说<strong>额外的生命周期，额外的事件</strong>，但是这种<code>HOC</code>，可能需要和业务组件紧密结合。典型案例<code>react-keepalive-router</code>中的 <code>keepaliveLifeCycle</code>就是通过<code>HOC</code>方式，给业务组件增加了额外的生命周期。</p></li><li><p>**④ 控制渲染：**劫持渲染是<code>hoc</code>一个特性，在<code>wrapComponent</code>包装组件中，可以对原来的组件，进行<code>条件渲染</code>，<code>节流渲染</code>，<code>懒加载</code>等功能，后面会详细讲解，典型代表做<code>react-redux</code>中<code>connect</code>和 <code>dva</code>中 <code>dynamic</code> 组件懒加载。</p></li></ul><h2 id="_3-高阶组件使用和编写结构" tabindex="-1"><a class="header-anchor" href="#_3-高阶组件使用和编写结构" aria-hidden="true">#</a> 3 高阶组件使用和编写结构</h2><hr><p><code>HOC</code>使用指南是非常简单的，只需要将的组件进行包裹就可以了。</p><h3 id="使用-装饰器模式和函数包裹模式" tabindex="-1"><a class="header-anchor" href="#使用-装饰器模式和函数包裹模式" aria-hidden="true">#</a> 使用：装饰器模式和函数包裹模式</h3><p>对于<code>class</code>声明的有状态组件，可以用装饰器模式，对类组件进行包装：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>@<span class="token function">withStyles</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span>
@withRouter
@keepaliveLifeCycle
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Componen</span><span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p><strong>要注意一下包装顺序，越靠近<code>Index</code>组件的，就是越内层的<code>HOC</code>,离组件<code>Index</code>也就越近。</strong></p></blockquote><p>对于无状态组件(函数声明）可以这么写：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">/* .... */</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withStyles</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">withRouter</span><span class="token punctuation">(</span> <span class="token function">keepaliveLifeCycle</span><span class="token punctuation">(</span>Index<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="模型-嵌套hoc" tabindex="-1"><a class="header-anchor" href="#模型-嵌套hoc" aria-hidden="true">#</a> 模型：嵌套HOC</h3><p>对于不需要传递参数的<code>HOC</code>，编写模型只需要嵌套一层就可以，比如<code>withRouter</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">withRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">wrapComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
        <span class="token comment">/* 编写逻辑 */</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>对于需要参数的<code>HOC</code>，需要一层代理，如下：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">connect</span> <span class="token punctuation">(</span><span class="token parameter">mapStateToProps</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">/* 接受第一个参数 */</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">connectAdvance</span><span class="token punctuation">(</span><span class="token parameter">wrapCompoent</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">/* 接受组件 */</span>
        <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">WrapComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>  <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p><code>hoc</code>模型类似于洋葱结构，只要一层一层的分析，就能得到每一层的逻辑以及设计理念，以及整体的设计思路。</p></blockquote><h2 id="_4-两种不同的高阶组件" tabindex="-1"><a class="header-anchor" href="#_4-两种不同的高阶组件" aria-hidden="true">#</a> 4 两种不同的高阶组件</h2><hr><p>常用的高阶组件有两种方式<strong>正向的属性代理</strong>和<strong>反向的组件继承</strong>，两者之前有一些共性和区别。</p><h3 id="正向属性代理" tabindex="-1"><a class="header-anchor" href="#正向属性代理" aria-hidden="true">#</a> 正向属性代理</h3><p>所谓正向属性代理，就是用组件包裹一层代理组件，在代理组件上，可以做一些，对源组件的代理操作。在<code>fiber tree</code> 上，先<code>mounted</code>代理组件，然后才是的业务组件。可以理解为父子组件关系，父组件对子组件进行一系列强化操作。</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token parameter">WrapComponent</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">Advance</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
       state<span class="token operator">=</span><span class="token punctuation">{</span>
           <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&#39;alien&#39;</span>
       <span class="token punctuation">}</span>
       <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">WrapComponent</span></span>  <span class="token spread"><span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token punctuation">}</span></span>  <span class="token punctuation">/&gt;</span></span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>优点</strong></p><ul><li><p>① 正常属性代理可以和业务组件低耦合，零耦合，对于<code>条件渲染</code>和<code>props属性增强</code>,<strong>只负责</strong>控制子组件渲染和传递额外的props就可以，所以无须知道，业务组件做了些什么。所以正向属性代理，更适合做一些开源项目的hoc，目前开源的HOC基本都是通过这个模式实现的。</p></li><li><p>② 同样适用于<code>class</code>声明组件，和<code>function</code>声明的组件。</p></li><li><p>③ 可以完全隔离业务组件的渲染,相比反向继承，属性代理这种模式。可以完全控制业务组件渲染与否，可以避免<code>反向继承</code>带来一些副作用，比如生命周期的执行。</p></li><li><p>④ 可以嵌套使用，多个<code>hoc</code>是可以嵌套使用的，而且一般不会限制包装<code>HOC</code>的先后顺序。</p></li></ul><p><strong>缺点</strong></p><ul><li><p>① 一般无法直接获取业务组件的状态，如果想要获取，需要<code>ref</code>获取组件实例。</p></li><li><p>② 无法直接继承静态属性。如果需要继承需要手动处理，或者引入第三方库。</p></li></ul><p><strong>例子：</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> hello<span class="token punctuation">,</span>world  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Index<span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;my name is alien&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">wrapComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
     <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token punctuation">}</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> newIndex <span class="token operator">=</span>  <span class="token constant">HOC</span><span class="token punctuation">(</span>Index<span class="token punctuation">)</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newIndex<span class="token punctuation">.</span>say<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>打印结果</strong></p><img src="/technology/assets/react/7c907c7605494955b4d5b8170f847a68_tplv-k3u1fbpfcp-watermark.image" alt="demo"><h3 id="反向继承" tabindex="-1"><a class="header-anchor" href="#反向继承" aria-hidden="true">#</a> 反向继承</h3><p>反向继承和属性代理有一定的区别，在于包装后的组件继承了业务组件本身，所以无须在去实例化的业务组件。当前高阶组件就是继承后，加强型的业务组件。这种方式类似于组件的强化</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> hello<span class="token punctuation">,</span>world  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">wrapComponent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span> <span class="token comment">/* 直接继承需要包装的组件 */</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token constant">HOC</span><span class="token punctuation">(</span>Index<span class="token punctuation">)</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>优点</strong></p><ul><li><p>① 方便获取组件内部状态，比如<code>state</code>，<code>props</code> ,<code>生命周期</code>,<code>绑定的事件函数</code>等</p></li><li><p>② <code>es6</code>继承可以良好继承静态属性。无须对静态属性和方法进行额外的处理。</p></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> hello<span class="token punctuation">,</span>world  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Index<span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;my name is alien&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">wrapComponent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> newIndex <span class="token operator">=</span>  <span class="token constant">HOC</span><span class="token punctuation">(</span>Index<span class="token punctuation">)</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newIndex<span class="token punctuation">.</span>say<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>打印结果</strong></p><img src="/technology/assets/react/2619fd18f75d47e7b7991858aac0b10c_tplv-k3u1fbpfcp-watermark.image" alt="demo"><p><strong>缺点</strong></p><ul><li><p>① 无状态组件无法使用。</p></li><li><p>② 和被包装的组件强耦合，需要知道被包装的组件的内部状态，具体是做什么？</p></li><li><p>③ 如果多个反向继承<code>hoc</code>嵌套在一起，当前状态会覆盖上一个状态。这样带来的隐患是非常大的，比如说有多个<code>componentDidMount</code>，当前<code>componentDidMount</code>会覆盖上一个<code>componentDidMount</code>。这样副作用串联起来，影响很大。</p></li></ul><h1 id="设计高阶组件" tabindex="-1"><a class="header-anchor" href="#设计高阶组件" aria-hidden="true">#</a> 设计高阶组件</h1><h2 id="_1-强化props" tabindex="-1"><a class="header-anchor" href="#_1-强化props" aria-hidden="true">#</a> 1 强化props</h2><hr><h3 id="_1-混入props" tabindex="-1"><a class="header-anchor" href="#_1-混入props" aria-hidden="true">#</a> ① 混入props</h3><p>这个是高阶组件最常用的功能，承接上层的<code>props</code>,在混入自己的<code>props</code>，来强化组件。</p><p><strong>有状态组件(属性代理)</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">classHOC</span><span class="token punctuation">(</span><span class="token parameter">WrapComponent</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">class</span>  <span class="token class-name">Idex</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
        state<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&#39;alien&#39;</span>
        <span class="token punctuation">}</span>
        <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;HOC&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrapComponent <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token punctuation">}</span>  <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token punctuation">}</span>   <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> props
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&#39;index&#39;</span> <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    hello<span class="token punctuation">,</span>world <span class="token punctuation">,</span> my name is <span class="token punctuation">{</span> name <span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">classHOC</span><span class="token punctuation">(</span>Index<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><strong>有状态组件(属性代理)</strong></p><blockquote><p>同样也适用与无状态组件。</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">functionHoc</span><span class="token punctuation">(</span><span class="token parameter">WrapComponent</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span> state <span class="token punctuation">,</span> setState <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span> <span class="token operator">:</span><span class="token string">&#39;alien&#39;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>       
        <span class="token keyword">return</span>  <span class="token operator">&lt;</span>WrapComponent <span class="token punctuation">{</span> <span class="token operator">...</span>props <span class="token punctuation">}</span>  <span class="token punctuation">{</span> <span class="token operator">...</span>state <span class="token punctuation">}</span>   <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>效果</strong></p><img src="/technology/assets/react/a24c4018d41048adbe335c1f5c22f0e3_tplv-k3u1fbpfcp-watermark.image" alt="demo"><h3 id="_2-抽离state控制更新" tabindex="-1"><a class="header-anchor" href="#_2-抽离state控制更新" aria-hidden="true">#</a> ② 抽离state控制更新</h3><p>高阶组件可以将<code>HOC</code>的<code>state</code>的配合起来，控制业务组件的更新。这种用法在<code>react-redux</code>中<code>connect</code>高阶组件中用到过，用于处理来自<code>redux</code>中<code>state</code>更改，带来的订阅更新作用。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">classHOC</span><span class="token punctuation">(</span><span class="token parameter">WrapComponent</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span>  <span class="token class-name">Idex</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&#39;alien&#39;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token function">changeName</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrapComponent <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token punctuation">}</span>  <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token punctuation">}</span> changeName<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeName</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span> value <span class="token punctuation">,</span>setValue <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">,</span>changeName <span class="token punctuation">}</span> <span class="token operator">=</span> props
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>   hello<span class="token punctuation">,</span>world <span class="token punctuation">,</span> my name is <span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    改变name <span class="token operator">&lt;</span>input onChange<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token function">setValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>  <span class="token function">changeName</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">}</span>  <span class="token operator">&gt;</span>确定<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">classHOC</span><span class="token punctuation">(</span>Index<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><strong>效果</strong></p><img src="/technology/assets/react/2ca30a6dd90340f59352146876ed9a37_tplv-k3u1fbpfcp-watermark.image" alt="demo"><h2 id="_2-控制渲染" tabindex="-1"><a class="header-anchor" href="#_2-控制渲染" aria-hidden="true">#</a> 2 控制渲染</h2><hr><p>控制渲染是高阶组件的一个很重要的特性，上边说到的两种高阶组件，都能完成对组件渲染的控制。</p><h3 id="_2-1-条件渲染" tabindex="-1"><a class="header-anchor" href="#_2-1-条件渲染" aria-hidden="true">#</a> 2.1 条件渲染</h3><h4 id="_1-基础-动态渲染" tabindex="-1"><a class="header-anchor" href="#_1-基础-动态渲染" aria-hidden="true">#</a> ① 基础 ：动态渲染</h4><p>对于属性代理的高阶组件，虽然不能在内部操控渲染状态，但是可以在外层控制当前组件是否渲染，这种情况应用于，<strong>权限隔离</strong>，<strong>懒加载</strong> ，<strong>延时加载</strong>等场景。</p><p><strong>实现一个动态挂载组件的HOC</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">renderHOC</span><span class="token punctuation">(</span><span class="token parameter">WrapComponent</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">Index</span>  <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token literal-property property">visible</span><span class="token operator">:</span><span class="token boolean">true</span> <span class="token punctuation">}</span>  
      <span class="token punctuation">}</span>
      <span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">visible</span><span class="token operator">:</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>visible <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">const</span> <span class="token punctuation">{</span>  visible <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state 
         <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;box&quot;</span>  <span class="token operator">&gt;</span>
           <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setVisible</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">&gt;</span> 挂载组件 <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
           <span class="token punctuation">{</span> visible <span class="token operator">?</span> <span class="token operator">&lt;</span>WrapComponent <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token punctuation">}</span> setVisible<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setVisible</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>   <span class="token operator">/</span><span class="token operator">&gt;</span>  <span class="token operator">:</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;icon&quot;</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>SyncOutlined spin  className<span class="token operator">=</span><span class="token string">&quot;theicon&quot;</span>  <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> <span class="token punctuation">}</span>
         <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> setVisible <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;box&quot;</span> <span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>hello<span class="token punctuation">,</span>my name is alien<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>img  src<span class="token operator">=</span><span class="token string">&#39;https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=294206908,2427609994&amp;fm=26&amp;gp=0.jpg&#39;</span>   <span class="token operator">/</span><span class="token operator">&gt;</span> 
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>  <span class="token operator">&gt;</span> 卸载当前组件 <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">renderHOC</span><span class="token punctuation">(</span>Index<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><strong>效果：</strong></p><img src="/technology/assets/react/03c41d9ee9fa491cb3ae44d9cee1f2b3_tplv-k3u1fbpfcp-watermark.image" alt="demo"><h4 id="_2-进阶-分片渲染" tabindex="-1"><a class="header-anchor" href="#_2-进阶-分片渲染" aria-hidden="true">#</a> ② 进阶 ：分片渲染</h4><p><strong>进阶：实现一个懒加载功能的HOC，可以实现组件的分片渲染,用于分片渲染页面，不至于一次渲染大量组件造成白屏效果</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> renderQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> isFirstrender <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">const</span> <span class="token function-variable function">tryRender</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> render <span class="token operator">=</span> renderQueue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>render<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/* 执行下一段渲染 */</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> 
<span class="token comment">/* HOC */</span>
<span class="token keyword">function</span> <span class="token function">renderHOC</span><span class="token punctuation">(</span><span class="token parameter">WrapComponent</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span> isRender <span class="token punctuation">,</span> setRender <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        renderQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>  <span class="token comment">/* 放入待渲染队列中 */</span>
          <span class="token function">setRender</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isFirstrender<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">tryRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/**/</span>
          isFirstrender <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> isRender <span class="token operator">?</span> <span class="token operator">&lt;</span>WrapComponent tryRender<span class="token operator">=</span><span class="token punctuation">{</span>tryRender<span class="token punctuation">}</span>  <span class="token punctuation">{</span> <span class="token operator">...</span>props <span class="token punctuation">}</span>  <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&#39;box&#39;</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;icon&quot;</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span>SyncOutlined   spin <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 业务组件 */</span>
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">,</span> tryRender<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token comment">/* 上一部分渲染完毕，进行下一部分渲染 */</span>
    <span class="token function">tryRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> name<span class="token operator">+</span><span class="token string">&#39;渲染&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">&quot;https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=294206908,2427609994&amp;amp;fm=26&amp;amp;gp=0.jpg&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 高阶组件包裹 */</span>
<span class="token keyword">const</span> Item <span class="token operator">=</span> <span class="token function">renderHOC</span><span class="token punctuation">(</span>Index<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>React<span class="token punctuation">.</span>Fragment<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Item name<span class="token operator">=</span><span class="token string">&quot;组件一&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Item name<span class="token operator">=</span><span class="token string">&quot;组件二&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Item name<span class="token operator">=</span><span class="token string">&quot;组件三&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>Fragment<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p><strong>效果</strong></p><img src="/technology/assets/react/2d94687dda024392a37abec5e4756420_tplv-k3u1fbpfcp-watermark.image" alt="demo"><p>大致流程，初始化的时候，<code>HOC</code>中将渲染真正组件的渲染函数，放入<code>renderQueue</code>队列中，然后初始化渲染一次，接下来，每一个项目组件，完成 <code>didMounted</code> 状态后，会从队列中取出下一个渲染函数，渲染下一个组件, 一直到所有的渲染任务全部执行完毕，渲染队列清空，有效的进行分片的渲染，这种方式对海量数据展示，很奏效。</p><p>用<code>HOC</code>实现了条件渲染-分片渲染的功能，实际条件渲染理解起来很容易，就是通过变量，控制是否挂载组件，从而满足项目本身需求，条件渲染可以演变成很多模式，这里介绍了条件渲染的二种方式，希望大家能够理解精髓所在。</p><h4 id="_3-进阶-异步组件-懒加载" tabindex="-1"><a class="header-anchor" href="#_3-进阶-异步组件-懒加载" aria-hidden="true">#</a> ③ 进阶：异步组件(懒加载)</h4><p>不知道大家有没有用过<code>dva</code>,里面的<code>dynamic</code>就是应用<code>HOC</code>模式实现的组件异步加载，这里简化了一下，提炼核心代码，如下：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* 路由懒加载HOC */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">AsyncRouter</span><span class="token punctuation">(</span><span class="token parameter">loadRouter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">Content</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">Component</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>Component<span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token function">loadRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token operator">=&gt;</span> module<span class="token punctuation">.</span>default<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">Component</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
      <span class="token keyword">return</span> Component <span class="token operator">?</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span>
      <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props
      <span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>使用</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> Index <span class="token operator">=</span> <span class="token function">AsyncRouter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;../pages/index&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><code>hoc</code>还可以配合其他<code>API</code>，做一下衍生的功能。如上配合<code>import</code>实现异步加载功能。<code>HOC</code>用起来非常灵活，</p><h4 id="_4-反向继承-渲染劫持" tabindex="-1"><a class="header-anchor" href="#_4-反向继承-渲染劫持" aria-hidden="true">#</a> ④ 反向继承 ： 渲染劫持</h4><p>HOC反向继承模式，可以实现颗粒化的渲染劫持，也就是可以控制基类组件的<code>render</code>函数，还可以篡改<code>props</code>，或者是<code>children</code>，接下来看看，这种状态下，怎么使用高阶组件。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>
<span class="token keyword">const</span> <span class="token function-variable function">HOC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">WrapComponent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token keyword">class</span> <span class="token class-name">Index</span>  <span class="token keyword">extends</span> <span class="token class-name">WrapComponent</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>visible<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>暂无数据<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_5-反向继承-修改渲染树" tabindex="-1"><a class="header-anchor" href="#_5-反向继承-修改渲染树" aria-hidden="true">#</a> ⑤ 反向继承：修改渲染树</h4><p><strong>修改渲染状态(劫持render替换子节点)</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>react<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>vue<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>Angular<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token constant">HOC</span> <span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">Advance</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> otherProps <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&#39;alien&#39;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">/* 替换 Angular 元素节点 */</span>
      <span class="token keyword">const</span> appendElement <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;li&#39;</span> <span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello ,world , my name  is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> otherProps<span class="token punctuation">.</span>name <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">)</span>
      <span class="token keyword">const</span> newchild <span class="token operator">=</span>  React<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">child<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
           <span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">return</span> appendElement
           <span class="token keyword">return</span>  child
      <span class="token punctuation">}</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span>  React<span class="token punctuation">.</span><span class="token function">cloneElement</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> element<span class="token punctuation">.</span>props<span class="token punctuation">,</span> newchild<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span>  <span class="token keyword">default</span> <span class="token constant">HOC</span><span class="token punctuation">(</span>Index<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><strong>效果</strong></p><img src="/technology/assets/react/8768ee8201e949d8a7c2f7c0ec72b1e4_tplv-k3u1fbpfcp-watermark.image" alt="demo"><p>用劫持渲染的方式，来操纵<code>super.render()</code>后的<code>React.element</code>元素，然后配合 <code>createElement</code> , <code>cloneElement</code> , <code>React.Children</code> 等 <code>api</code>,可以灵活操纵，真正的渲染<code>react.element</code>，可以说是偷天换日，不亦乐乎。</p><h3 id="_2-2节流渲染" tabindex="-1"><a class="header-anchor" href="#_2-2节流渲染" aria-hidden="true">#</a> 2.2节流渲染</h3><p><code>hoc</code>除了可以进行<strong>条件渲染</strong>，<strong>渲染劫持</strong>功能外，还可以进行节流渲染，也就是可以优化性能</p><h4 id="_1-基础-节流原理" tabindex="-1"><a class="header-anchor" href="#_1-基础-节流原理" aria-hidden="true">#</a> ① 基础: 节流原理</h4><p><code>hoc</code>可以配合<code>hooks</code>的<code>useMemo</code>等<code>API</code>配合使用，可以实现对业务组件的渲染控制，减少渲染次数，从而达到优化性能的效果。如下案例，期望当且仅当<code>num</code>改变的时候，渲染组件，但是不影响接收的<code>props</code>。应该这样写的<code>HOC</code>。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token constant">HOC</span> <span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">renderWrapComponent</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">const</span> <span class="token punctuation">{</span> num <span class="token punctuation">}</span> <span class="token operator">=</span> props
       <span class="token keyword">const</span> RenderElement <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>  <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span>  <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token punctuation">,</span><span class="token punctuation">[</span> num <span class="token punctuation">]</span><span class="token punctuation">)</span>
       <span class="token keyword">return</span> RenderElement
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">当前组件是否渲染</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span>
     <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>hello<span class="token punctuation">,</span>world<span class="token punctuation">,</span> my name is alien <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> IndexHoc <span class="token operator">=</span> <span class="token constant">HOC</span><span class="token punctuation">(</span>Index<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> num <span class="token punctuation">,</span>setNumber <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> num1 <span class="token punctuation">,</span>setNumber1 <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> num2 <span class="token punctuation">,</span>setNumber2 <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>IndexHoc  num<span class="token operator">=</span><span class="token punctuation">{</span> num <span class="token punctuation">}</span> num1<span class="token operator">=</span><span class="token punctuation">{</span>num1<span class="token punctuation">}</span> num2<span class="token operator">=</span><span class="token punctuation">{</span> num2 <span class="token punctuation">}</span>  <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setNumber</span><span class="token punctuation">(</span>num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">&gt;</span>num<span class="token operator">++</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setNumber1</span><span class="token punctuation">(</span>num1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">&gt;</span>num1<span class="token operator">++</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setNumber2</span><span class="token punctuation">(</span>num2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">&gt;</span>num2<span class="token operator">++</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><strong>效果：</strong></p><img src="/technology/assets/react/4ed5c42a503645118da7fbdf1e0a9920_tplv-k3u1fbpfcp-watermark.image" alt="demo"><p>如图所示,当只有点击 <code>num++</code>时候，才重新渲染子组件，点击其他按钮，只是负责传递了<code>props</code>,达到了期望的效果。</p><h4 id="_2-进阶-定制化渲染流" tabindex="-1"><a class="header-anchor" href="#_2-进阶-定制化渲染流" aria-hidden="true">#</a> ② 进阶：定制化渲染流</h4><p>思考：🤔上述的案例只是介绍了原理，在实际项目中，是量化生产不了的，原因是，需要针对不同<code>props</code>变化，写不同的<code>HOC</code>组件，这样根本起不了<code>Hoc</code>真正的用途，也就是<code>HOC</code>产生的初衷。所以需要对上述<code>hoc</code>进行改造升级，是组件可以根据定制化方向，去渲染组件。也就是<code>Hoc</code>生成的时候，已经按照某种契约去执行渲染。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token constant">HOC</span> <span class="token punctuation">(</span><span class="token parameter">rule</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">renderWrapComponent</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token function">rule</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
          <span class="token keyword">const</span> RenderElement <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>  <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span>  <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token punctuation">,</span><span class="token punctuation">[</span> dep <span class="token punctuation">]</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> RenderElement
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 只有 props 中 num 变化 ，渲染组件  */</span>
@<span class="token constant">HOC</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> props<span class="token punctuation">[</span><span class="token string">&#39;num&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">IndexHoc</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">组件一渲染</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span>
     <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 组件一 ： hello<span class="token punctuation">,</span>world <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 只有 props 中 num1 变化 ，渲染组件  */</span>
@<span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> props<span class="token punctuation">[</span><span class="token string">&#39;num1&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">IndexHoc1</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">组件二渲染</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span>
     <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 组件二 ： my name is alien <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> num <span class="token punctuation">,</span>setNumber <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> num1 <span class="token punctuation">,</span>setNumber1 <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> num2 <span class="token punctuation">,</span>setNumber2 <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>IndexHoc  num<span class="token operator">=</span><span class="token punctuation">{</span> num <span class="token punctuation">}</span> num1<span class="token operator">=</span><span class="token punctuation">{</span>num1<span class="token punctuation">}</span> num2<span class="token operator">=</span><span class="token punctuation">{</span> num2 <span class="token punctuation">}</span>  <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>IndexHoc1  num<span class="token operator">=</span><span class="token punctuation">{</span> num <span class="token punctuation">}</span> num1<span class="token operator">=</span><span class="token punctuation">{</span>num1<span class="token punctuation">}</span> num2<span class="token operator">=</span><span class="token punctuation">{</span> num2 <span class="token punctuation">}</span>  <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setNumber</span><span class="token punctuation">(</span>num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">&gt;</span>num<span class="token operator">++</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setNumber1</span><span class="token punctuation">(</span>num1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">&gt;</span>num1<span class="token operator">++</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setNumber2</span><span class="token punctuation">(</span>num2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">&gt;</span>num2<span class="token operator">++</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p><strong>效果</strong></p><img src="/technology/assets/react/957c16b333b547e3bf99b5f635c055b3_tplv-k3u1fbpfcp-watermark.image" alt="demo"><p>完美实现了效果。这用高阶组件模式，可以灵活控制<code>React</code>组件层面上的，<code>props</code><strong>数据流</strong>和<strong>更新流</strong>，优秀的高阶组件有 <code>mobx</code> <code>中observer</code> ,<code>inject</code> , <code>react-redux</code>中的<code>connect</code></p><h2 id="_3-赋能组件" tabindex="-1"><a class="header-anchor" href="#_3-赋能组件" aria-hidden="true">#</a> 3 赋能组件</h2><hr><p>高阶组件除了上述两种功能之外，还可以赋能组件，比如加一些<strong>额外</strong><code>生命周期</code>，<strong>劫持事件</strong>，<strong>监控日志</strong>等。</p><h3 id="_3-1-劫持原型链-劫持生命周期-事件函数" tabindex="-1"><a class="header-anchor" href="#_3-1-劫持原型链-劫持生命周期-事件函数" aria-hidden="true">#</a> 3.1 劫持原型链-劫持生命周期，事件函数</h3><h4 id="_1-属性代理实现" tabindex="-1"><a class="header-anchor" href="#_1-属性代理实现" aria-hidden="true">#</a> ① 属性代理实现</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token constant">HOC</span> <span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> proDidMount <span class="token operator">=</span> <span class="token class-name">Component</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>componentDidMount 
  <span class="token class-name">Component</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">componentDidMount</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;劫持生命周期：componentDidMount&#39;</span><span class="token punctuation">)</span>
     <span class="token function">proDidMount</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">wrapComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span>  <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
@<span class="token constant">HOC</span>
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
   <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;———didMounted———&#39;</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>hello<span class="token punctuation">,</span>world<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>效果</strong></p><img src="/technology/assets/react/abe21724cf8141a491cc3fab2dea7b46_tplv-k3u1fbpfcp-watermark.image" alt="demo"><h4 id="_2-反向继承实现" tabindex="-1"><a class="header-anchor" href="#_2-反向继承实现" aria-hidden="true">#</a> ② 反向继承实现</h4><p>反向继承，因为在继承原有组件的基础上，可以对原有组件的<strong>生命周期</strong>或<strong>事件</strong>进行劫持，甚至是替换。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token constant">HOC</span> <span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> didMount <span class="token operator">=</span> <span class="token class-name">Component</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>componentDidMount
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">wrapComponent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>
      <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;------劫持生命周期------&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>didMount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token function">didMount</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">/* 注意 `this` 指向问题。 */</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

@<span class="token constant">HOC</span>
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
   <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;———didMounted———&#39;</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>hello<span class="token punctuation">,</span>world<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="_3-2-事件监控" tabindex="-1"><a class="header-anchor" href="#_3-2-事件监控" aria-hidden="true">#</a> 3.2 事件监控</h3><p><code>HOC</code>还可以对原有组件进行监控。比如对一些<code>事件监控</code>，<code>错误监控</code>，<code>事件监听</code>等一系列操作。</p><h4 id="_1-组件内的事件监听" tabindex="-1"><a class="header-anchor" href="#_1-组件内的事件监听" aria-hidden="true">#</a> ① 组件内的事件监听</h4><p>接下来，做一个HOC,只对组件内的点击事件做一个监听效果。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>
<span class="token keyword">function</span> <span class="token function">ClickHoc</span> <span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span>  <span class="token keyword">function</span> <span class="token function">Wrap</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> dom <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     <span class="token keyword">const</span> <span class="token function-variable function">handerClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;发生点击事件&#39;</span><span class="token punctuation">)</span> 
     dom<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span>handerClick<span class="token punctuation">)</span>
     <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> dom<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span>handerClick<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>  <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>dom<span class="token punctuation">}</span>  <span class="token operator">&gt;</span><span class="token operator">&lt;</span>Component  <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

@ClickHoc
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
   <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token operator">&lt;</span>div  className<span class="token operator">=</span><span class="token string">&#39;index&#39;</span>  <span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>hello，world<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>组件内部点击<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&#39;box&#39;</span>  <span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>Index <span class="token operator">/</span><span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>组件外部点击<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><strong>效果</strong></p><img src="/technology/assets/react/2e80fb646d654536af836b7d038fd62b_tplv-k3u1fbpfcp-watermark.image" alt="demo"><h3 id="_3-ref助力操控组件实例" tabindex="-1"><a class="header-anchor" href="#_3-ref助力操控组件实例" aria-hidden="true">#</a> 3 ref助力操控组件实例</h3><p>对于属性代理虽然不能直接获取组件内的状态，但是可以通过<code>ref</code>获取组件实例,获取到组件实例，就可以获取组件的一些状态，或是手动触发一些事件，进一步强化组件，但是注意的是：<code>class</code>声明的有状态组件才有实例，<code>function</code>声明的无状态组件不存在实例。</p><h4 id="_1-属性代理-添加额外生命周期" tabindex="-1"><a class="header-anchor" href="#_1-属性代理-添加额外生命周期" aria-hidden="true">#</a> ① 属性代理-添加额外生命周期</h4><p>可以针对某一种情况, 给组件增加额外的生命周期，做了一个简单的<code>demo</code>，监听<code>number</code>改变，如果<code>number</code>改变，就自动触发组件的监听函数<code>handerNumberChange</code>。 具体写法如下</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Hoc</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">WrapComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>node <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span>
      <span class="token function">UNSAFE_componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token parameter">nextprops</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>nextprops<span class="token punctuation">.</span>number <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>number <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>node<span class="token punctuation">.</span>handerNumberChange  <span class="token operator">&amp;&amp;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>node<span class="token punctuation">.</span><span class="token function">handerNumberChange</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>node<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>node <span class="token operator">=</span> node <span class="token punctuation">}</span>  <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
@Hoc
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">handerNumberChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">/* 监听 number 改变 */</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>hello<span class="token punctuation">,</span>world<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="_4-总结" tabindex="-1"><a class="header-anchor" href="#_4-总结" aria-hidden="true">#</a> 4 总结</h2><hr><p>对于属性代理HOC，可以：</p><ul><li><p>强化<code>props</code> &amp; 抽离<code>state</code>。</p></li><li><p>条件渲染，控制渲染，分片渲染，懒加载。</p></li><li><p>劫持事件和生命周期</p></li><li><p><code>ref</code>控制组件实例</p></li><li><p>添加事件监听器，日志</p></li></ul><p>对于反向代理的HOC, 可以：</p><ul><li><p>劫持渲染，操纵渲染树</p></li><li><p>控制/替换生命周期，直接获取组件状态，绑定事件。</p></li></ul><h1 id="四-高阶组件源码级实践" tabindex="-1"><a class="header-anchor" href="#四-高阶组件源码级实践" aria-hidden="true">#</a> 四 高阶组件源码级实践</h1><h2 id="_1-强化prop-withroute" tabindex="-1"><a class="header-anchor" href="#_1-强化prop-withroute" aria-hidden="true">#</a> 1 强化prop- withRoute</h2><hr><p><code>withRoute</code>用途就是，对于没有被<code>Route</code>包裹的组件，给添加<code>history</code>对象等和路由相关的状态，方便在任意组件中，都能够获取路由状态，进行路由跳转，这个<code>HOC</code>目的很清楚，就是强化<code>props</code>,把<code>Router</code>相关的状态都混入到<code>props</code>中</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">withRouter</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> displayName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">withRouter(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Component<span class="token punctuation">.</span>displayName <span class="token operator">||</span> Component<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">C</span> <span class="token operator">=</span> <span class="token parameter">props</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">/*  获取 */</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> wrappedComponentRef<span class="token punctuation">,</span> <span class="token operator">...</span>remainingProps <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>RouterContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token parameter">context</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>Component
              <span class="token punctuation">{</span><span class="token operator">...</span>remainingProps<span class="token punctuation">}</span>
              <span class="token punctuation">{</span><span class="token operator">...</span>context<span class="token punctuation">}</span>
              ref<span class="token operator">=</span><span class="token punctuation">{</span>wrappedComponentRef<span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">&gt;</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>RouterContext<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token constant">C</span><span class="token punctuation">.</span>displayName <span class="token operator">=</span> displayName<span class="token punctuation">;</span>
  <span class="token constant">C</span><span class="token punctuation">.</span>WrappedComponent <span class="token operator">=</span> Component<span class="token punctuation">;</span>
  <span class="token comment">/* 继承静态属性 */</span>
  <span class="token keyword">return</span> <span class="token function">hoistStatics</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">,</span> Component<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> withRouter
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><code>withRoute</code>的流程实际很简单，就是先从<code>props</code>分离出<code>ref</code>和<code>props</code>,然后从存放整个<code>route</code>对象上下文<code>RouterContext</code>取出<code>route</code>对象,然后混入到原始组件的<code>props</code>中，最后用<code>hoistStatics</code>继承静态属性。</p><h2 id="_2-控制渲染案例-connect" tabindex="-1"><a class="header-anchor" href="#_2-控制渲染案例-connect" aria-hidden="true">#</a> 2 控制渲染案例 connect</h2><p>由于<code>connect</code>源码比较长和难以理解，所以提取精髓，精简精简再精简, 总结的核心功能如下,<code>connect</code>的作用也有合并<code>props</code>，但是更重要的是接受<code>state</code>，来控制更新组件。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&#39;./redux/store&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ReactReduxContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./Context&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>
<span class="token keyword">function</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token parameter">mapStateToProps</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">/* 第一层： 接收订阅state函数 */</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">wrapWithConnect</span> <span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">/* 第二层：接收原始组件 */</span>
        <span class="token keyword">function</span> <span class="token function">ConnectFunction</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">[</span> <span class="token punctuation">,</span> forceUpdate <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> reactReduxForwardedRef <span class="token punctuation">,</span><span class="token operator">...</span>wrapperProps <span class="token punctuation">}</span> <span class="token operator">=</span> props
            
            <span class="token comment">/* 取出Context */</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ReactReduxContext<span class="token punctuation">)</span>

            <span class="token comment">/* 强化props：合并 store state 和 props  */</span>
            <span class="token keyword">const</span> trueComponentProps <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                  <span class="token comment">/* 只有props或者订阅的state变化，才返回合并后的props */</span>
                 <span class="token keyword">return</span> <span class="token function">selectorFactory</span><span class="token punctuation">(</span><span class="token function">mapStateToProps</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>wrapperProps<span class="token punctuation">)</span> 
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span> store <span class="token punctuation">,</span> wrapperProps <span class="token punctuation">]</span><span class="token punctuation">)</span>

            <span class="token comment">/* 只有 trueComponentProps 改变时候,更新组件。  */</span>
            <span class="token keyword">const</span> renderedWrappedComponent <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span>
              <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
                <span class="token operator">&lt;</span>WrappedComponent
                  <span class="token punctuation">{</span><span class="token operator">...</span>trueComponentProps<span class="token punctuation">}</span>
                  ref<span class="token operator">=</span><span class="token punctuation">{</span>reactReduxForwardedRef<span class="token punctuation">}</span>
                <span class="token operator">/</span><span class="token operator">&gt;</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">[</span>reactReduxForwardedRef<span class="token punctuation">,</span> WrappedComponent<span class="token punctuation">,</span> trueComponentProps<span class="token punctuation">]</span>
            <span class="token punctuation">)</span>
            <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
              <span class="token comment">/* 订阅更新 */</span>
               <span class="token keyword">const</span> <span class="token function-variable function">checkUpdate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">forceUpdate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
               store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span> checkUpdate <span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span> store <span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> renderedWrappedComponent
        <span class="token punctuation">}</span>
        <span class="token comment">/* React.memo 包裹  */</span>
        <span class="token keyword">const</span> Connect <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>ConnectFunction<span class="token punctuation">)</span>

        <span class="token comment">/* 处理hoc,获取ref问题 */</span>  
        <span class="token keyword">if</span><span class="token punctuation">(</span>forwardRef<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">const</span> forwarded <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">forwardConnectRef</span><span class="token punctuation">(</span> <span class="token parameter">props<span class="token punctuation">,</span>ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">&lt;</span>Connect <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> reactReduxForwardedRef<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> reactReduxForwardedRef<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token function">hoistStatics</span><span class="token punctuation">(</span>forwarded<span class="token punctuation">,</span> WrappedComponent<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> 
        <span class="token comment">/* 继承静态属性 */</span>
        <span class="token keyword">return</span> <span class="token function">hoistStatics</span><span class="token punctuation">(</span>Connect<span class="token punctuation">,</span>WrappedComponent<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Index
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><p><code>connect</code> 涉及到的功能点还真不少呢，首先第一层接受订阅函数，第二层接收原始组件，然后用<code>forwardRef</code>处理<code>ref</code>,用<code>hoistStatics</code> 处理静态属性的继承，在包装组件内部，合并<code>props</code>,<code>useMemo</code>缓存原始组件，只有合并后的<code>props</code>发生变化，才更新组件，然后在<code>useEffect</code>内部通过<code>store.subscribe()</code>订阅更新。这里省略了<code>Subscription</code>概念，真正的<code>connect</code>中有一个<code>Subscription</code>专门负责订阅消息。</p><h2 id="_3-赋能组件-缓存生命周期-keepalivelifecycle" tabindex="-1"><a class="header-anchor" href="#_3-赋能组件-缓存生命周期-keepalivelifecycle" aria-hidden="true">#</a> 3 赋能组件-缓存生命周期 keepaliveLifeCycle</h2><hr><p><code>react-keepalive-router</code>加入了全新的页面组件生命周期 <code>actived</code> 和 <code>unActived</code>, <code>actived</code> 作为缓存路由组件激活时候用，初始化的时候会默认执行一次 , <code>unActived</code> 作为路由组件缓存完成后调用。但是生命周期需要用一个 <code>HOC</code> 组件<code>keepaliveLifeCycle</code> 包裹。</p><p><strong>使用</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> React   <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> keepaliveLifeCycle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-keepalive-router&#39;</span>

@keepaliveLifeCycle
<span class="token keyword">class</span> <span class="token class-name">index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token operator">&lt;</span>any<span class="token punctuation">,</span>any<span class="token operator">&gt;</span><span class="token punctuation">{</span>

    state<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token literal-property property">activedNumber</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">unActivedNumber</span><span class="token operator">:</span><span class="token number">0</span>
    <span class="token punctuation">}</span>
    <span class="token function">actived</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">activedNumber</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>activedNumber <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">unActived</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">unActivedNumber</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>unActivedNumber <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> activedNumber <span class="token punctuation">,</span> unActivedNumber <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div  style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">marginTop</span> <span class="token operator">:</span><span class="token string">&#39;50px&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>  <span class="token operator">&gt;</span>
           <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 页面 actived 次数： <span class="token punctuation">{</span>activedNumber<span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
           <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 页面 unActived 次数：<span class="token punctuation">{</span>unActivedNumber<span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> index
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><strong>效果：</strong></p><img src="/technology/assets/react/c534d245d59b40518de8a035fa9b6c75_tplv-k3u1fbpfcp-watermark.image" alt="demo"><p><strong>原理</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>lifeCycles<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../core/keeper&#39;</span>
<span class="token keyword">import</span> hoistNonReactStatic <span class="token keyword">from</span> <span class="token string">&#39;hoist-non-react-statics&#39;</span>
<span class="token keyword">function</span> <span class="token function">keepaliveLifeCycle</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">class</span> <span class="token class-name">Hoc</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    cur <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token function-variable function">handerLifeCycle</span> <span class="token operator">=</span> <span class="token parameter">type</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>cur<span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">const</span> lifeCycleFunc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cur<span class="token punctuation">[</span>type<span class="token punctuation">]</span>
      <span class="token function">isFuntion</span><span class="token punctuation">(</span>lifeCycleFunc<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">lifeCycleFunc</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cur<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      <span class="token keyword">const</span> <span class="token punctuation">{</span>cacheId<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
      cacheId <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>lifeCycles<span class="token punctuation">[</span>cacheId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handerLifeCycle<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>cacheId<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
      <span class="token keyword">delete</span> lifeCycles<span class="token punctuation">[</span>cacheId<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
     <span class="token function-variable function">render</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">cur</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cur <span class="token operator">=</span> cur<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">hoistNonReactStatic</span><span class="token punctuation">(</span>Hoc<span class="token punctuation">,</span>Component<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><code>keepaliveLifeCycle</code> 的原理很简单，就是通过<code>ref</code>或获取 <code>class</code> 组件的实例,在 <code>hoc</code> 初始化时候<strong>进行生命周期的绑定</strong>, 在 <code>hoc</code> 销毁阶段，对生命周期进行解绑, 然后交给<code>keeper</code>统一调度，<code>keeper</code>通过调用实例下面的生命周期函数，来实现缓存生命周期功能的。</p><h1 id="五-高阶组件的注意事项" tabindex="-1"><a class="header-anchor" href="#五-高阶组件的注意事项" aria-hidden="true">#</a> 五 高阶组件的注意事项</h1><h2 id="_1-谨慎修改原型链" tabindex="-1"><a class="header-anchor" href="#_1-谨慎修改原型链" aria-hidden="true">#</a> 1 谨慎修改原型链</h2><hr><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token constant">HOC</span> <span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> proDidMount <span class="token operator">=</span> <span class="token class-name">Component</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>componentDidMount 
  <span class="token class-name">Component</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">componentDidMount</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;劫持生命周期：componentDidMount&#39;</span><span class="token punctuation">)</span>
     <span class="token function">proDidMount</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span>  Component
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这样做会产生一些不良后果。比如如果你再用另一个同样会修改 <code>componentDidMount</code> 的 <code>HOC</code> 增强它，那么前面的 <code>HOC</code> 就会失效！同时，这个 <code>HOC</code> 也无法应用于没有生命周期的函数组件。</p><h2 id="_2-继承静态属性" tabindex="-1"><a class="header-anchor" href="#_2-继承静态属性" aria-hidden="true">#</a> 2 继承静态属性</h2><hr><p>在用属性代理的方式编写<code>HOC</code>的时候，要注意的是就是，静态属性丢失的问题，前面提到了，如果不做处理，静态方法就会全部丢失。</p><h3 id="手动继承" tabindex="-1"><a class="header-anchor" href="#手动继承" aria-hidden="true">#</a> 手动继承</h3><p>可以手动将原始组件的静态方法<code>copy</code>到 <code>hoc</code>组件上来，但前提是必须准确知道应该拷贝哪些方法。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">WrappedComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
      <span class="token comment">/*...*/</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 必须准确知道应该拷贝哪些方法 </span>
  WrappedComponent<span class="token punctuation">.</span>staticMethod <span class="token operator">=</span> Component<span class="token punctuation">.</span>staticMethod
  <span class="token keyword">return</span> WrappedComponent
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="引入第三方库" tabindex="-1"><a class="header-anchor" href="#引入第三方库" aria-hidden="true">#</a> 引入第三方库</h3><p>这样每个静态方法都绑定会很累，尤其对于开源的<code>hoc</code>，<strong>对原生组件的静态方法是未知的</strong>,可以使用 <code>hoist-non-react-statics</code> 自动拷贝所有的静态方法:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> hoistNonReactStatic <span class="token keyword">from</span> <span class="token string">&#39;hoist-non-react-statics&#39;</span>
<span class="token keyword">function</span> <span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">WrappedComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
      <span class="token comment">/*...*/</span>
  <span class="token punctuation">}</span>
  <span class="token function">hoistNonReactStatic</span><span class="token punctuation">(</span>WrappedComponent<span class="token punctuation">,</span>Component<span class="token punctuation">)</span>
  <span class="token keyword">return</span> WrappedComponent
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_3-跨层级捕获ref" tabindex="-1"><a class="header-anchor" href="#_3-跨层级捕获ref" aria-hidden="true">#</a> 3 跨层级捕获ref</h2><hr><p>高阶组件的约定是将所有 <code>props</code> 传递给被包装组件，但这对于 <code>refs</code> 并不适用。那是因为 <code>ref</code> 实际上并不是一个 <code>prop</code> - 就像 <code>key</code> 一样，它是由 <code>React</code> 专门处理的。如果将 <code>ref</code> 添加到 <code>HOC</code> 的返回组件中，则 <code>ref</code> 引用指向容器组件，而不是被包装组件。可以通过<code>forwardRef</code>来解决这个问题。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * 
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">Component</span> 原始组件
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">isRef</span>  是否开启ref模式
 */</span>
<span class="token keyword">function</span> <span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token parameter">Component<span class="token punctuation">,</span>isRef</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Wrap</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
     <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> forwardedRef <span class="token punctuation">,</span><span class="token operator">...</span>otherprops  <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component ref<span class="token operator">=</span><span class="token punctuation">{</span>forwardedRef<span class="token punctuation">}</span>  <span class="token punctuation">{</span><span class="token operator">...</span>otherprops<span class="token punctuation">}</span>  <span class="token operator">/</span><span class="token operator">&gt;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>isRef<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span>  React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span>ref</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>Wrap forwardedRef<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Wrap
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">666</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>hello<span class="token punctuation">,</span>world<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> HocIndex <span class="token operator">=</span>  <span class="token constant">HOC</span><span class="token punctuation">(</span>Index<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     <span class="token comment">/* 就可以跨层级，捕获到 Index 组件的实例了 */</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>current<span class="token punctuation">.</span>componentDidMount<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span>HocIndex ref<span class="token operator">=</span><span class="token punctuation">{</span>node<span class="token punctuation">}</span>  <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p><strong>打印结果：</strong></p><img src="/technology/assets/react/7fb292247ca1470bb1cb6498616284c2_tplv-k3u1fbpfcp-watermark.image" alt="demo"><p>如上就解决了,<code>HOC</code>跨层级捕获<code>ref</code>的问题。</p><h2 id="_4-render中不要声明hoc" tabindex="-1"><a class="header-anchor" href="#_4-render中不要声明hoc" aria-hidden="true">#</a> 4 render中不要声明HOC</h2><hr><p>🙅错误写法：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">const</span> WrapHome <span class="token operator">=</span> <span class="token constant">HOC</span><span class="token punctuation">(</span>Home<span class="token punctuation">)</span>
     <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrapHome <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果这么写，会造成一个极大的问题，因为每一次<code>HOC</code>都会返回一个新的<code>WrapHome</code>,<code>react diff</code>会判定两次<strong>不是同一个组件</strong>，那么每次<code>Index</code> 组件 <code>render</code>触发，<code>WrapHome</code>，会重新挂载，状态会<strong>全都丢失</strong>。如果想要动态绑定HOC,请参考如下方式。</p><p>🙆正确写法：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> WrapHome <span class="token operator">=</span> <span class="token constant">HOC</span><span class="token punctuation">(</span>Home<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrapHome <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: suiyi19920228@qq.com">sykinggg</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/technology/assets/app.ee3fc36b.js" defer></script>
  </body>
</html>
