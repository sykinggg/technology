import{r as p,o as c,c as r,b as e,d as a,F as l,e as s,a as o}from"./app.ee3fc36b.js";import{_ as d}from"./plugin-vue_export-helper.21dcd24c.js";const i={},u=s("\u901A\u8FC7"),k={href:"/react/state/mental.md",target:"_blank",rel:"noopener noreferrer"},b=s("\u66F4\u65B0\u7684\u5FC3\u667A\u6A21\u578B"),_=s("\uFF0C\u4E86\u89E3\u5230"),h=e("code",null,"\u66F4\u65B0",-1),m=s("\u5177\u6709"),g=e("code",null,"\u4F18\u5148\u7EA7",-1),f=s("\u3002"),y=e("p",null,[s("\u90A3\u4E48\u4EC0\u4E48\u662F"),e("code",null,"\u4F18\u5148\u7EA7"),s("\uFF1F"),e("code",null,"\u4F18\u5148\u7EA7"),s("\u4EE5\u4EC0\u4E48\u4E3A\u4F9D\u636E\uFF1F\u5982\u4F55\u901A\u8FC7"),e("code",null,"\u4F18\u5148\u7EA7"),s("\u51B3\u5B9A\u54EA\u4E2A\u72B6\u6001\u5E94\u8BE5\u5148\u88AB\u66F4\u65B0\uFF1F")],-1),U=e("p",null,"\u672C\u8282\u4F1A\u8BE6\u7EC6\u8BB2\u89E3\u3002",-1),v=e("h2",{id:"\u4EC0\u4E48\u662F\u4F18\u5148\u7EA7",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u4EC0\u4E48\u662F\u4F18\u5148\u7EA7","aria-hidden":"true"},"#"),s(" \u4EC0\u4E48\u662F\u4F18\u5148\u7EA7")],-1),j=s("\u5728"),B={href:"/react/preparation/idea.md#%E7%90%86%E8%A7%A3-%E5%93%8D%E5%BA%94%E8%87%AA%E7%84%B6",target:"_blank",rel:"noopener noreferrer"},x=s("React\u7406\u5FF5\u4E00\u8282"),w=s("\u804A\u5230"),S=e("code",null,"React",-1),E=s("\u5C06\u4EBA\u673A\u4EA4\u4E92\u7814\u7A76\u7684\u7ED3\u679C\u6574\u5408\u5230\u771F\u5B9E\u7684"),A=e("code",null,"UI",-1),Q=s("\u4E2D\u3002\u5177\u4F53\u5230"),R=e("code",null,"React",-1),C=s("\u8FD0\u884C\u4E0A\u8FD9\u662F\u4EC0\u4E48\u610F\u601D\u5462\uFF1F"),I=o('<p><code>\u72B6\u6001\u66F4\u65B0</code>\u7531<code>\u7528\u6237\u4EA4\u4E92</code>\u4EA7\u751F\uFF0C\u7528\u6237\u5FC3\u91CC\u5BF9<code>\u4EA4\u4E92</code>\u6267\u884C\u987A\u5E8F\u6709\u4E2A\u9884\u671F\u3002<code>React</code>\u6839\u636E<code>\u4EBA\u673A\u4EA4\u4E92\u7814\u7A76\u7684\u7ED3\u679C</code>\u4E2D\u7528\u6237\u5BF9<code>\u4EA4\u4E92</code>\u7684\u9884\u671F\u987A\u5E8F\u4E3A<code>\u4EA4\u4E92</code>\u4EA7\u751F\u7684<code>\u72B6\u6001\u66F4\u65B0</code>\u8D4B\u4E88\u4E0D\u540C\u4F18\u5148\u7EA7\u3002</p><p>\u5177\u4F53\u5982\u4E0B\uFF1A</p><ul><li><p>\u751F\u547D\u5468\u671F\u65B9\u6CD5\uFF1A\u540C\u6B65\u6267\u884C\u3002</p></li><li><p>\u53D7\u63A7\u7684\u7528\u6237\u8F93\u5165\uFF1A\u6BD4\u5982\u8F93\u5165\u6846\u5185\u8F93\u5165\u6587\u5B57\uFF0C\u540C\u6B65\u6267\u884C\u3002</p></li><li><p>\u4EA4\u4E92\u4E8B\u4EF6\uFF1A\u6BD4\u5982\u52A8\u753B\uFF0C\u9AD8\u4F18\u5148\u7EA7\u6267\u884C\u3002</p></li><li><p>\u5176\u4ED6\uFF1A\u6BD4\u5982\u6570\u636E\u8BF7\u6C42\uFF0C\u4F4E\u4F18\u5148\u7EA7\u6267\u884C\u3002</p></li></ul><h2 id="\u5982\u4F55\u8C03\u5EA6\u4F18\u5148\u7EA7" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u8C03\u5EA6\u4F18\u5148\u7EA7" aria-hidden="true">#</a> \u5982\u4F55\u8C03\u5EA6\u4F18\u5148\u7EA7</h2>',4),D=s("\u5728"),P={href:"/react/preparation/newConstructure.md",target:"_blank",rel:"noopener noreferrer"},L=s("\u65B0\u7684React\u7ED3\u6784\u4E00\u8282"),T=s("\u8BB2\u5230\uFF0C"),X=e("code",null,"React",-1),F=s("\u901A\u8FC7"),N=e("code",null,"Scheduler",-1),W=s("\u8C03\u5EA6\u4EFB\u52A1\u3002"),q=o("<p>\u5177\u4F53\u5230\u4EE3\u7801\uFF0C\u6BCF\u5F53\u9700\u8981\u8C03\u5EA6\u4EFB\u52A1\u65F6\uFF0C<code>React</code>\u4F1A\u8C03\u7528<code>Scheduler</code>\u63D0\u4F9B\u7684\u65B9\u6CD5<code>runWithPriority</code>\u3002</p><p>\u8BE5\u65B9\u6CD5\u63A5\u6536\u4E00\u4E2A<code>\u4F18\u5148\u7EA7</code>\u5E38\u91CF\u4E0E\u4E00\u4E2A<code>\u56DE\u8C03\u51FD\u6570</code>\u4F5C\u4E3A\u53C2\u6570\u3002<code>\u56DE\u8C03\u51FD\u6570</code>\u4F1A\u4EE5<code>\u4F18\u5148\u7EA7</code>\u9AD8\u4F4E\u4E3A\u987A\u5E8F\u6392\u5217\u5728\u4E00\u4E2A<code>\u5B9A\u65F6\u5668</code>\u4E2D\u5E76\u5728\u5408\u9002\u7684\u65F6\u95F4\u89E6\u53D1\u3002</p>",2),z=s("\u5BF9\u4E8E\u66F4\u65B0\u6765\u8BB2\uFF0C\u4F20\u9012\u7684"),V=e("code",null,"\u56DE\u8C03\u51FD\u6570",-1),H=s("\u4E00\u822C\u4E3A"),$={href:"/react/state/prepare.md#render%E9%98%B6%E6%AE%B5%E7%9A%84%E5%BC%80%E5%A7%8B",target:"_blank",rel:"noopener noreferrer"},G=s("\u72B6\u6001\u66F4\u65B0\u6D41\u7A0B\u6982\u89C8\u4E00\u8282"),J=s("\u8BB2\u5230\u7684"),K=e("code",null,"render\u9636\u6BB5\u7684\u5165\u53E3\u51FD\u6570",-1),M=s("\u3002"),O=s("\u4F60\u53EF\u4EE5\u5728"),Y={href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/scheduler/src/Scheduler.js#L217",target:"_blank",rel:"noopener noreferrer"},Z=s("==unstable_runWithPriority== \u8FD9\u91CC"),ee=s("\u770B\u5230"),se=e("code",null,"runWithPriority",-1),ne=s("\u65B9\u6CD5\u7684\u5B9A\u4E49\u3002\u5728"),ae={href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/scheduler/src/SchedulerPriorities.js",target:"_blank",rel:"noopener noreferrer"},oe=s("\u8FD9\u91CC"),te=s("\u770B\u5230"),pe=e("code",null,"Scheduler",-1),ce=s("\u5BF9\u4F18\u5148\u7EA7\u5E38\u91CF\u7684\u5B9A\u4E49\u3002"),re=e("h2",{id:"\u4F8B\u5B50",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u4F8B\u5B50","aria-hidden":"true"},"#"),s(" \u4F8B\u5B50")],-1),le=e("p",null,[s("\u4F18\u5148\u7EA7\u6700\u7EC8\u4F1A\u53CD\u6620\u5230"),e("code",null,"update.lane"),s("\u53D8\u91CF\u4E0A\u3002\u5F53\u524D\u53EA\u9700\u8981\u77E5\u9053\u8FD9\u4E2A\u53D8\u91CF\u80FD\u591F\u533A\u5206"),e("code",null,"Update"),s("\u7684\u4F18\u5148\u7EA7\u3002")],-1),de=e("p",null,[s("\u63A5\u4E0B\u6765\u901A\u8FC7\u4E00\u4E2A\u4F8B\u5B50\u7ED3\u5408\u4E0A\u4E00\u8282\u4ECB\u7ECD\u7684"),e("code",null,"Update"),s("\u76F8\u5173\u5B57\u6BB5\u8BB2\u89E3\u4F18\u5148\u7EA7\u5982\u4F55\u51B3\u5B9A\u66F4\u65B0\u7684\u987A\u5E8F\u3002")],-1),ie=s("\u8BE5\u4F8B\u5B50\u6765\u81EA"),ue={href:"https://twitter.com/acdlite/status/978412930973687808",target:"_blank",rel:"noopener noreferrer"},ke=s("React Core Team Andrew\u5411\u7F51\u53CB\u8BB2\u89E3Update\u5DE5\u4F5C\u6D41\u7A0B\u7684\u63A8\u6587"),be=["src"],_e=o(`<p>\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\uFF0C\u6709\u4E24\u4E2A<code>Update</code>\u3002\u5C06\u201C\u5173\u95ED\u9ED1\u591C\u6A21\u5F0F\u201D\u4EA7\u751F\u7684<code>Update</code>\u79F0\u4E3A<code>u1</code>\uFF0C\u8F93\u5165\u5B57\u6BCD\u201CI\u201D\u4EA7\u751F\u7684<code>Update</code>\u79F0\u4E3A<code>u2</code>\u3002</p><p>\u5176\u4E2D<code>u1</code>\u5148\u89E6\u53D1\u5E76\u8FDB\u5165<code>render\u9636\u6BB5</code>\u3002\u5176\u4F18\u5148\u7EA7\u8F83\u4F4E\uFF0C\u6267\u884C\u65F6\u95F4\u8F83\u957F\u3002\u6B64\u65F6\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>fiber<span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">baseState</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">blackTheme</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;H&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">firstBaseUpdate</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">lastBaseUpdate</span><span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token literal-property property">shared</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">pending</span><span class="token operator">:</span> u1
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">effects</span><span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u5728<code>u1</code>\u5B8C\u6210<code>render\u9636\u6BB5</code>\u524D\u7528\u6237\u901A\u8FC7\u952E\u76D8\u8F93\u5165\u5B57\u6BCD\u201CI\u201D\uFF0C\u4EA7\u751F\u4E86<code>u2</code>\u3002<code>u2</code>\u5C5E\u4E8E<strong>\u53D7\u63A7\u7684\u7528\u6237\u8F93\u5165</strong>\uFF0C\u4F18\u5148\u7EA7\u9AD8\u4E8E<code>u1</code>\uFF0C\u4E8E\u662F\u4E2D\u65AD<code>u1</code>\u4EA7\u751F\u7684<code>render\u9636\u6BB5</code>\u3002</p><p>\u6B64\u65F6\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>fiber<span class="token punctuation">.</span>updateQueue<span class="token punctuation">.</span>shared<span class="token punctuation">.</span>pending <span class="token operator">===</span> u2 <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">&gt;</span> u1
                                     <span class="token operator">^</span>        <span class="token operator">|</span>
                                     <span class="token operator">|</span>________<span class="token operator">|</span>
<span class="token comment">// \u5373</span>
u2<span class="token punctuation">.</span>next <span class="token operator">===</span> u1<span class="token punctuation">;</span>
u1<span class="token punctuation">.</span>next <span class="token operator">===</span> u2<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u5176\u4E2D<code>u2</code>\u4F18\u5148\u7EA7\u9AD8\u4E8E<code>u1</code>\u3002</p><p>\u63A5\u4E0B\u6765\u8FDB\u5165<code>u2</code>\u4EA7\u751F\u7684<code>render\u9636\u6BB5</code>\u3002</p><p>\u5728<code>processUpdateQueue</code>\u65B9\u6CD5\u4E2D\uFF0C<code>shared.pending</code>\u73AF\u72B6\u94FE\u8868\u4F1A\u88AB\u526A\u5F00\u5E76\u62FC\u63A5\u5728<code>baseUpdate</code>\u540E\u9762\u3002</p><p>\u9700\u8981\u660E\u786E\u4E00\u70B9\uFF0C<code>shared.pending</code>\u6307\u5411\u6700\u540E\u4E00\u4E2A<code>pending</code>\u7684<code>update</code>\uFF0C\u6240\u4EE5\u5B9E\u9645\u6267\u884C\u65F6<code>update</code>\u7684\u987A\u5E8F\u4E3A\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>u1 <span class="token operator">--</span> u2
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u63A5\u4E0B\u6765\u904D\u5386<code>baseUpdate</code>\uFF0C\u5904\u7406\u4F18\u5148\u7EA7\u5408\u9002\u7684<code>Update</code>\uFF08\u8FD9\u4E00\u6B21\u5904\u7406\u7684\u662F\u66F4\u9AD8\u4F18\u7684<code>u2</code>\uFF09\u3002</p><p>\u7531\u4E8E<code>u2</code>\u4E0D\u662F<code>baseUpdate</code>\u4E2D\u7684\u7B2C\u4E00\u4E2A<code>update</code>\uFF0C\u5728\u5176\u4E4B\u524D\u7684<code>u1</code>\u7531\u4E8E\u4F18\u5148\u7EA7\u4E0D\u591F\u88AB\u8DF3\u8FC7\u3002</p><p><code>update</code>\u4E4B\u95F4\u53EF\u80FD\u6709\u4F9D\u8D56\u5173\u7CFB\uFF0C\u6240\u4EE5\u88AB\u8DF3\u8FC7\u7684<code>update</code>\u53CA\u5176\u540E\u9762\u6240\u6709<code>update</code>\u4F1A\u6210\u4E3A\u4E0B\u6B21\u66F4\u65B0\u7684<code>baseUpdate</code>\u3002\uFF08\u5373<code>u1 -- u2</code>\uFF09\u3002</p><p>\u6700\u7EC8<code>u2</code>\u5B8C\u6210<code>render - commit\u9636\u6BB5</code>\u3002</p><p>\u6B64\u65F6\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>fiber<span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">baseState</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">blackTheme</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;HI&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">firstBaseUpdate</span><span class="token operator">:</span> u1<span class="token punctuation">,</span>
  <span class="token literal-property property">lastBaseUpdate</span><span class="token operator">:</span> u2
  <span class="token literal-property property">shared</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">pending</span><span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">effects</span><span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u5728<code>commit</code>\u9636\u6BB5\u7ED3\u5C3E\u4F1A\u518D\u8C03\u5EA6\u4E00\u6B21\u66F4\u65B0\u3002\u5728\u8BE5\u6B21\u66F4\u65B0\u4E2D\u4F1A\u57FA\u4E8E<code>baseState</code>\u4E2D<code>firstBaseUpdate</code>\u4FDD\u5B58\u7684<code>u1</code>\uFF0C\u5F00\u542F\u4E00\u6B21\u65B0\u7684<code>render\u9636\u6BB5</code>\u3002</p><p>\u6700\u7EC8\u4E24\u6B21<code>Update</code>\u90FD\u5B8C\u6210\u540E\u7684\u7ED3\u679C\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>fiber<span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">baseState</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">blackTheme</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;HI&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">firstBaseUpdate</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">lastBaseUpdate</span><span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token literal-property property">shared</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">pending</span><span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">effects</span><span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u53EF\u4EE5\u770B\u89C1\uFF0C<code>u2</code>\u5BF9\u5E94\u7684\u66F4\u65B0\u6267\u884C\u4E86\u4E24\u6B21\uFF0C\u76F8\u5E94\u7684<code>render\u9636\u6BB5</code>\u7684\u751F\u547D\u5468\u671F\u52FE\u5B50<code>componentWillXXX</code>\u4E5F\u4F1A\u89E6\u53D1\u4E24\u6B21\u3002\u8FD9\u4E5F\u662F\u4E3A\u4EC0\u4E48\u8FD9\u4E9B\u52FE\u5B50\u4F1A\u88AB\u6807\u8BB0\u4E3A<code>unsafe_</code>\u3002</p><h2 id="\u5982\u4F55\u4FDD\u8BC1\u72B6\u6001\u6B63\u786E" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u4FDD\u8BC1\u72B6\u6001\u6B63\u786E" aria-hidden="true">#</a> \u5982\u4F55\u4FDD\u8BC1\u72B6\u6001\u6B63\u786E</h2><p>\u73B0\u5728\u57FA\u672C\u638C\u63E1\u4E86<code>updateQueue</code>\u7684\u5DE5\u4F5C\u6D41\u7A0B\u3002\u8FD8\u6709\u4E24\u4E2A\u7591\u95EE\uFF1A</p><ul><li><p><code>render\u9636\u6BB5</code>\u53EF\u80FD\u88AB\u4E2D\u65AD\u3002\u5982\u4F55\u4FDD\u8BC1<code>updateQueue</code>\u4E2D\u4FDD\u5B58\u7684<code>Update</code>\u4E0D\u4E22\u5931\uFF1F</p></li><li><p>\u6709\u65F6\u5019\u5F53\u524D<code>\u72B6\u6001</code>\u9700\u8981\u4F9D\u8D56\u524D\u4E00\u4E2A<code>\u72B6\u6001</code>\u3002\u5982\u4F55\u5728\u652F\u6301\u8DF3\u8FC7<code>\u4F4E\u4F18\u5148\u7EA7\u72B6\u6001</code>\u7684\u540C\u65F6\u4FDD\u8BC1<strong>\u72B6\u6001\u4F9D\u8D56\u7684\u8FDE\u7EED\u6027</strong>\uFF1F</p></li></ul><p>\u5206\u522B\u8BB2\u89E3\u4E0B\u3002</p><h3 id="\u5982\u4F55\u4FDD\u8BC1update\u4E0D\u4E22\u5931" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u4FDD\u8BC1update\u4E0D\u4E22\u5931" aria-hidden="true">#</a> \u5982\u4F55\u4FDD\u8BC1<code>Update</code>\u4E0D\u4E22\u5931</h3>`,26),he=s("\u5728"),me={href:"/react/state/update.md#%E4%BE%8B%E5%AD%90",target:"_blank",rel:"noopener noreferrer"},ge=s("\u4E0A\u4E00\u8282\u4F8B\u5B50"),fe=s("\u4E2D\u8BB2\u5230\uFF0C\u5728"),ye=e("code",null,"render\u9636\u6BB5",-1),Ue=s("\uFF0C"),ve=e("code",null,"shared.pending",-1),je=s("\u7684\u73AF\u88AB\u526A\u5F00\u5E76\u8FDE\u63A5\u5728"),Be=e("code",null,"updateQueue.lastBaseUpdate",-1),xe=s("\u540E\u9762\u3002"),we=e("p",null,[s("\u5B9E\u9645\u4E0A"),e("code",null,"shared.pending"),s("\u4F1A\u88AB\u540C\u65F6\u8FDE\u63A5\u5728"),e("code",null,"workInProgress updateQueue.lastBaseUpdate"),s("\u4E0E"),e("code",null,"current updateQueue.lastBaseUpdate"),s("\u540E\u9762\u3002")],-1),Se=s("\u5177\u4F53\u4EE3\u7801\u89C1"),Ee={href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/react-reconciler/src/ReactUpdateQueue.new.js#L424",target:"_blank",rel:"noopener noreferrer"},Ae=s("\u8FD9\u91CC"),Qe=o(`<p>\u5F53<code>render\u9636\u6BB5</code>\u88AB\u4E2D\u65AD\u540E\u91CD\u65B0\u5F00\u59CB\u65F6\uFF0C\u4F1A\u57FA\u4E8E<code>current updateQueue</code>\u514B\u9686\u51FA<code>workInProgress updateQueue</code>\u3002\u7531\u4E8E<code>current updateQueue.lastBaseUpdate</code>\u5DF2\u7ECF\u4FDD\u5B58\u4E86\u4E0A\u4E00\u6B21\u7684<code>Update</code>\uFF0C\u6240\u4EE5\u4E0D\u4F1A\u4E22\u5931\u3002</p><p>\u5F53<code>commit\u9636\u6BB5</code>\u5B8C\u6210\u6E32\u67D3\uFF0C\u7531\u4E8E<code>workInProgress updateQueue.lastBaseUpdate</code>\u4E2D\u4FDD\u5B58\u4E86\u4E0A\u4E00\u6B21\u7684<code>Update</code>\uFF0C\u6240\u4EE5 <code>workInProgress Fiber\u6811</code>\u53D8\u6210<code>current Fiber\u6811</code>\u540E\u4E5F\u4E0D\u4F1A\u9020\u6210<code>Update</code>\u4E22\u5931\u3002</p><h3 id="\u5982\u4F55\u4FDD\u8BC1\u72B6\u6001\u4F9D\u8D56\u7684\u8FDE\u7EED\u6027" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u4FDD\u8BC1\u72B6\u6001\u4F9D\u8D56\u7684\u8FDE\u7EED\u6027" aria-hidden="true">#</a> \u5982\u4F55\u4FDD\u8BC1\u72B6\u6001\u4F9D\u8D56\u7684\u8FDE\u7EED\u6027</h3><p>\u5F53\u67D0\u4E2A<code>Update</code>\u7531\u4E8E\u4F18\u5148\u7EA7\u4F4E\u800C\u88AB\u8DF3\u8FC7\u65F6\uFF0C\u4FDD\u5B58\u5728<code>baseUpdate</code>\u4E2D\u7684\u4E0D\u4EC5\u662F\u8BE5<code>Update</code>\uFF0C\u8FD8\u5305\u62EC\u94FE\u8868\u4E2D\u8BE5<code>Update</code>\u4E4B\u540E\u7684\u6240\u6709<code>Update</code>\u3002</p><p>\u8003\u8651\u5982\u4E0B\u4F8B\u5B50\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">baseState</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
shared<span class="token punctuation">.</span>pending<span class="token operator">:</span> <span class="token constant">A1</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">B2</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">C1</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">D2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u5176\u4E2D<code>\u5B57\u6BCD</code>\u4EE3\u8868\u8BE5<code>Update</code>\u8981\u5728\u9875\u9762\u63D2\u5165\u7684\u5B57\u6BCD\uFF0C<code>\u6570\u5B57</code>\u4EE3\u8868<code>\u4F18\u5148\u7EA7</code>\uFF0C\u503C\u8D8A\u4F4E<code>\u4F18\u5148\u7EA7</code>\u8D8A\u9AD8\u3002</p><p>\u7B2C\u4E00\u6B21<code>render</code>\uFF0C<code>\u4F18\u5148\u7EA7</code>\u4E3A1\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">baseState</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
<span class="token literal-property property">baseUpdate</span><span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token literal-property property">render\u9636\u6BB5\u4F7F\u7528\u7684Update</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">A1</span><span class="token punctuation">,</span> <span class="token constant">C1</span><span class="token punctuation">]</span>
<span class="token literal-property property">memoizedState</span><span class="token operator">:</span> <span class="token string">&#39;AC&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u5176\u4E2D<code>B2</code>\u7531\u4E8E\u4F18\u5148\u7EA7\u4E3A2\uFF0C\u4F4E\u4E8E\u5F53\u524D\u4F18\u5148\u7EA7\uFF0C\u6240\u4EE5\u4ED6\u53CA\u5176\u540E\u9762\u7684\u6240\u6709<code>Update</code>\u4F1A\u88AB\u4FDD\u5B58\u5728<code>baseUpdate</code>\u4E2D\u4F5C\u4E3A\u4E0B\u6B21\u66F4\u65B0\u7684<code>Update</code>\uFF08\u5373<code>B2 C1 D2</code>\uFF09\u3002</p><p>\u8FD9\u4E48\u505A\u662F\u4E3A\u4E86\u4FDD\u6301<code>\u72B6\u6001</code>\u7684\u524D\u540E\u4F9D\u8D56\u987A\u5E8F\u3002</p><p>\u7B2C\u4E8C\u6B21<code>render</code>\uFF0C<code>\u4F18\u5148\u7EA7</code>\u4E3A2\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">baseState</span><span class="token operator">:</span> <span class="token string">&#39;A&#39;</span>
<span class="token literal-property property">baseUpdate</span><span class="token operator">:</span> <span class="token constant">B2</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">C1</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">D2</span>
<span class="token literal-property property">render\u9636\u6BB5\u4F7F\u7528\u7684Update</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">B2</span><span class="token punctuation">,</span> <span class="token constant">C1</span><span class="token punctuation">,</span> <span class="token constant">D2</span><span class="token punctuation">]</span>
<span class="token literal-property property">memoizedState</span><span class="token operator">:</span> <span class="token string">&#39;ABCD&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u6CE8\u610F\u8FD9\u91CC<code>baseState</code>\u5E76\u4E0D\u662F\u4E0A\u4E00\u6B21\u66F4\u65B0\u7684<code>memoizedState</code>\u3002\u8FD9\u662F\u7531\u4E8E<code>B2</code>\u88AB\u8DF3\u8FC7\u4E86\u3002</p><p>\u5373\u5F53\u6709<code>Update</code>\u88AB\u8DF3\u8FC7\u65F6\uFF0C<code>\u4E0B\u6B21\u66F4\u65B0\u7684baseState !== \u4E0A\u6B21\u66F4\u65B0\u7684memoizedState</code>\u3002</p>`,15),Re=s("\u8DF3\u8FC7"),Ce=e("code",null,"B2",-1),Ie=s("\u7684\u903B\u8F91\u89C1"),De={href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/react-reconciler/src/ReactUpdateQueue.new.js#L479",target:"_blank",rel:"noopener noreferrer"},Pe=s("\u8FD9\u91CC"),Le=e("p",null,[s("\u901A\u8FC7\u4EE5\u4E0A\u4F8B\u5B50\u53EF\u4EE5\u53D1\u73B0\uFF0C"),e("code",null,"React"),s("\u4FDD\u8BC1\u6700\u7EC8\u7684\u72B6\u6001\u4E00\u5B9A\u548C\u7528\u6237\u89E6\u53D1\u7684"),e("code",null,"\u4EA4\u4E92"),s("\u4E00\u81F4\uFF0C\u4F46\u662F\u4E2D\u95F4\u8FC7\u7A0B"),e("code",null,"\u72B6\u6001"),s("\u53EF\u80FD\u7531\u4E8E\u8BBE\u5907\u4E0D\u540C\u800C\u4E0D\u540C\u3002")],-1),Te=e("p",null,"details \u9AD8\u4F18\u5148\u7EA7\u4EFB\u52A1\u6253\u65AD\u4F4E\u4F18\u5148\u7EA7\u4EFB\u52A1Demo",-1),Xe={href:"https://codesandbox.io/s/epic-borg-kx7jn",target:"_blank",rel:"noopener noreferrer"},Fe=s("\u591A\u91CD\u5F02\u6B65\u66F4\u6539"),Ne=e("h2",{id:"\u53C2\u8003\u8D44\u6599",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u53C2\u8003\u8D44\u6599","aria-hidden":"true"},"#"),s(" \u53C2\u8003\u8D44\u6599")],-1),We={href:"https://juejin.im/post/5f05a3e25188252e5c576cdb",target:"_blank",rel:"noopener noreferrer"},qe=s("\u6DF1\u5165\u6E90\u7801\u5256\u6790componentWillXXX\u4E3A\u4EC0\u4E48UNSAFE"),ze={href:"https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/react-reconciler/src/ReactUpdateQueue.new.js#L10",target:"_blank",rel:"noopener noreferrer"},Ve=s("React\u6E90\u7801\u4E2D\u8BB2\u89E3Update\u5DE5\u4F5C\u6D41\u7A0B\u53CA\u4F18\u5148\u7EA7\u7684\u6CE8\u91CA"),He={href:"https://twitter.com/acdlite/status/978412930973687808",target:"_blank",rel:"noopener noreferrer"},$e=s("React Core Team Andrew\u5411\u7F51\u53CB\u8BB2\u89E3Update\u5DE5\u4F5C\u6D41\u7A0B\u7684\u63A8\u6587");function Ge(t,Je){const n=p("ExternalLinkIcon");return c(),r(l,null,[e("p",null,[u,e("a",k,[b,a(n)]),_,h,m,g,f]),y,U,v,e("p",null,[j,e("a",B,[x,a(n)]),w,S,E,A,Q,R,C]),I,e("p",null,[D,e("a",P,[L,a(n)]),T,X,F,N,W]),q,e("p",null,[z,V,H,e("a",$,[G,a(n)]),J,K,M]),e("blockquote",null,[e("p",null,[O,e("a",Y,[Z,a(n)]),ee,se,ne,e("a",ae,[oe,a(n)]),te,pe,ce])]),re,le,de,e("blockquote",null,[e("p",null,[ie,e("a",ue,[ke,a(n)])])]),e("img",{src:t.$withBase("/assets/react/update-process.png"),alt:"\u4F18\u5148\u7EA7\u5982\u4F55\u51B3\u5B9A\u66F4\u65B0\u7684\u987A\u5E8F"},null,8,be),_e,e("p",null,[he,e("a",me,[ge,a(n)]),fe,ye,Ue,ve,je,Be,xe]),we,e("blockquote",null,[e("p",null,[Se,e("a",Ee,[Ae,a(n)])])]),Qe,e("blockquote",null,[e("p",null,[Re,Ce,Ie,e("a",De,[Pe,a(n)])])]),Le,Te,e("p",null,[e("a",Xe,[Fe,a(n)])]),Ne,e("p",null,[e("a",We,[qe,a(n)])]),e("p",null,[e("a",ze,[Ve,a(n)])]),e("p",null,[e("a",He,[$e,a(n)])])],64)}var Oe=d(i,[["render",Ge]]);export{Oe as default};
